<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roteiros - StudioDias</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/auth-block.js"></script>
    <style>
        /* Estilos especificos da ferramenta */
        .textarea-highlight {
            background: var(--accent-glow);
            border-color: var(--accent);
        }

        .video-block {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .video-header {
            background: var(--accent);
            padding: 10px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-title {
            font-weight: 600;
            color: white;
            font-size: 0.85rem;
        }

        .video-badge {
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            color: white;
        }

        .video-body {
            padding: 14px;
        }

        .scene {
            margin-bottom: 14px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--border);
        }

        .scene:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .scene-row {
            margin-bottom: 8px;
        }

        .scene-label {
            font-size: 0.68rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .scene-label::before {
            content: '';
            width: 5px;
            height: 5px;
            border-radius: 50%;
        }

        .scene-label.hook { color: var(--warning); }
        .scene-label.hook::before { background: var(--warning); }
        .scene-label.visual { color: #a855f7; }
        .scene-label.visual::before { background: #a855f7; }
        .scene-label.narration { color: var(--accent); }
        .scene-label.narration::before { background: var(--accent); }
        .scene-label.cta { color: var(--success); }
        .scene-label.cta::before { background: var(--success); }

        .scene-text {
            font-size: 0.85rem;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            border-left: 2px solid var(--border);
        }

        .scene-text.hook { border-color: var(--warning); font-weight: 500; }
        .scene-text.visual { border-color: #a855f7; font-style: italic; color: var(--text-secondary); }
        .scene-text.narration { border-color: var(--accent); }
        .scene-text.cta { border-color: var(--success); font-weight: 500; }

        .btn-edit {
            position: absolute;
            top: 4px;
            right: 4px;
            border: none;
            background: transparent;
            cursor: pointer;
            opacity: 0.25;
            transition: opacity 0.2s;
            z-index: 10;
            padding: 2px;
            line-height: 1;
            color: var(--text-muted);
            font-size: 11px;
        }
        .btn-edit:hover { opacity: 0.7; }
        .btn-edit-small { font-size: 10px; }

        .texto-editavel.editando {
            outline: 1px dashed var(--text-muted);
            cursor: text;
        }

        .scene-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .script-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .script-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .script-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .script-meta span {
            background: var(--bg-tertiary);
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: var(--accent);
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            margin-left: 6px;
        }

        .ai-badge svg {
            width: 10px;
            height: 10px;
            fill: white;
        }

        .important-box {
            background: var(--accent-glow);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-bottom: 16px;
        }

        .important-box-title {
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 6px;
        }

        .important-box-content {
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        /* Refine Panel */
        .refine-panel {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin-top: 20px;
            overflow: hidden;
        }

        .refine-panel.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .refine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .refine-title {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refine-title svg {
            width: 16px;
            height: 16px;
            fill: var(--accent);
        }

        .refine-counter {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--bg-input);
            padding: 4px 10px;
            border-radius: var(--radius-full);
            border: 1px solid var(--border);
        }

        .refine-counter span {
            color: var(--accent);
            font-weight: 600;
        }

        .refine-body {
            padding: 18px;
        }

        .refine-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0 16px;
        }

        .refine-chip {
            padding: 6px 14px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .refine-chip:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .refine-chip.selected {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .refine-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .panel-actions {
            display: flex;
            gap: 4px;
        }

        /* Accordion Avancado */
        .config-accordion {
            border-top: 1px solid var(--border);
            margin-top: 16px;
        }

        .config-accordion-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 14px 0;
            background: transparent;
            border: none;
            cursor: pointer;
            font-family: inherit;
            color: var(--text-secondary);
            transition: color var(--transition-fast);
        }

        .config-accordion-toggle:hover {
            color: var(--text-primary);
        }

        .config-accordion-toggle .toggle-left {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.82rem;
            font-weight: 600;
        }

        .config-accordion-toggle svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .config-accordion-toggle .toggle-arrow {
            width: 20px;
            height: 20px;
            fill: var(--text-muted);
            transition: transform 0.25s ease;
        }

        .config-accordion-toggle.open .toggle-arrow {
            transform: rotate(180deg);
        }

        .config-accordion-body {
            display: none;
            padding-bottom: 6px;
            animation: fadeIn 0.2s ease;
        }

        .config-accordion-body.open {
            display: block;
        }

        /* Config melhorado */
        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .config-section .config-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .config-label-new {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.4px;
        }

        .config-label-new.highlight {
            color: var(--accent);
        }

        /* Select melhorado */
        select.select-styled {
            padding: 10px 36px 10px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1.5px solid var(--border);
            background-color: var(--bg-input);
            transition: all 0.2s ease;
        }

        select.select-styled:hover {
            border-color: var(--accent);
        }

        select.select-styled:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Input melhorado */
        input.input-styled {
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1.5px solid var(--border);
            transition: all 0.2s ease;
        }

        input.input-styled:hover {
            border-color: var(--accent);
        }

        input.input-styled:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Input number compacto */
        .input-compact {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-compact input[type="number"] {
            width: 72px;
            text-align: center;
            padding: 10px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1.5px solid var(--border);
            transition: all 0.2s ease;
        }

        .input-compact input[type="number"]:hover {
            border-color: var(--accent);
        }

        .input-compact input[type="number"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .input-compact .suffix {
            font-size: 0.78rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Textarea avancado */
        textarea.textarea-styled {
            padding: 12px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            border: 1.5px solid var(--border);
            min-height: 80px;
            transition: all 0.2s ease;
            line-height: 1.6;
        }

        textarea.textarea-styled:hover {
            border-color: var(--accent);
        }

        textarea.textarea-styled:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        textarea.textarea-styled.textarea-highlight {
            background: var(--accent-glow);
            border-color: var(--accent);
        }

        /* Botao gerar melhorado */
        .btn-convert {
            width: 44px;
            height: 44px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 113, 227, 0.3);
        }

        .btn-convert:hover {
            background: var(--accent-dark);
            transform: scale(1.08);
            box-shadow: 0 4px 14px rgba(0, 113, 227, 0.4);
        }

        .btn-convert:active {
            transform: scale(0.95);
        }

        @media (max-width: 600px) {
            .config-group.span-2 {
                grid-column: span 1;
            }
            .config-section {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 400px) {
            .config-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Hero -->
        <section class="hero">
            <h1 class="hero-title">Roteiros</h1>
            <p class="hero-subtitle">Transforme textos em roteiros profissionais prontos para gravar</p>
        </section>

        <!-- Config Section -->
        <div class="card mb-3">
            <!-- Basico -->
            <div class="config-section">
                <div class="config-group">
                    <label class="config-label-new">Tipo de conteudo</label>
                    <select class="select-styled" id="tipoConteudo">
                        <option value="stories">Stories</option>
                        <option value="reels">Reels / TikTok</option>
                        <option value="youtube">YouTube</option>
                        <option value="venda">Video de Venda</option>
                        <option value="curso">Aula / Curso</option>
                        <option value="institucional">Institucional</option>
                        <option value="podcast">Podcast</option>
                    </select>
                </div>
                <div class="config-group">
                    <label class="config-label-new">Tom</label>
                    <select class="select-styled" id="tomConteudo">
                        <option value="conversacional">Conversacional</option>
                        <option value="amigavel">Amigavel</option>
                        <option value="profissional">Profissional</option>
                        <option value="energetico">Energetico</option>
                        <option value="inspirador">Inspirador</option>
                        <option value="educativo">Educativo</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>
                <div class="config-group">
                    <label class="config-label-new">Videos</label>
                    <div class="input-compact">
                        <input type="number" class="input-styled" id="numVideos" value="1" min="1" max="10">
                        <span class="suffix">video(s)</span>
                    </div>
                </div>
                <div class="config-group">
                    <label class="config-label-new">Duracao</label>
                    <div class="input-compact">
                        <input type="number" class="input-styled" id="duracaoVideo" value="60" min="15" max="600" step="15">
                        <span class="suffix">seg</span>
                    </div>
                </div>
                <div class="config-group">
                    <label class="config-label-new">Formato de saida</label>
                    <select class="select-styled" id="formatoSaida">
                        <option value="script">Script (so a fala)</option>
                        <option value="cenas" selected>Cenas (dividida)</option>
                        <option value="direcao">Cenas + Direcao</option>
                    </select>
                </div>
            </div>

            <!-- Accordion Avancado -->
            <div class="config-accordion">
                <button class="config-accordion-toggle" onclick="toggleAvancado()" id="toggleAvancado">
                    <div class="toggle-left">
                        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        Avancado
                    </div>
                    <svg class="toggle-arrow" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <div class="config-accordion-body" id="avancadoBody">
                    <div class="config-section" style="margin-bottom: 14px;">
                        <div class="config-group">
                            <label class="config-label-new">Seu nome / Canal</label>
                            <input type="text" class="input-styled" id="nomeCanal" placeholder="Ex: Maria Silva">
                        </div>
                        <div class="config-group">
                            <label class="config-label-new">Assunto do video</label>
                            <input type="text" class="input-styled" id="assuntoVideo" placeholder="Ex: Marketing Digital">
                        </div>
                        <div class="config-group">
                            <label class="config-label-new">Plataforma</label>
                            <select class="select-styled" id="redeSocial">
                                <option value="ensinonacional" selected>Ensino Nacional</option>
                                <option value="instagram">Instagram</option>
                                <option value="tiktok">TikTok</option>
                                <option value="youtube">YouTube</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="facebook">Facebook</option>
                                <option value="twitter">X / Twitter</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 10px;">Elementos do Roteiro</div>

                    <div class="config-section" style="margin-bottom: 14px;">
                        <div class="config-group">
                            <label class="config-label-new">Tipo de gancho</label>
                            <select class="select-styled" id="tipoGancho">
                                <option value="nenhum" selected>Sem gancho</option>
                                <option value="duvida">Gerar duvida</option>
                                <option value="desafio">Desafiar o espectador</option>
                                <option value="storytelling">Storytelling / Historia</option>
                                <option value="estatistica">Estatistica impactante</option>
                                <option value="pergunta">Pergunta direta</option>
                                <option value="controverso">Afirmacao controversa</option>
                                <option value="problema">Apresentar problema</option>
                                <option value="curiosidade">Despertar curiosidade</option>
                                <option value="promessa">Promessa de resultado</option>
                                <option value="erro">Erro comum</option>
                                <option value="segredo">Revelar segredo</option>
                                <option value="urgencia">Criar urgencia</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label class="config-label-new">Chamada para acao (CTA)</label>
                            <select class="select-styled" id="tipoCTA">
                                <option value="nenhum" selected>Sem CTA</option>
                                <option value="comentar">Comenta aqui</option>
                                <option value="curtir">Curte esse video</option>
                                <option value="compartilhar">Compartilha com alguem</option>
                                <option value="seguir">Segue para mais</option>
                                <option value="inscrever">Se inscreve no canal</option>
                                <option value="salvar">Salva para depois</option>
                                <option value="link">Clica no link da bio</option>
                                <option value="proxima">Veja a proxima aula</option>
                                <option value="ativar">Ativa as notificacoes</option>
                                <option value="baixar">Baixa o material</option>
                                <option value="comprar">Garanta o seu agora</option>
                                <option value="contato">Chama no direct/WhatsApp</option>
                                <option value="marcar">Marca um amigo</option>
                            </select>
                        </div>
                    </div>

                    <div class="config-group" style="margin-bottom: 14px;">
                        <label class="config-label-new highlight">Pontos cruciais - O que nao pode faltar</label>
                        <textarea class="textarea-styled textarea-highlight" id="pontosCruciais" placeholder="Ex: Mencionar o desconto de 50%, mostrar o antes e depois, falar do prazo limitado..."></textarea>
                    </div>

                    <!-- TREND -->
                    <div class="section-title">üî• Trend Viral</div>
                    <div class="config-section">
                        <div class="config-group">
                            <label class="config-label-new">Usar Trend</label>
                            <select class="select-styled" id="usarTrend">
                                <option value="nao" selected>Nao usar trend</option>
                                <option value="sim">Adaptar para trend atual</option>
                            </select>
                        </div>
                        <div class="config-group" id="tipoTrendGroup" style="display: none;">
                            <label class="config-label-new">Tipo de Trend</label>
                            <select class="select-styled" id="tipoTrend">
                                <option value="audio">Audio/Musica Viral</option>
                                <option value="formato">Formato de Video (POV, Get Ready, etc)</option>
                                <option value="desafio">Desafio/Challenge</option>
                                <option value="meme">Meme/Referencia</option>
                                <option value="transicao">Transicao Criativa</option>
                            </select>
                        </div>
                        <div class="config-group" id="referenciaTrendGroup" style="display: none;">
                            <label class="config-label-new">Referencia (opcional)</label>
                            <input type="text" class="input-styled" id="referenciaTrend" placeholder="Ex: nome do audio ou trend especifica">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translator -->
        <div class="translator">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Texto original</span>
                    <div class="panel-actions">
                        <button class="btn-icon" onclick="colarTexto()" title="Colar">
                            <svg viewBox="0 0 24 24"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
                        </button>
                        <button class="btn-icon" onclick="limparTexto()" title="Limpar">
                            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="panel-body">
                    <textarea class="main-textarea" id="inputText" placeholder="Cole aqui o texto que voce quer transformar em roteiro...

Pode ser uma ideia, um artigo, uma transcricao ou qualquer conteudo que voce queira adaptar para video."></textarea>
                </div>
            </div>

            <div class="center-action">
                <button class="btn-convert" onclick="gerarRoteiro()" title="Gerar Roteiro" id="btnConvert">
                    <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
                </button>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Roteiro gerado</span>
                    <div class="panel-actions">
                        <button class="btn-icon" onclick="copiarRoteiro()" title="Copiar">
                            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="output-area" id="outputArea">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg>
                            <p>Seu roteiro aparecera aqui</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Refine Panel -->
        <div class="refine-panel" id="refinePanel">
            <div class="refine-header">
                <div class="refine-title">
                    <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                    Aprimorar Roteiro
                </div>
                <div class="refine-counter">
                    Refinamentos: <span id="refineCount">0</span>/3
                </div>
            </div>
            <div class="refine-body">
                <p class="text-muted">Selecione o tipo de melhoria ou descreva o que deseja ajustar:</p>

                <div class="refine-options" id="refineOptions">
                    <div class="refine-chip" data-refine="mais-curto">Mais curto</div>
                    <div class="refine-chip" data-refine="mais-longo">Mais detalhado</div>
                    <div class="refine-chip" data-refine="mais-informal">Mais informal</div>
                    <div class="refine-chip" data-refine="mais-formal">Mais formal</div>
                    <div class="refine-chip" data-refine="mais-energia">Mais energia</div>
                    <div class="refine-chip" data-refine="mais-calmo">Mais calmo</div>
                    <div class="refine-chip" data-refine="mais-vendedor">Mais persuasivo</div>
                    <div class="refine-chip" data-refine="mais-educativo">Mais educativo</div>
                    <div class="refine-chip" data-refine="gancho-forte">Gancho mais forte</div>
                    <div class="refine-chip" data-refine="cta-forte">CTA mais forte</div>
                    <div class="refine-chip" data-refine="mais-emocional">Mais emocional</div>
                    <div class="refine-chip" data-refine="mais-direto">Mais direto</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Ou descreva a melhoria:</label>
                    <textarea id="refineCustom" placeholder="Ex: Quero que o gancho seja mais impactante..."></textarea>
                </div>

                <div class="refine-actions">
                    <button class="btn btn-secondary" onclick="fecharRefine()">Cancelar</button>
                    <button class="btn btn-primary" id="btnApplyRefine" onclick="aplicarRefinamento()">
                        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        Aplicar Melhoria
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/common.js"></script>
    <script src="../js/config.js"></script>
    <script>
        // Renderizar header
        renderHeader('roteiros');

        // ==================== CONTROLE DE TREND ====================
        document.getElementById('usarTrend').addEventListener('change', function() {
            const usarTrend = this.value === 'sim';
            document.getElementById('tipoTrendGroup').style.display = usarTrend ? 'block' : 'none';
            document.getElementById('referenciaTrendGroup').style.display = usarTrend ? 'block' : 'none';
        });

        // ==================== CONTROLE DO ACCORDION ====================

        function toggleAvancado() {
            const toggle = document.getElementById('toggleAvancado');
            const body = document.getElementById('avancadoBody');
            toggle.classList.toggle('open');
            body.classList.toggle('open');
        }

        // ==================== CONFIGURACOES ====================

        // ==================== CONFIGURACOES DE TIPOS DE VIDEO ====================
        const tiposVideoConfig = {
            stories: {
                nome: 'Stories',
                descricao: 'Conex√£o, proximidade e persuas√£o',
                instrucoes: `STORIES ‚Äî CONVERSA √çNTIMA COM ESTRAT√âGIA

=== FILOSOFIA ===
Stories √© o formato mais HUMANO das redes sociais. A pessoa est√° ali, no sof√°, vendo quem ela segue. Voc√™ precisa parecer algu√©m que ela conhece, que entrou pra contar algo que acabou de descobrir.

MAS por tr√°s dessa naturalidade existe ESTRAT√âGIA. Cada story tem um objetivo: gerar conex√£o, construir autoridade, criar desejo ou levar pra a√ß√£o.

=== NATURALIDADE + PERSUAS√ÉO ===
- Fale como se tivesse pegado o celular pra contar algo pra um amigo pr√≥ximo, mas com inten√ß√£o por tr√°s de cada frase
- Use gatilhos mentais de forma SUTIL: escassez ("pouca gente sabe"), prova social ("todo mundo que testou"), reciprocidade ("vou te dar de gra√ßa")
- A pessoa n√£o pode PERCEBER que est√° sendo persuadida, ela tem que sentir que est√° recebendo valor genu√≠no
- Mostre bastidores, vulnerabilidade e opini√£o, essas s√£o as armas mais fortes do stories porque geram CONFIAN√áA

=== CONTE√öDO DE VALOR REAL (N√ÉO ENROLA√á√ÉO) ===
- Cada story precisa entregar algo: um insight, uma dica pr√°tica, um ponto de vista diferente, uma informa√ß√£o que a pessoa n√£o tinha
- PROIBIDO: stories gen√©ricos tipo "bom dia gente" ou "t√¥ aqui pra falar sobre X"
- A pessoa tem que sair pensando "que dica boa" ou "nunca tinha pensado nisso"
- Se n√£o tem valor real, n√£o poste. Menos conte√∫do bom > muito conte√∫do vazio

=== ESTRUTURA DE RETEN√á√ÉO ===
- Story 1: Gancho que gera curiosidade ("deixa eu te contar uma coisa que descobri...")
- Stories do meio: Entrega de valor com loops abertos ("e o melhor vem agora...")
- Story final: CTA natural que n√£o parece venda ("se isso fez sentido, me manda um üî•")

=== O QUE N√ÉO FAZER ===
- N√ÉO soe como vendedor, soe como amigo que recomenda
- N√ÉO enrole, v√° direto ao ponto com naturalidade
- N√ÉO seja gen√©rico, cada frase precisa ter peso e prop√≥sito`
            },
            reels: {
                nome: 'Reels / TikTok',
                descricao: 'Magn√©tico, humano e estrat√©gico',
                instrucoes: `REELS / TIKTOK ‚Äî CONTE√öDO MAGN√âTICO COM ESTRAT√âGIA DE RETEN√á√ÉO

=== FILOSOFIA ===
O Reels n√£o √© uma aula, n√£o √© um pitch, √© uma CONVERSA que prende. Voc√™ est√° falando com UMA pessoa, como se ela estivesse na sua frente. O objetivo √© que ela saia pensando "nossa, eu n√£o sabia disso", salve o v√≠deo e queira ver o pr√≥ximo.

A diferen√ßa entre um Reels que bomba e um que morre √©: CONTE√öDO DE VALOR REAL + ENTREGA HUMANA + ESTRUTURA DE RETEN√á√ÉO. Tem muito criador entregando embalagem bonita sem nada dentro. Voc√™ entrega subst√¢ncia.

=== OS PRIMEIROS 2-3 SEGUNDOS (DECISIVOS) ===
A pessoa est√° scrollando. Voc√™ tem 2 segundos pra fazer ela PARAR. O gancho precisa ser IRRESIST√çVEL:
- Comece pelo RESULTADO ou dado mais impactante, nunca pela introdu√ß√£o
- Crie um LOOP ABERTO: a pessoa PRECISA saber o que vem depois
- Use PATTERN INTERRUPT: algo inesperado que quebra o padr√£o do feed
- Tom de voz diferente do resto: mais baixo (segredo), mais alto (urg√™ncia), ou pausa antes de falar

Ganchos que FUNCIONAM em 2025:
- Come√ßar com a CONSEQU√äNCIA: "Isso aqui fez eu perder 3 meses, e ningu√©m me avisou"
- Usar CONTRASTE: "Todo mundo faz X, mas o certo √© Y, e eu vou te provar"
- PROVOCA√á√ÉO inteligente: "Se voc√™ ainda faz isso, para agora"
- CURIOSIDADE pura: "Tem um detalhe aqui que muda tudo, e quase ningu√©m percebe"

=== TOM HUMANO COM INTEN√á√ÉO ESTRAT√âGICA ===
- Fale PARA a pessoa, n√£o SOBRE o assunto. Use "voc√™" o tempo todo
- Seja VULNER√ÅVEL quando fizer sentido: "eu tamb√©m errava nisso", "demorei pra entender"
- Crie a sensa√ß√£o de SEGREDO COMPARTILHADO: "pouca gente sabe disso, mas..."
- Alterne entre INFORMA√á√ÉO e CONEX√ÉO EMOCIONAL: dado ‚Üí reflex√£o ‚Üí dado ‚Üí provoca√ß√£o
- Use gatilhos mentais SUTIS: autoridade ("depois de X anos fazendo isso"), escassez ("isso pouca gente ensina"), prova social ("quem aplicou isso viu resultado")

=== CONTE√öDO DE VALOR REAL ‚Äî A PARTE MAIS IMPORTANTE ===
- A pessoa tem que aprender algo que N√ÉO acharia facilmente no Google
- Traga a perspectiva de quem VIVEU aquilo, n√£o de quem leu sobre
- D√™ INFORMA√á√ÉO ESPEC√çFICA: n√∫meros, dados, exemplos reais, compara√ß√µes concretas
- PROIBIDO frases gen√©ricas tipo "√© muito importante", "voc√™ precisa saber", "faz toda diferen√ßa"
- Cada frase precisa ter SUBST√ÇNCIA. Se tirar a frase e o v√≠deo fica igual, ela n√£o deveria estar ali
- A pessoa deve terminar o v√≠deo MAIS INTELIGENTE do que come√ßou

=== ESTRUTURA DE RETEN√á√ÉO (MARKETING) ===
Cada cena precisa ter um MOTIVO para a pessoa continuar assistindo:
- Cena 1 (Gancho): Loop aberto que gera curiosidade IMEDIATA
- Cena 2 (Contexto): D√° informa√ß√£o mas abre OUTRO loop ‚Äî nunca entregue tudo de uma vez
- Cena 3+ (Valor): Entrega conte√∫do de forma surpreendente, com micro-ganchos entre cenas
- Cena final (Fechamento): Frase de impacto + CTA que gera a√ß√£o natural

=== GATILHOS DE ENGAJAMENTO (ALGORITMO) ===
- COMPARTILHAMENTO: "preciso mandar isso pra algu√©m" ‚Üí conte√∫do que resolve problema comum
- SALVAMENTO: "vou precisar rever isso" ‚Üí conte√∫do com passos ou dados densos
- COMENT√ÅRIO: termine com algo que gera OPINI√ÉO ou IDENTIFICA√á√ÉO
- REPLAY: revele algo surpreendente no final que faz querer rever
- Evite dar a resposta completa no in√≠cio (mant√©m reten√ß√£o at√© o final)

=== O QUE N√ÉO FAZER ===
- N√ÉO comece com "Oi gente" ou "Fala galera" ‚Äî perde 50% da audi√™ncia nos 2 primeiros segundos
- N√ÉO diga "nesse v√≠deo vou te ensinar" ‚Äî comece ENSINANDO direto
- N√ÉO use tom de palestrante ou professor formal ‚Äî soe como gente de verdade
- N√ÉO enrole: se uma frase n√£o adiciona valor, corte
- N√ÉO seja gen√©rico: cada frase precisa ter PESO, DADO ou INSIGHT
- N√ÉO copie formato dos outros sem adicionar sua perspectiva √∫nica`
            },
            youtube: {
                nome: 'YouTube',
                descricao: 'Profundidade com estrat√©gia',
                instrucoes: `YOUTUBE ‚Äî CONTE√öDO PROFUNDO COM RETEN√á√ÉO ESTRAT√âGICA

=== FILOSOFIA ===
No YouTube voc√™ tem mais tempo, e isso √© uma ARMA, n√£o uma desculpa pra enrolar. Cada minuto precisa justificar a pessoa estar ali em vez de ver outro v√≠deo. O diferencial √© PROFUNDIDADE com RITMO.

=== ESTRUTURA DE RETEN√á√ÉO PARA YOUTUBE ===
- Primeiros 30 segundos: GANCHO + PROMESSA clara do que a pessoa vai aprender
- N√£o diga "antes de come√ßar, se inscreve" ‚Äî entregue valor PRIMEIRO, pe√ßa depois
- A cada 2-3 minutos: crie um MICRO-GANCHO ("e agora vem a parte que ningu√©m fala...")
- Use OPEN LOOPS: antecipe o que vem depois sem revelar ("daqui a pouco eu vou te mostrar algo que muda tudo isso")
- Fechamento: resuma o valor entregue + CTA natural

=== CONTE√öDO DE VALOR + PERSUAS√ÉO ===
- Desenvolva cada ponto com PROFUNDIDADE: contexto ‚Üí explica√ß√£o ‚Üí exemplo real ‚Üí aplica√ß√£o pr√°tica
- Use STORYTELLING estrat√©gico: conte hist√≥rias que ilustrem o ponto E conectem emocionalmente
- Traga dados, pesquisas e refer√™ncias que a pessoa n√£o encontraria sozinha
- Conecte os pontos de forma que a pessoa sinta que est√° montando um quebra-cabe√ßa
- A pessoa deve sair pensando "esse canal entrega mais que curso pago"

=== TOM HUMANO ===
- Fale como algu√©m que domina o assunto e quer genuinamente ajudar
- Seja direto, sem rodeios, sem enrola√ß√£o, respeitando o tempo da pessoa
- Use humor NATURAL quando couber, nunca for√ßado
- Mostre vulnerabilidade quando relevante: erros, aprendizados, mudan√ßas de opini√£o`
            },
            venda: {
                nome: 'Video de Venda',
                descricao: 'Persuas√£o com valor real',
                instrucoes: `V√çDEO DE VENDA ‚Äî PERSUAS√ÉO BASEADA EM VALOR E EMPATIA

=== FILOSOFIA ===
A pessoa tem um problema, voc√™ tem a solu√ß√£o. Mas ela n√£o quer ser VENDIDA, ela quer ser CONVENCIDA. A melhor venda acontece quando a pessoa sente que DESCOBRIU a solu√ß√£o sozinha, voc√™ s√≥ mostrou o caminho.

=== ESTRUTURA PERSUASIVA (MARKETING) ===
1. IDENTIFICA√á√ÉO: Mostre que voc√™ ENTENDE a dor dela melhor do que ela mesma ("sabe quando voc√™ tenta X e parece que nada funciona?")
2. AGITA√á√ÉO: Amplifique o problema com consequ√™ncias reais ("e o pior √© que quanto mais tempo passa, mais dif√≠cil fica")
3. AUTORIDADE: Mostre por que VOC√ä pode ajudar, com provas ("depois de ajudar X pessoas com isso, eu percebi um padr√£o")
4. SOLU√á√ÉO: Apresente a solu√ß√£o focando em TRANSFORMA√á√ÉO, n√£o em features ("o que muda √© que voc√™ vai de X pra Y")
5. PROVA: Resultados concretos, depoimentos, antes e depois
6. CTA: Urg√™ncia REAL, n√£o fake. Escassez VERDADEIRA, n√£o inventada

=== GATILHOS MENTAIS (USE COM √âTICA) ===
- RECIPROCIDADE: Entregue valor ANTES de pedir algo
- PROVA SOCIAL: Mostre que outros j√° fizeram e deu certo
- AUTORIDADE: Demonstre conhecimento profundo, n√£o s√≥ t√≠tulos
- ESCASSEZ: S√≥ use se for REAL (vagas limitadas, b√¥nus por tempo)
- ANTECIPA√á√ÉO: Crie expectativa sobre o que a pessoa vai conquistar

=== CONTE√öDO DE VALOR MESMO NA VENDA ===
- O v√≠deo de venda deve ENSINAR algo mesmo pra quem n√£o comprar
- PROIBIDO: press√£o fake, contagem regressiva inventada, "√∫ltimas vagas" mentira
- A pessoa deve pensar "se o conte√∫do gr√°tis √© assim, imagina o pago"
- Fale dos BENEF√çCIOS e da TRANSFORMA√á√ÉO, n√£o das caracter√≠sticas do produto`
            },
            curso: {
                nome: 'Aula / Curso',
                descricao: 'Ensinar de verdade',
                instrucoes: `AULA / CURSO ‚Äî ENSINO COM PROFUNDIDADE E CLAREZA

=== FILOSOFIA ===
O aluno est√° ali pra APRENDER. Seu trabalho √© pegar o conte√∫do t√©cnico e transformar em algo que ele vai entender, lembrar e aplicar. Fale como professor que ama o assunto e quer genuinamente que o aluno domine aquilo.

=== ABORDAGEM ===
- O texto j√° tem os detalhes t√©cnicos, o aluno j√° leu
- Seu trabalho √© trazer o que √© interessante, o que surpreende, o que conecta
- Cada v√≠deo tem que ensinar algo que a pessoa vai lembrar
- Use analogias do dia a dia pra explicar conceitos complexos
- Estrutura: o que √© ‚Üí por que importa ‚Üí como funciona ‚Üí exemplo pr√°tico ‚Üí resumo

=== TOM ===
- Professor acess√≠vel que domina o assunto
- Paciente mas nunca enrolado
- Respeita a intelig√™ncia do aluno
- Sem jarg√£o desnecess√°rio, sem simplificar demais`
            },
            institucional: {
                nome: 'Institucional',
                descricao: 'Profissional e humano',
                instrucoes: `INSTITUCIONAL ‚Äî PROFISSIONAL MAS ACESS√çVEL

=== FILOSOFIA ===
Transmitir confian√ßa e credibilidade sem soar rob√≥tico ou corporativo. A empresa √© feita de PESSOAS, e pessoas se conectam com pessoas.

=== ABORDAGEM ===
- Mostre o valor da empresa de forma clara e tang√≠vel
- Linguagem mais cuidada, mas ainda humana e acess√≠vel
- Foque nos RESULTADOS e no IMPACTO, n√£o em frases corporativas vazias
- Use dados concretos e exemplos reais
- A pessoa deve pensar "essa empresa sabe o que faz e se importa de verdade"`
            },
            podcast: {
                nome: 'Podcast',
                descricao: 'Conversa profunda com prop√≥sito',
                instrucoes: `PODCAST ‚Äî CONVERSA PROFUNDA COM ESTRAT√âGIA

=== FILOSOFIA ===
Podcast √© o formato mais √çNTIMO de conte√∫do. A pessoa est√° com fone de ouvido, √© como se voc√™ estivesse falando direto no ouvido dela. Use isso a seu favor.

=== NATURALIDADE + INTEN√á√ÉO ===
- √â uma conversa, pode divagar um pouco, contar hist√≥ria, dar opini√£o forte
- Ritmo mais tranquilo, como se estivesse tomando um caf√© com a pessoa
- MAS cada divaga√ß√£o tem um PROP√ìSITO: ilustrar um ponto, gerar conex√£o ou criar curiosidade
- Aprofunde no que √© interessante, n√£o passe r√°pido pelo que tem valor

=== CONTE√öDO DE VALOR ===
- Podcast √© o formato onde voc√™ pode ir MAIS FUNDO em um assunto
- Traga perspectivas √∫nicas, experi√™ncias pessoais, bastidores, opini√µes controversas (com fundamento)
- A pessoa deve terminar o epis√≥dio sentindo que ganhou algo: uma ideia nova, uma perspectiva diferente, uma motiva√ß√£o real
- PROIBIDO enrola√ß√£o: se n√£o tem nada de valor pra dizer, termine

=== ENGAJAMENTO ===
- Fa√ßa perguntas ret√≥ricas que a pessoa responde mentalmente
- Conte hist√≥rias com arcos narrativos: setup ‚Üí conflito ‚Üí resolu√ß√£o ‚Üí aprendizado
- Deixe ganchos pro pr√≥ximo epis√≥dio de forma natural`
            }
        };

        // ==================== CONFIGURACOES DE TONS ====================
        const tonsConfig = {
            conversacional: {
                nome: 'Conversacional',
                instrucoes: `Fale como se estivesse num caf√© com a pessoa. √â uma CONVERSA, n√£o uma apresenta√ß√£o.
Usa "voc√™", "a gente", "olha s√≥", "a real √© que", "sabe o que eu percebi".
Varia o ritmo: √†s vezes acelera quando t√° empolgado, √†s vezes pausa pra dar peso.
Mostre que voc√™ √© GENTE: conte experi√™ncias, admita erros, tenha opini√£o.
A pessoa tem que esquecer que est√° vendo um conte√∫do e sentir que est√° conversando com algu√©m interessante.
Use humor natural quando couber, nunca for√ßado.`
            },
            amigavel: {
                nome: 'Amigavel',
                instrucoes: `Tom acolhedor de quem est√° ali pra ajudar DE VERDADE.
Demonstra empatia REAL: reconhece a dificuldade antes de dar a solu√ß√£o ("eu sei que isso parece confuso, mas fica comigo").
Passa seguran√ßa: "√© mais simples do que parece", "voc√™ vai ver que faz sentido".
Nunca julga, nunca pressiona. √â como aquele amigo que tem paci√™ncia e explica at√© voc√™ entender.
A pessoa tem que se sentir ACOLHIDA e CAPAZ ao mesmo tempo.`
            },
            profissional: {
                nome: 'Profissional',
                instrucoes: `Linguagem polida mas NUNCA rob√≥tica. Transmite autoridade com NATURALIDADE.
Vocabul√°rio preciso mas acess√≠vel. Sem jarg√£o desnecess√°rio.
Estrutura l√≥gica: apresenta o ponto, desenvolve com clareza, conclui com firmeza.
Passa credibilidade: usa dados, pesquisas, exemplos concretos e refer√™ncias.
O tom √© de algu√©m que DOMINA o assunto e n√£o precisa provar nada ‚Äî s√≥ mostra com evid√™ncias.
Ainda assim, √© humano. Tem opini√£o, tem posicionamento, tem personalidade.`
            },
            energetico: {
                nome: 'Energetico',
                instrucoes: `Ritmo DIN√ÇMICO com varia√ß√£o. N√£o √© gritar o tempo todo, √© saber quando EXPLODIR e quando fazer PAUSA.
Come√ßa com IMPACTO: uma frase curta e certeira que prende.
Transmite urg√™ncia positiva: "isso muda o jogo", "presta aten√ß√£o nesse detalhe".
Empolga√ß√£o GENU√çNA de quem descobriu algo e quer compartilhar.
Alterne entre energia alta e pausa dram√°tica pra dar contraste e manter aten√ß√£o.
A pessoa tem que sentir sua empolga√ß√£o e pensar "se ele t√° t√£o animado, deve ser bom".`
            },
            inspirador: {
                nome: 'Inspirador',
                instrucoes: `Conecta com o SONHO da pessoa, mas com os P√âS NO CH√ÉO.
Alterna entre realidade (problema atual) e vis√£o (onde ela pode chegar). Mostra o CAMINHO, n√£o s√≥ o destino.
Usa hist√≥rias REAIS: de quem j√° fez, de como voc√™ come√ßou, de erros que viraram acertos.
PROIBIDO autoajuda gen√©rica. Cada frase inspiradora precisa ter um EXEMPLO CONCRETO junto.
A pessoa deve sair pensando "eu consigo, e agora eu sei COMO". N√£o s√≥ "que bonito".
√â sobre possibilidade REAL baseada em evid√™ncia, n√£o em wishful thinking.`
            },
            educativo: {
                nome: 'Educativo',
                instrucoes: `Tom de quem AMA o assunto e quer genuinamente que o outro aprenda.
Explica de forma SIMPLES sem simplificar demais. Usa analogias do dia a dia.
Estrutura: o que √© ‚Üí por que importa ‚Üí como funciona ‚Üí exemplo pr√°tico.
Antecipa d√∫vidas: "voc√™ pode estar pensando 'mas e se...' ‚Äî e √© a√≠ que entra o ponto".
D√° aquela sensa√ß√£o de "nossa, n√£o sabia disso" ‚Äî conte√∫do de VALOR REAL.
Paciente mas nunca enrolado. Respeita a intelig√™ncia da pessoa.`
            },
            urgente: {
                nome: 'Urgente',
                instrucoes: `Direto no ponto. Zero enrola√ß√£o. Cada segundo conta.
Come√ßa com impacto: "Presta aten√ß√£o", "Isso √© s√©rio", "Para tudo".
Tom firme com AUTORIDADE, n√£o desespero. A urg√™ncia vem da IMPORT√ÇNCIA do assunto, n√£o de gritar.
Frases certeiras com dados concretos. Sem floreio, sem introdu√ß√£o longa.
Mostra consequ√™ncia real: "se voc√™ n√£o fizer isso, vai acontecer X".
A pessoa tem que sentir que PRECISA agir, n√£o que est√° sendo manipulada.`
            }
        };

        const ganchosConfig = {
            nenhum: { texto: '', visual: '' },
            duvida: { texto: 'Gere uma d√∫vida genu√≠na na cabe√ßa da pessoa sobre algo que ela acha que sabe, mas n√£o sabe direito', visual: 'Express√£o de d√∫vida' },
            desafio: { texto: 'Desafie o espectador a questionar algo que ele faz no autom√°tico, mostrando que existe um jeito melhor', visual: 'Express√£o desafiadora' },
            storytelling: { texto: 'Comece contando uma situa√ß√£o real e espec√≠fica que o espectador se identifique, como se fosse um bastidor', visual: 'Close no rosto, tom √≠ntimo' },
            estatistica: { texto: 'Abra com um dado ou n√∫mero impactante e REAL que fa√ßa a pessoa parar pra pensar', visual: 'N√∫mero grande na tela' },
            pergunta: { texto: 'Fa√ßa uma pergunta direta e espec√≠fica que a pessoa responde mentalmente com "√©, eu tamb√©m..."', visual: 'Express√£o curiosa' },
            controverso: { texto: 'Comece com uma afirma√ß√£o que vai contra o senso comum, mas que voc√™ vai provar com argumentos s√≥lidos', visual: 'Express√£o s√©ria, pausa antes de falar' },
            problema: { texto: 'Descreva um problema espec√≠fico que a pessoa vive, com tanta precis√£o que ela pense "ele t√° falando de mim"', visual: 'Express√£o emp√°tica' },
            curiosidade: { texto: 'Crie um loop aberto irresist√≠vel, mencionando algo surpreendente que s√≥ vai ser revelado no decorrer do v√≠deo', visual: 'Suspense, pausa dram√°tica' },
            promessa: { texto: 'Fa√ßa uma promessa concreta e espec√≠fica do que a pessoa vai aprender ou ganhar at√© o final do v√≠deo', visual: 'Tom confiante' },
            erro: { texto: 'Comece pelo erro mais comum e espec√≠fico que as pessoas cometem nesse assunto, mostrando a consequ√™ncia', visual: 'Alerta, tom de quem j√° viu isso acontecer' },
            segredo: { texto: 'Compartilhe algo que pouca gente sabe ou fala sobre, como se fosse informa√ß√£o privilegiada', visual: 'Tom baixo, como segredo, se aproxima da c√¢mera' },
            urgencia: { texto: 'Crie senso de urg√™ncia real sobre o assunto, mostrando por que a pessoa precisa prestar aten√ß√£o AGORA', visual: 'Tom firme, gesto de pare' }
        };

        const ctasConfig = {
            nenhum: { texto: '', visual: '' },
            comentar: { texto: 'Termine com algo que gere opini√£o ou identifica√ß√£o, e convide a pessoa a comentar de forma natural, sem parecer pedido for√ßado', visual: '√çcone de coment√°rio' },
            curtir: { texto: 'Pe√ßa o like de forma natural, conectando com o valor que foi entregue no v√≠deo', visual: 'Cora√ß√£o' },
            compartilhar: { texto: 'Termine de um jeito que a pessoa pense "preciso mandar isso pra algu√©m", e sugira compartilhar naturalmente', visual: '√çcone de compartilhar' },
            seguir: { texto: 'Convide a seguir mencionando o que vem de conte√∫do pr√≥ximo, criando antecipa√ß√£o', visual: 'Bot√£o seguir' },
            inscrever: { texto: 'Pe√ßa inscri√ß√£o conectando com o valor entregue, mostrando que tem mais conte√∫do assim vindo', visual: 'Bot√£o inscrever-se' },
            salvar: { texto: 'Sugira salvar o v√≠deo porque o conte√∫do √© denso e vale rever, de forma natural', visual: '√çcone de salvar' },
            link: { texto: 'Direcione para o link da bio de forma natural, conectando com um pr√≥ximo passo ou material complementar', visual: 'Seta apontando pra cima' },
            proxima: { texto: 'Crie um gancho para a pr√≥xima aula/v√≠deo, deixando curiosidade sobre o que vem a seguir', visual: 'Preview' },
            ativar: { texto: 'Pe√ßa para ativar notifica√ß√µes conectando com conte√∫do futuro que a pessoa n√£o vai querer perder', visual: 'Sino' },
            baixar: { texto: 'Mencione um material complementar gratuito no link, mostrando o valor extra que a pessoa ganha', visual: '√çcone de download' },
            comprar: { texto: 'Fa√ßa o CTA de venda de forma √©tica, focando na transforma√ß√£o e n√£o na press√£o, com urg√™ncia real', visual: 'Bot√£o de compra' },
            contato: { texto: 'Convide a pessoa a chamar no direct/WhatsApp de forma acolhedora, mostrando que quer ajudar', visual: '√çcone de mensagem' },
            marcar: { texto: 'Sugira marcar algu√©m que precisa ver esse conte√∫do, de forma natural e espec√≠fica ao assunto', visual: '√çcone de arroba' }
        };

        // ==================== GERACAO DE ROTEIRO ====================

        async function gerarRoteiro() {
            const texto = document.getElementById('inputText').value.trim();
            const outputArea = document.getElementById('outputArea');
            const btnConvert = document.getElementById('btnConvert');

            if (!texto) {
                outputArea.innerHTML = `
                    <div class="output-placeholder">
                        <svg viewBox="0 0 24 24" style="fill: var(--warning);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <p>Insira um texto para gerar o roteiro</p>
                    </div>
                `;
                return;
            }

            // Verificar API
            if (!APIConfig.key) {
                outputArea.innerHTML = `
                    <div class="output-placeholder">
                        <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <p style="color: var(--error);">API nao configurada</p>
                        <p class="text-muted" style="font-size: 0.85rem;">Entre em contato com o administrador</p>
                    </div>
                `;
                return;
            }

            // Coletar configuracoes
            const nomeCanal = document.getElementById('nomeCanal').value.trim();
            const assunto = document.getElementById('assuntoVideo').value.trim();
            const tipo = document.getElementById('tipoConteudo').value;
            const tom = document.getElementById('tomConteudo').value;
            const rede = document.getElementById('redeSocial').value;
            const numVideos = parseInt(document.getElementById('numVideos').value) || 1;
            const duracaoVideo = parseInt(document.getElementById('duracaoVideo').value) || 60;
            const tipoGancho = document.getElementById('tipoGancho').value;
            const tipoCTA = document.getElementById('tipoCTA').value;
            const pontosCruciais = document.getElementById('pontosCruciais').value.trim();
            let formatoSaida = document.getElementById('formatoSaida').value;

            const isReelsTiktok = (tipo === 'reels' || tipo === 'stories');

            // Configuracoes de Trend
            const usarTrend = document.getElementById('usarTrend').value === 'sim';
            const tipoTrend = document.getElementById('tipoTrend')?.value || 'audio';
            const referenciaTrend = document.getElementById('referenciaTrend')?.value.trim() || '';

            // Mostrar loading
            btnConvert.classList.add('generating');
            outputArea.innerHTML = `
                <div class="output-placeholder">
                    <div class="loading" style="font-size: 3rem;">ü§ñ</div>
                    <p>Gerando roteiro com IA...</p>
                    <p class="text-muted" style="font-size: 0.85rem;">Isso pode levar alguns segundos</p>
                </div>
            `;

            const tipoGanchoTexto = tipoGancho !== 'nenhum' ? ganchosConfig[tipoGancho].texto : '';
            const tipoCTATexto = tipoCTA !== 'nenhum' ? ctasConfig[tipoCTA].texto : '';
            const tipoVideoInfo = tiposVideoConfig[tipo] || tiposVideoConfig.reels;
            const tomInfo = tonsConfig[tom] || tonsConfig.conversacional;

            let systemPrompt = `Voc√™ √© um COMUNICADOR que domina o assunto, entende de marketing e fala como GENTE DE VERDADE. Voc√™ combina conhecimento profundo com uma entrega HUMANA e ESTRAT√âGICA. Cada palavra tem prop√≥sito: ou ensina algo, ou conecta emocionalmente, ou persuade de forma √©tica.

=== SEU ESTILO ===

Voc√™ N√ÉO √© um rob√¥ que despeja informa√ß√£o. Voc√™ √© algu√©m que VIVEU o assunto, entende as dores da audi√™ncia e sabe como transformar conhecimento em CONTE√öDO QUE PRENDE.

Sua arma principal √©: CONTE√öDO DE VALOR REAL. Num mundo onde todo mundo fala e poucos entregam, voc√™ entrega SUBST√ÇNCIA. A pessoa tem que sair do seu conte√∫do MAIS INTELIGENTE do que entrou.

Voc√™ usa estrat√©gia de marketing e persuas√£o de forma NATURAL e √âTICA. N√£o √© manipula√ß√£o, √© comunica√ß√£o inteligente: saber quando criar curiosidade, quando gerar identifica√ß√£o, quando provocar e quando entregar.

Voc√™ transmite confian√ßa porque DOMINA o assunto, e gera conex√£o porque fala como uma pessoa de verdade, com vulnerabilidade, opini√£o e personalidade.

=== TIPO DE V√çDEO: ${tipoVideoInfo.nome.toUpperCase()} ===
${tipoVideoInfo.instrucoes}

=== TOM: ${tomInfo.nome.toUpperCase()} ===
${tomInfo.instrucoes}

=== REGRAS DE ESCRITA ===

1. ACENTOS CORRETOS - OBRIGAT√ìRIO
   - "voc√™", "√©", "ent√£o", "tamb√©m", "a√≠", "at√©"
   - Escreva portugu√™s correto, isso transmite credibilidade

2. FALA FLUIDA PARA TELEPROMPTER ‚Äî REGRA MAIS IMPORTANTE
   - PREFIRA V√çRGULAS em vez de pontos finais. V√≠rgulas criam pausas curtas e d√£o ritmo CONT√çNUO √† fala, como uma conversa real.
   - O ponto final CORTA o racioc√≠nio e deixa a fala rob√≥tica, fragmentada e travada. Use ponto final APENAS quando realmente mudar de assunto ou ideia.
   - CONECTE as frases com v√≠rgulas e conectivos, formando per√≠odos LONGOS e fluidos, como a gente fala de verdade.
   - A cada 2-3 per√≠odos longos, PULE UMA LINHA para respirar.
   - O texto precisa fluir naturalmente quando lido em voz alta, sem paradas bruscas.
   - REGRA: Para cada 1 ponto final, use pelo menos 4-5 v√≠rgulas. A fala deve ser CONT√çNUA.
   - ERRADO: "Isso √© importante. Muita gente n√£o sabe. O problema √© que ningu√©m fala sobre isso."
   - CERTO: "Isso √© importante, e muita gente n√£o sabe, o problema √© que ningu√©m fala sobre isso, e quando voc√™ entende, muda tudo"

3. CONECTIVOS NATURAIS (USE SEMPRE para evitar pontos)
   - "e" para conectar ideias em vez de usar ponto
   - "que" para estender o racioc√≠nio
   - "porque" para justificar sem cortar
   - "ent√£o" para consequ√™ncia
   - "mas" para contraste
   - "s√≥ que" para ressalva
   - "o interessante √© que" para destacar
   - "e isso √© importante porque" para dar peso
   - "e a√≠" para sequ√™ncia natural
   - "ou seja" para explicar de outro jeito

4. TOM HUMANO E NATURAL
   - Fale como GENTE, n√£o como roteiro pronto. A pessoa tem que sentir que est√° ouvindo algu√©m REAL
   - Use "voc√™" o tempo todo, fale PARA a pessoa, n√£o SOBRE o assunto
   - Mostre vulnerabilidade quando fizer sentido: "eu tamb√©m errava nisso", "demorei pra entender"
   - Tenha OPINI√ÉO: gente que n√£o se posiciona n√£o prende ningu√©m
   - PROIBIDO: soar como apresentador de TV, palestrante de palco ou rob√¥ corporativo
   - PROIBIDO: g√≠rias for√ßadas que n√£o s√£o naturais

5. CONTE√öDO DE VALOR REAL ‚Äî REGRA FUNDAMENTAL
   - Num mundo onde TODO MUNDO fala, poucos ENTREGAM. Voc√™ entrega SUBST√ÇNCIA
   - Cada frase precisa ter PESO: ou ensina algo novo, ou muda uma perspectiva, ou d√° um insight pr√°tico
   - PROIBIDO frases gen√©ricas: "√© muito importante", "voc√™ precisa saber", "faz toda diferen√ßa" ‚Äî isso √© ENCHIMENTO
   - Traga DADOS ESPEC√çFICOS, exemplos concretos, compara√ß√µes que a pessoa ENTENDE
   - A pessoa deve terminar o conte√∫do MAIS INTELIGENTE do que come√ßou
   - Se uma frase n√£o adiciona valor real, CORTE. Menos conte√∫do bom > muito conte√∫do vazio

6. ESTRAT√âGIA DE PERSUAS√ÉO (MARKETING √âTICO)
   - Use gatilhos mentais de forma SUTIL e NATURAL: curiosidade, escassez, prova social, autoridade, reciprocidade
   - Crie LOOPS ABERTOS: abra curiosidade que s√≥ fecha mais pra frente
   - Gere IDENTIFICA√á√ÉO antes de ensinar: "sabe quando voc√™ tenta X e n√£o funciona?"
   - A pessoa n√£o pode PERCEBER que est√° sendo persuadida, ela tem que sentir que est√° recebendo valor
   - ANTECIPE obje√ß√µes: "voc√™ pode estar pensando que isso n√£o funciona pra voc√™, mas..."

7. SEM CLICH√äS
   - Nada de "Voc√™ sabia que..."
   - Nada de "J√° parou pra pensar..."
   - Nada de "Nesse v√≠deo vou te ensinar..."
   - Nada de "Isso vai mudar sua vida" sem provar
   - Comece direto no CONTE√öDO, com autoridade e naturalidade

8. T√çTULO E TEXTO DEVEM TER A MESMA FOR√áA ‚Äî REGRA CR√çTICA
   - O t√≠tulo do v√≠deo √© um GANCHO. A primeira frase do texto TEM que ser t√£o forte quanto o t√≠tulo ou MAIS.
   - Se o t√≠tulo cria curiosidade (ex: "O que a Netflix N√ÉO quer que voc√™ saiba"), o texto N√ÉO pode come√ßar com algo fraco e gen√©rico.
   - DUAS OP√á√ïES:
     a) O t√≠tulo FAZ PARTE da fala: a pessoa fala o t√≠tulo como primeira frase e emenda no conte√∫do. Ex: t√≠tulo "O erro que todo mundo comete" ‚Üí fala come√ßa com "Tem um erro que todo mundo comete, e eu aposto que voc√™ j√° fez isso..."
     b) O texto COME√áA com a mesma energia do t√≠tulo: se o t√≠tulo √© forte, a primeira frase do texto precisa ser AINDA MAIS forte, porque √© o que a pessoa vai OUVIR.
   - PROIBIDO: t√≠tulo impactante + texto que come√ßa com pergunta gen√©rica ("Voc√™ j√° passou por isso?"). O texto tem que ENTREGAR na mesma intensidade do t√≠tulo.
   - O t√≠tulo nunca deve ser MELHOR que o in√≠cio do texto. Se o t√≠tulo prende, o texto tem que PRENDER MAIS.

=== TEMPO ===
- 130-150 palavras = 1 minuto falando
- ${duracaoVideo} segundos = ENTRE ${Math.round(duracaoVideo * 2.15)} E ${Math.round(duracaoVideo * 2.5)} PALAVRAS
- CONTE as palavras e respeite o limite

=== EXEMPLO DE NARRATIVA CORRETA (NATURAL + ESTRAT√âGICA + V√çRGULAS) ===

T√≠tulo: "O erro que destr√≥i 90% dos iniciantes"
Fala: "Tem um erro que destr√≥i 90% dos iniciantes, e o pior √© que ningu√©m fala sobre isso, porque parece um detalhe pequeno, mas quando voc√™ entende o que est√° por tr√°s, percebe que √© exatamente o que separa quem avan√ßa de quem fica travado meses no mesmo lugar.

E eu sei disso porque eu cometi esse erro durante muito tempo, e quando algu√©m finalmente me mostrou o que eu estava fazendo de errado, a mudan√ßa foi quase imediata, porque n√£o era sobre fazer mais, era sobre fazer DIFERENTE, e a diferen√ßa √© sutil mas muda tudo.

O ponto √© o seguinte, a maioria das pessoas foca na parte errada do processo, e quando voc√™ corrige isso, os resultados come√ßam a aparecer de forma natural, sem for√ßar nada, e eu vou te mostrar exatamente o que mudar."

PERCEBA: O t√≠tulo FAZ PARTE da fala ‚Äî a primeira frase REPETE e EXPANDE o t√≠tulo. Tom HUMANO (eu cometi, eu sei). V√≠rgulas conectando tudo. CONTE√öDO real. Gancho forte desde a primeira palavra. NUNCA o t√≠tulo √© mais forte que o texto.

Responda em portugu√™s brasileiro COM ACENTOS.
Retorne APENAS JSON, sem markdown.`;

            // Adicionar instru√ß√µes de Trend se ativado
            if (usarTrend) {
                const trendsDescricao = {
                    audio: 'Adapte o roteiro para funcionar com um √ÅUDIO/M√öSICA VIRAL. Sugira um √°udio em alta que combine com o conte√∫do. O texto deve ter ritmo que sincronize com batidas.',
                    formato: 'Use um FORMATO DE V√çDEO VIRAL como POV, Get Ready With Me, Storytime, etc. Estruture o roteiro no formato escolhido.',
                    desafio: 'Adapte para um DESAFIO/CHALLENGE. Crie uma vers√£o educativa de um challenge popular.',
                    meme: 'Use uma REFER√äNCIA DE MEME ATUAL. Adapte um meme popular para passar a mensagem.',
                    transicao: 'Inclua TRANSI√á√ïES CRIATIVAS. Sugira momentos de corte e transi√ß√£o que est√£o em alta.'
                };

                systemPrompt += `

=== MODO TREND VIRAL ATIVADO ===

${trendsDescricao[tipoTrend]}

${referenciaTrend ? `REFER√äNCIA ESPEC√çFICA: "${referenciaTrend}"` : 'Sugira a trend mais adequada para este conte√∫do baseado nas trends virais atuais do Instagram e TikTok.'}

IMPORTANTE SOBRE TRENDS:
- A trend √© o FORMATO, o conte√∫do continua sendo educativo/informativo
- O v√≠deo precisa fazer sentido mesmo para quem n√£o conhece a trend
- Sugira √°udios/formatos que est√£o em alta AGORA
- Indique no campo "trend" do JSON qual trend usar e como aplicar`;
            }

            const userPrompt = `TEXTO BASE PARA TRANSFORMAR EM ROTEIRO:
"""
${texto}
"""

CONFIGURA√á√ïES:
- Tipo de v√≠deo: ${tipoVideoInfo.nome}
- Tom: ${tomInfo.nome}
- Plataforma: ${rede === 'ensinonacional' ? 'Ensino Nacional (plataforma educacional, tom mais did√°tico e profissional)' : rede === 'instagram' ? 'Instagram (linguagem pr√≥xima, visual, engajamento)' : rede === 'tiktok' ? 'TikTok (aut√™ntico, trend-friendly, ganchos fortes)' : rede === 'youtube' ? 'YouTube (profundidade, reten√ß√£o longa, SEO)' : rede === 'linkedin' ? 'LinkedIn (profissional, autoridade, networking)' : rede === 'facebook' ? 'Facebook (compartilh√°vel, acess√≠vel, amplo)' : rede === 'twitter' ? 'X/Twitter (conciso, opini√£o, direto)' : 'Gen√©rico'}
- Quantidade: ${numVideos} v√≠deo(s)
- Dura√ß√£o: ${duracaoVideo} segundos cada
- PALAVRAS POR V√çDEO: entre ${Math.round(duracaoVideo * 2.15)} e ${Math.round(duracaoVideo * 2.5)} palavras (CONTE!)
${tipoGancho !== 'nenhum' ? '- Gancho (' + tipoGancho + '): Comece o v√≠deo com um gancho do tipo "' + ganchosConfig[tipoGancho].texto + '". Adapte ao assunto, N√ÉO use essa frase literalmente, crie uma vers√£o original e espec√≠fica pro conte√∫do.' : '- SEM gancho - come√ßa direto no conte√∫do com autoridade'}
${tipoCTA !== 'nenhum' ? '- CTA (' + tipoCTA + '): Termine com uma chamada para a√ß√£o no estilo "' + ctasConfig[tipoCTA].texto + '". Adapte ao contexto de forma NATURAL, n√£o force.' : '- SEM CTA - termina quando acabar o assunto'}
${pontosCruciais ? '- Incluir obrigatoriamente: ' + pontosCruciais : ''}

COMO ESCREVER O ROTEIRO:

Voc√™ domina esse assunto e sabe se comunicar como gente de verdade. Vai combinar CONHECIMENTO PROFUNDO com ENTREGA HUMANA e ESTRAT√âGIA DE COMUNICA√á√ÉO. A pessoa precisa sentir que est√° aprendendo com algu√©m real, que viveu o assunto e sabe traduzir de forma clara.

REGRAS OBRIGAT√ìRIAS:

1. ACENTOS CORRETOS
   - "voc√™", "√©", "ent√£o", "tamb√©m", "a√≠", "at√©"
   - Portugu√™s correto transmite credibilidade

2. FALA FLUIDA PARA TELEPROMPTER ‚Äî MAIS IMPORTANTE
   - PREFIRA V√çRGULAS em vez de pontos. V√≠rgulas conectam ideias e criam fala CONT√çNUA e natural.
   - Pontos finais CORTAM o racioc√≠nio e deixam a fala rob√≥tica. Use ponto APENAS para mudar de assunto.
   - Para cada 1 ponto, use 4-5 v√≠rgulas. Conecte frases com: "e", "que", "porque", "ent√£o", "mas", "s√≥ que", "ou seja", "e a√≠"
   - A cada 2-3 per√≠odos longos, PULE UMA LINHA para respirar

3. TOM HUMANO E NATURAL
   - Fale como GENTE, n√£o como script pronto. A pessoa tem que sentir que est√° ouvindo algu√©m REAL
   - Use "voc√™", fale PARA a pessoa. Mostre vulnerabilidade quando fizer sentido
   - Tenha OPINI√ÉO e PERSONALIDADE, gente gen√©rica n√£o prende ningu√©m

4. CONTE√öDO DE VALOR REAL + ESTRAT√âGIA
   - Complemente o texto base, n√£o repita o √≥bvio
   - Traga informa√ß√µes ESPEC√çFICAS que surpreendem: dados, exemplos, compara√ß√µes concretas
   - PROIBIDO frases gen√©ricas sem subst√¢ncia ("√© muito importante", "voc√™ precisa saber")
   - Use persuas√£o SUTIL: curiosidade, identifica√ß√£o, loops abertos, prova social
   - Cada frase constr√≥i o racioc√≠nio OU conecta emocionalmente

5. QUANTIDADE: ${Math.round(duracaoVideo * 2.15)} a ${Math.round(duracaoVideo * 2.5)} palavras

EXEMPLO DE NARRATIVA CORRETA (HUMANA + ESTRAT√âGICA + V√çRGULAS):

T√≠tulo: "O que ningu√©m te conta sobre produtividade"
Fala: "O que ningu√©m te conta sobre produtividade √© que o problema n√£o √© falta de disciplina, √© que voc√™ est√° usando o sistema errado, e quando eu entendi isso, tudo mudou, porque eu passei anos achando que o problema era comigo, que eu n√£o era disciplinado o suficiente, mas a real √© que o m√©todo estava errado desde o in√≠cio.

E tem um detalhe aqui que √© a chave de tudo, quando voc√™ para de focar em MAIS horas e come√ßa a focar em MENOS decis√µes, a produtividade dispara, porque o c√©rebro tem energia limitada pra tomar decis√µes, e cada escolha pequena que voc√™ faz durante o dia vai drenando essa energia.

Ent√£o o segredo n√£o √© fazer mais, √© ELIMINAR o que n√£o precisa ser feito, e quando voc√™ monta um sistema que faz isso automaticamente, sobra energia pro que realmente importa, e eu vou te mostrar como."

PERCEBA: T√≠tulo INCORPORADO na fala ‚Äî primeira frase √© o t√≠tulo expandido. Tom HUMANO. V√≠rgulas cont√≠nuas. Dados concretos (energia limitada, decis√µes). O texto NUNCA √© mais fraco que o t√≠tulo.

${formatoSaida === 'script' ? `
FORMATO DE SA√çDA: SCRIPT (S√ì A FALA)
O roteiro √© um TEXTO CORRIDO pronto para ler no teleprompter.
Sem divis√£o de cenas, sem instru√ß√µes visuais. Apenas o que a pessoa vai falar.
Use \\n\\n para separar par√°grafos (pausas naturais na fala).

Retorne em JSON:
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo descritivo",
            "narrativa": "Texto completo da fala.\\n\\nSegundo par√°grafo.\\n\\nTerceiro par√°grafo.",
            "duracao": ${duracaoVideo}${usarTrend ? `,
            "trend": {
                "tipo": "nome/descri√ß√£o da trend",
                "audio_sugerido": "nome do √°udio viral",
                "como_aplicar": "como gravar usando a trend"
            }` : ''}
        }
    ]
}

REGRAS:
- Total de palavras: entre ${Math.round(duracaoVideo * 2.15)} e ${Math.round(duracaoVideo * 2.5)}
- PREFIRA V√çRGULAS em vez de pontos. A fala deve ser CONT√çNUA, conectando ideias com v√≠rgulas e conectivos. Pontos s√≥ para mudar de assunto.
- Use \\n\\n para pausas maiores entre blocos de ideias
- O T√çTULO deve fazer parte da fala ou a fala deve come√ßar com a MESMA FOR√áA do t√≠tulo. NUNCA o t√≠tulo pode ser mais impactante que o in√≠cio do texto.
- Acentos corretos obrigat√≥rios
` : formatoSaida === 'cenas' ? `
FORMATO DE SA√çDA: CENAS (FALA DIVIDIDA)
O v√≠deo √© dividido em CENAS. Cada cena tem a fala e a dura√ß√£o.
O foco √© organizar O QUE FALAR em cada momento do v√≠deo.

${isReelsTiktok ? `
REGRAS REELS/TIKTOK:
- Cena 1 √© o GANCHO ‚Äî a frase que faz a pessoa parar de scrollar
- Cada cena mant√©m a pessoa querendo ver o pr√≥ximo trecho
- A √∫ltima cena fecha com impacto ou CTA natural
` : ''}

Retorne em JSON:
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo descritivo",
            "duracao": ${duracaoVideo},
            "cenas": [
                {
                    "numero": 1,
                    "titulo": "Nome da cena (ex: Gancho, Contexto, Valor, Fechamento)",
                    "fala": "Texto que a pessoa vai falar nesta cena.\\n\\nSegundo par√°grafo se necess√°rio.",
                    "duracao": 10
                }
            ]${usarTrend ? `,
            "trend": {
                "tipo": "nome/descri√ß√£o da trend",
                "audio_sugerido": "nome do √°udio viral",
                "como_aplicar": "como gravar usando a trend"
            }` : ''}
        }
    ]
}

REGRAS DAS CENAS:
- A soma das dura√ß√µes = ${duracaoVideo} segundos
- M√≠nimo 3 cenas, m√°ximo 8 por v√≠deo
- Total de palavras de todas as falas: entre ${Math.round(duracaoVideo * 2.15)} e ${Math.round(duracaoVideo * 2.5)}
- PREFIRA V√çRGULAS em vez de pontos. A fala deve ser CONT√çNUA e fluida, conectando ideias com v√≠rgulas e conectivos. Pontos s√≥ para mudar de assunto.
- O T√çTULO do v√≠deo deve fazer parte da fala da CENA 1 ou a cena 1 deve come√ßar com a MESMA FOR√áA do t√≠tulo. NUNCA o t√≠tulo pode ser mais impactante que a primeira fala.
- Use \\n\\n nos campos "fala" para separar blocos de ideias
- Acentos corretos obrigat√≥rios
` : `
FORMATO DE SA√çDA: CENAS + DIRE√á√ÉO
O v√≠deo √© dividido em CENAS com instru√ß√µes de dire√ß√£o: cen√°rio geral, tom de voz e gancho visual.
O foco √© organizar a fala E dar orienta√ß√µes inteligentes de grava√ß√£o.

CEN√ÅRIO GERAL:
- Defina UM cen√°rio principal para o v√≠deo todo (ex: "Sentado no sof√° com uma caneta na m√£o", "Em p√© no escrit√≥rio", "Close no rosto, fundo desfocado").
- Esse cen√°rio vai no campo "cenario" do v√≠deo (n√≠vel v√≠deo, N√ÉO n√≠vel cena).
- S√≥ sugira mudan√ßa de cen√°rio numa cena se for REALMENTE necess√°rio e fizer sentido.

IMPORTANTE ‚Äî SEJA INTELIGENTE COM AS DIRE√á√ïES:
- N√ÉO coloque gancho visual em toda cena. S√≥ quando faz diferen√ßa real.
- O tom de voz N√ÉO precisa ser diferente em toda cena. Mude quando h√° virada emocional real.
- Pense como um diretor de verdade: cada instru√ß√£o existe por um MOTIVO.

${isReelsTiktok ? `
REGRAS REELS/TIKTOK:
- Cena 1 √© o GANCHO ‚Äî aqui SIM vale tom de voz diferente + gancho visual forte
- Cenas do meio: foque no conte√∫do, dire√ß√µes s√≥ quando mudam algo
- Cena final: feche com impacto
` : ''}

Retorne em JSON:
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo descritivo",
            "cenario": "Descri√ß√£o do cen√°rio principal de grava√ß√£o. Ex: Sentado numa poltrona com caderno na m√£o, fundo clean",
            "duracao": ${duracaoVideo},
            "cenas": [
                {
                    "numero": 1,
                    "titulo": "Nome da cena",
                    "fala": "Texto que a pessoa vai falar.\\n\\nSegundo par√°grafo se necess√°rio.",
                    "tom_de_voz": "S√≥ se for DIFERENTE do tom geral. Ex: Mais baixo como segredo, Enf√°tico, Pausado",
                    "gancho_visual": "S√≥ se houver algo ESPEC√çFICO. Ex: Zoom in, Texto na tela, Corte para tela",
                    "duracao": 10
                }
            ]${usarTrend ? `,
            "trend": {
                "tipo": "nome/descri√ß√£o da trend",
                "audio_sugerido": "nome do √°udio viral",
                "como_aplicar": "como gravar usando a trend"
            }` : ''}
        }
    ]
}

REGRAS DAS CENAS + DIRE√á√ÉO:
- A soma das dura√ß√µes = ${duracaoVideo} segundos
- M√≠nimo 3 cenas, m√°ximo 8 por v√≠deo
- Total de palavras: entre ${Math.round(duracaoVideo * 2.15)} e ${Math.round(duracaoVideo * 2.5)}
- PREFIRA V√çRGULAS em vez de pontos. A fala deve ser CONT√çNUA e fluida, conectando ideias com v√≠rgulas e conectivos. Pontos s√≥ para mudar de assunto.
- O T√çTULO do v√≠deo deve fazer parte da fala da CENA 1 ou a cena 1 deve come√ßar com a MESMA FOR√áA do t√≠tulo. NUNCA o t√≠tulo pode ser mais impactante que a primeira fala.
- cenario: UMA sugest√£o de cen√°rio para o v√≠deo inteiro. Espec√≠fico e visual (roupa, posi√ß√£o, objetos).
- tom_de_voz: SOMENTE nas cenas onde o tom MUDA. Se segue o tom geral, use "".
- gancho_visual: SOMENTE quando h√° elemento visual ESPEC√çFICO e NECESS√ÅRIO.
- Acentos corretos obrigat√≥rios
- Use \\n\\n nos campos "fala" para separar blocos de ideias
`}
Posi√ß√µes para o t√≠tulo: [ABERTURA], [FUNDAMENTO], [APROFUNDANDO], [NA PR√ÅTICA], [FECHAMENTO]`;

            try {
                const resposta = await chamarAPI(systemPrompt, userPrompt);

                // Parsear JSON
                let dados;
                try {
                    const jsonLimpo = resposta.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    dados = JSON.parse(jsonLimpo);
                } catch (e) {
                    throw new Error('A IA retornou um formato invalido. Tente novamente.');
                }

                // Renderizar
                let roteiro = `
                    <div class="script-header">
                        <div class="script-title">${assunto || 'Roteiro de Video'}${nomeCanal ? ' - ' + nomeCanal : ''}<span class="ai-badge"><svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>IA</span></div>
                        <div class="script-meta">
                            <span>${numVideos} video${numVideos > 1 ? 's' : ''}</span>
                            <span>${duracaoVideo}s cada</span>
                            <span>${capitalize(tipo)}</span>
                            <span>${capitalize(rede)}</span>
                        </div>
                    </div>
                `;

                if (pontosCruciais) {
                    roteiro += `
                        <div class="important-box">
                            <div class="important-box-title">Nao esquecer</div>
                            <div class="important-box-content">${pontosCruciais}</div>
                        </div>
                    `;
                }

                // Garantir que par√°grafos sejam preservados nos textos
                if (dados.videos) {
                    dados.videos.forEach(video => {
                        if (video.narrativa) {
                            video.narrativa = video.narrativa
                                .replace(/\\n\\n/g, '\n\n')
                                .replace(/\\n/g, '\n');
                        }
                        if (video.cenario) {
                            video.cenario = video.cenario
                                .replace(/\\n\\n/g, '\n\n')
                                .replace(/\\n/g, '\n');
                        }
                        if (video.cenas) {
                            video.cenas.forEach(cena => {
                                if (cena.fala) {
                                    cena.fala = cena.fala
                                        .replace(/\\n\\n/g, '\n\n')
                                        .replace(/\\n/g, '\n');
                                }
                                if (cena.visual) {
                                    cena.visual = cena.visual
                                        .replace(/\\n\\n/g, '\n\n')
                                        .replace(/\\n/g, '\n');
                                }
                            });
                        }
                    });
                }

                videoCounter = 0; // Reseta contador para novos v√≠deos
                dados.videos.forEach(video => {
                    roteiro += renderizarVideoNovo(video, formatoSaida);
                });

                outputArea.innerHTML = roteiro;
                mostrarPainelRefine();

            } catch (error) {
                outputArea.innerHTML = `
                    <div class="output-placeholder">
                        <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <p style="color: var(--error);">Erro ao gerar roteiro</p>
                        <p class="text-muted" style="font-size: 0.85rem;">${error.message}</p>
                        <button onclick="gerarRoteiro()" class="btn btn-primary mt-2">Tentar novamente</button>
                    </div>
                `;
            } finally {
                btnConvert.classList.remove('generating');
            }
        }

        function capitalize(s) {
            return s.charAt(0).toUpperCase() + s.slice(1);
        }

        let videoCounter = 0;

        function renderizarVideoNovo(video, formato) {
            videoCounter++;
            const videoId = `video-narrativa-${videoCounter}`;
            const titulo = video.titulo || `Video ${video.numero}`;
            const narrativa = video.narrativa || '';
            const visual = video.visual || '';
            const duracao = video.duracao || 60;
            const trend = video.trend || null;

            let html = '';

            // Mostrar informa√ß√£o da Trend se existir
            if (trend) {
                html += `
                    <div style="background: linear-gradient(135deg, rgba(244, 114, 182, 0.1), rgba(236, 72, 153, 0.05)); border: 1px solid rgba(244, 114, 182, 0.3); border-radius: 8px; padding: 14px; margin-bottom: 16px;">
                        <div style="font-weight: 700; color: #f472b6; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            üî• Trend: ${trend.tipo || 'Viral'}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">
                            ${trend.audio_sugerido ? `<strong>√Åudio:</strong> ${trend.audio_sugerido}<br>` : ''}
                            ${trend.como_aplicar ? `<strong>Como gravar:</strong> ${trend.como_aplicar}` : ''}
                        </div>
                    </div>
                `;
            }

            if (formato === 'script') {
                // SCRIPT ‚Äî S√≥ a fala, texto corrido
                html += `
                    <div class="scene">
                        <div class="scene-row" style="position: relative;">
                            <button class="btn-edit" onclick="ativarEdicao(this)" title="Editar texto">‚úèÔ∏è</button>
                            <div class="scene-text narration texto-editavel" id="${videoId}" style="white-space: pre-wrap; line-height: 1.8; font-size: 0.95rem; padding: 16px 18px;">${narrativa}</div>
                        </div>
                    </div>
                `;
            } else if ((formato === 'cenas' || formato === 'direcao') && video.cenas && video.cenas.length > 0) {
                // CENAS ou CENAS + DIRE√á√ÉO
                const temDirecao = (formato === 'direcao');
                const cenario = video.cenario || '';

                // Mostrar cen√°rio geral (s√≥ no formato dire√ß√£o)
                if (temDirecao && cenario) {
                    html += `
                    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.05)); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 14px; margin-bottom: 16px; position: relative;">
                        <button class="btn-edit" onclick="ativarEdicao(this)" title="Editar cen√°rio">‚úèÔ∏è</button>
                        <div style="font-weight: 600; color: #22c55e; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; font-size: 0.85rem;">
                            üé¨ Cen√°rio
                        </div>
                        <div class="texto-editavel" style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">${cenario}</div>
                    </div>
                    `;
                }

                html += video.cenas.map((cena, i) => {
                    const isGancho = (i === 0 || (cena.titulo && cena.titulo.toLowerCase().includes('gancho')));
                    const isFechamento = (cena.titulo && cena.titulo.toLowerCase().includes('fecha'));
                    const borderColor = isGancho ? 'var(--warning)' : isFechamento ? 'var(--success)' : 'var(--accent)';

                    let cenaHtml = `
                    <div class="scene" style="border-left: 3px solid ${borderColor}; padding-left: 16px; margin-bottom: 20px; ${isGancho ? 'background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), transparent); border-radius: 0 8px 8px 0; padding: 16px;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: ${isGancho ? 'linear-gradient(135deg, #f59e0b, #ef4444)' : 'var(--gradient-1)'}; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700;">${cena.numero || (i + 1)}</span>
                                <span style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;">${cena.titulo || 'Cena ' + (i + 1)}</span>
                                ${isGancho ? '<span style="background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">DECISIVO</span>' : ''}
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted); background: var(--bg-tertiary); padding: 4px 10px; border-radius: 6px;">‚è± ${cena.duracao || '?'}s</span>
                        </div>`;

                    // Tom de voz ‚Äî s√≥ no formato dire√ß√£o e quando tem conte√∫do real
                    if (temDirecao && cena.tom_de_voz && cena.tom_de_voz.trim() !== '') {
                        cenaHtml += `
                        <div class="scene-row" style="margin-bottom: 10px; position: relative;">
                            <button class="btn-edit btn-edit-small" onclick="ativarEdicao(this)" title="Editar">‚úèÔ∏è</button>
                            <div class="scene-label" style="color: #f472b6;">üéô Tom</div>
                            <div class="scene-text texto-editavel" style="border-color: #f472b6; background: linear-gradient(135deg, rgba(244, 114, 182, 0.08), transparent); font-style: italic; font-size: 0.88rem;">${cena.tom_de_voz}</div>
                        </div>`;
                    }

                    // Gancho visual ‚Äî s√≥ no formato dire√ß√£o e quando tem conte√∫do real
                    if (temDirecao && cena.gancho_visual && cena.gancho_visual.trim() !== '') {
                        cenaHtml += `
                        <div class="scene-row" style="margin-bottom: 10px; position: relative;">
                            <button class="btn-edit btn-edit-small" onclick="ativarEdicao(this)" title="Editar">‚úèÔ∏è</button>
                            <div class="scene-label" style="color: var(--warning);">üëÅ Visual</div>
                            <div class="scene-text texto-editavel" style="border-color: var(--warning); background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), transparent); font-size: 0.88rem;">${cena.gancho_visual}</div>
                        </div>`;
                    }

                    // Fala
                    cenaHtml += `
                        <div class="scene-row" style="position: relative;">
                            <button class="btn-edit" onclick="ativarEdicao(this)" title="Editar fala">‚úèÔ∏è</button>
                            <div class="scene-label narration">üí¨ Fala</div>
                            <div class="scene-text narration texto-editavel" style="white-space: pre-wrap; line-height: 1.7;">${cena.fala}</div>
                        </div>
                    </div>`;

                    return cenaHtml;
                }).join('');

                // Texto completo para copiar (juntar todas as falas)
                html += `<div id="${videoId}" style="display: none;"></div>`;

            } else {
                // Fallback ‚Äî mostra narrativa como script
                html += `
                    <div class="scene">
                        <div class="scene-row" style="position: relative;">
                            <button class="btn-edit" onclick="ativarEdicao(this)" title="Editar texto">‚úèÔ∏è</button>
                            <div class="scene-text narration texto-editavel" id="${videoId}" style="white-space: pre-wrap; line-height: 1.8; font-size: 0.95rem; padding: 16px 18px;">${narrativa}</div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="video-block">
                    <div class="video-header">
                        <span class="video-title">${titulo}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button onclick="copiarNarrativa('${videoId}')" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="white"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                Copiar
                            </button>
                            <span class="video-badge">${duracao}s</span>
                        </div>
                    </div>
                    <div class="video-body">${html}</div>
                </div>
            `;
        }

        function ativarEdicao(btn) {
            // Encontra o texto edit√°vel dentro do mesmo container
            const container = btn.parentElement;
            const texto = container.querySelector('.texto-editavel');

            if (!texto) return;

            // Se j√° est√° editando, desativa
            if (texto.contentEditable === 'true') {
                texto.contentEditable = 'false';
                texto.classList.remove('editando');
                btn.innerHTML = '‚úèÔ∏è';
                btn.title = 'Editar';
                return;
            }

            // Ativa edi√ß√£o
            texto.contentEditable = 'true';
            texto.classList.add('editando');
            texto.focus();
            btn.innerHTML = '‚úì';
            btn.title = 'Concluir edi√ß√£o';

            // Ao clicar fora, desativa edi√ß√£o
            const desativar = (e) => {
                if (!container.contains(e.target)) {
                    texto.contentEditable = 'false';
                    texto.classList.remove('editando');
                    btn.innerHTML = '‚úèÔ∏è';
                    btn.title = 'Editar';
                    document.removeEventListener('click', desativar);
                }
            };

            // Delay para n√£o desativar imediatamente
            setTimeout(() => {
                document.addEventListener('click', desativar);
            }, 100);
        }

        function copiarNarrativa(id) {
            const elemento = document.getElementById(id);
            if (elemento) {
                let texto = elemento.innerText;

                // Se o elemento est√° vazio (formato cenas), pega das falas
                if (!texto.trim()) {
                    const videoBlock = elemento.closest('.video-block');
                    if (videoBlock) {
                        const falas = videoBlock.querySelectorAll('.scene-text.narration.texto-editavel');
                        texto = Array.from(falas).map(f => f.innerText.trim()).join('\n\n');
                    }
                }

                navigator.clipboard.writeText(texto).then(() => {
                    mostrarNotificacao('Roteiro copiado!', 'success');
                });
            }
        }

        // ==================== FUNCOES AUXILIARES ====================

        function limparTexto() {
            document.getElementById('inputText').value = '';
            document.getElementById('outputArea').innerHTML = `
                <div class="output-placeholder">
                    <svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg>
                    <p>Seu roteiro aparecera aqui</p>
                </div>
            `;
            document.getElementById('refinePanel').classList.remove('active');
        }

        async function colarTexto() {
            try {
                const texto = await navigator.clipboard.readText();
                document.getElementById('inputText').value = texto;
            } catch (err) {
                mostrarNotificacao('Nao foi possivel acessar a area de transferencia', 'error');
            }
        }

        function copiarRoteiro() {
            const outputArea = document.getElementById('outputArea');
            const texto = outputArea.innerText;
            if (texto.includes('Seu roteiro aparecera aqui')) {
                mostrarNotificacao('Gere um roteiro primeiro!', 'warning');
                return;
            }
            navigator.clipboard.writeText(texto).then(() => {
                mostrarNotificacao('Roteiro copiado!', 'success');
            });
        }

        // ==================== REFINAMENTO ====================

        let refineCount = 0;
        let selectedRefineOption = null;

        function mostrarPainelRefine() {
            const panel = document.getElementById('refinePanel');
            if (!panel.classList.contains('active')) {
                refineCount = 0;
                updateRefineUI();
            }
            panel.classList.add('active');
        }

        function fecharRefine() {
            document.getElementById('refinePanel').classList.remove('active');
            limparSelecaoRefine();
        }

        function limparSelecaoRefine() {
            document.querySelectorAll('.refine-chip').forEach(chip => chip.classList.remove('selected'));
            document.getElementById('refineCustom').value = '';
            selectedRefineOption = null;
        }

        function updateRefineUI() {
            document.getElementById('refineCount').textContent = refineCount;
            const btn = document.getElementById('btnApplyRefine');
            if (refineCount >= 3) {
                btn.disabled = true;
                btn.innerHTML = 'Limite atingido';
            }
        }

        // Eventos dos chips
        document.querySelectorAll('.refine-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.refine-chip').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
                selectedRefineOption = chip.dataset.refine;
            });
        });

        async function aplicarRefinamento() {
            if (refineCount >= 3) {
                mostrarNotificacao('Limite de refinamentos atingido', 'warning');
                return;
            }

            const customText = document.getElementById('refineCustom').value.trim();
            if (!selectedRefineOption && !customText) {
                mostrarNotificacao('Selecione uma opcao ou descreva a melhoria', 'warning');
                return;
            }

            const outputArea = document.getElementById('outputArea');
            const roteiroAtual = outputArea.innerText;
            const btn = document.getElementById('btnApplyRefine');

            btn.disabled = true;
            btn.innerHTML = '<div class="loading">‚è≥</div> Refinando...';

            // Mapear opcoes de refinamento para instrucoes claras
            const refinamentosMap = {
                'mais-curto': 'Reduza o texto, mantendo apenas o essencial. Corte palavras desnecess√°rias e v√° direto ao ponto. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-longo': 'Expanda o texto com mais detalhes, exemplos e explica√ß√µes. Aprofunde mais no assunto. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-informal': 'Torne mais casual e pr√≥ximo. Use linguagem do dia a dia, como uma conversa entre amigos. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-formal': 'Torne mais profissional e polido. Use linguagem mais elaborada e s√©ria. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-energia': 'Adicione mais energia e entusiasmo. Frases mais curtas, palavras de a√ß√£o, mais dinamismo. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-calmo': 'Torne mais tranquilo e sereno. Ritmo mais lento, frases mais longas, tom mais reflexivo. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-vendedor': 'Torne mais persuasivo. Destaque benef√≠cios, crie desejo, adicione urg√™ncia de forma √©tica. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-educativo': 'Foque mais em ensinar. Explique melhor os conceitos, use mais exemplos pr√°ticos. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'gancho-forte': 'Crie um in√≠cio mais impactante que prenda a aten√ß√£o imediatamente. ESCOPO: altere SOMENTE a primeira cena/abertura do roteiro. N√ÉO mexa no restante.',
                'cta-forte': 'Crie um final mais forte com chamada para a√ß√£o clara e motivadora. ESCOPO: altere SOMENTE a √∫ltima cena/fechamento do roteiro. N√ÉO mexa no restante.',
                'mais-emocional': 'Torne o texto mais emocional e tocante. Crie conex√£o com o espectador usando sentimentos reais. ESCOPO: aplique em TODAS as cenas/partes do roteiro.',
                'mais-direto': 'V√° direto ao ponto. Remova enrola√ß√£o e rodeios. Cada frase deve ter prop√≥sito claro. ESCOPO: aplique em TODAS as cenas/partes do roteiro.'
            };

            const instrucaoRefinamento = selectedRefineOption
                ? refinamentosMap[selectedRefineOption]
                : customText;

            // Detectar formato atual do roteiro
            let formatoSaida = document.getElementById('formatoSaida').value;
            const tipo = document.getElementById('tipoConteudo').value;
            const duracaoVideo = parseInt(document.getElementById('duracaoVideo').value) || 60;
            const isReelsTiktok = (tipo === 'reels' || tipo === 'stories');

            // Contar n√∫mero de cenas atuais para refer√™ncia
            const cenasAtuais = document.querySelectorAll('#outputArea .scene').length;

            // Definir formato JSON esperado baseado no formato de sa√≠da
            let formatoJSON = '';
            if (formatoSaida === 'script') {
                formatoJSON = `
FORMATO DE SA√çDA - JSON (SCRIPT):
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo do v√≠deo",
            "narrativa": "Texto completo da fala.\\n\\nSegundo par√°grafo.\\n\\nTerceiro par√°grafo.",
            "duracao": ${duracaoVideo}
        }
    ]
}
REGRA: Use \\n\\n para separar par√°grafos. Preserve a estrutura original.`;
            } else if (formatoSaida === 'cenas') {
                formatoJSON = `
FORMATO DE SA√çDA - JSON (CENAS):
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo do v√≠deo",
            "duracao": ${duracaoVideo},
            "cenas": [
                {
                    "numero": 1,
                    "titulo": "Nome da cena",
                    "fala": "Texto da fala.\\n\\nSegundo par√°grafo.",
                    "duracao": 10
                }
            ]
        }
    ]
}
REGRAS:
- Mantenha EXATAMENTE o mesmo n√∫mero de cenas (${cenasAtuais} cenas)
- Cada cena DEVE ter: fala, duracao
- Use \\n\\n para separar par√°grafos no campo "fala"`;
            } else {
                // direcao
                formatoJSON = `
FORMATO DE SA√çDA - JSON (CENAS + DIRE√á√ÉO):
{
    "videos": [
        {
            "numero": 1,
            "titulo": "T√≠tulo do v√≠deo",
            "cenario": "Cen√°rio de grava√ß√£o. Ex: Sentado no sof√°, segurando caderno",
            "duracao": ${duracaoVideo},
            "cenas": [
                {
                    "numero": 1,
                    "titulo": "Nome da cena",
                    "fala": "Texto da fala.\\n\\nSegundo par√°grafo.",
                    "tom_de_voz": "S√≥ quando o tom MUDA. Vazio se segue o tom geral.",
                    "gancho_visual": "S√≥ quando h√° elemento visual ESPEC√çFICO. Vazio se n√£o precisa.",
                    "duracao": 10
                }
            ]
        }
    ]
}
REGRAS:
- Mantenha EXATAMENTE o mesmo n√∫mero de cenas (${cenasAtuais} cenas)
- cenario: mantenha o cen√°rio original ou melhore se pedido
- Cada cena DEVE ter: fala, duracao. tom_de_voz e gancho_visual s√£o opcionais.
- tom_de_voz: s√≥ preencha se o tom MUDA nessa cena. Se segue o tom geral, deixe "".
- gancho_visual: s√≥ preencha quando h√° algo ESPEC√çFICO e necess√°rio. N√£o invente.
- Use \\n\\n para separar par√°grafos no campo "fala"`;
            }

            const systemPrompt = `Voc√™ √© um roteirista cir√∫rgico especialista em refinar roteiros de v√≠deo.
Responda em portugu√™s brasileiro COM ACENTOS CORRETOS.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
REGRA #1 ‚Äî SEJA CIR√öRGICO (A MAIS IMPORTANTE)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Voc√™ DEVE alterar SOMENTE o que o usu√°rio pediu. O resto deve permanecer ID√äNTICO, palavra por palavra.

COMO IDENTIFICAR O ESCOPO DO PEDIDO:
1. Se o usu√°rio menciona "come√ßo", "in√≠cio", "abertura", "gancho" ‚Üí altere APENAS a primeira cena/par√°grafo
2. Se o usu√°rio menciona "final", "fechamento", "CTA", "encerramento" ‚Üí altere APENAS a √∫ltima cena/par√°grafo
3. Se o usu√°rio menciona "meio", "desenvolvimento", "corpo" ‚Üí altere APENAS as cenas/par√°grafos do meio
4. Se o usu√°rio menciona uma cena espec√≠fica (ex: "cena 2", "segunda parte") ‚Üí altere APENAS essa cena
5. Se o usu√°rio pede algo geral ("mais energia", "mais informal") sem especificar parte ‚Üí aplique em TUDO
6. Se a instru√ß√£o j√° tem "ESCOPO:" definido ‚Üí siga exatamente o escopo indicado

EXEMPLOS DE APLICA√á√ÉO CIR√öRGICA:
- Pedido: "melhora o gancho" ‚Üí Altere SOMENTE a cena 1. Cenas 2, 3, 4... ficam IGUAIS.
- Pedido: "o final t√° fraco" ‚Üí Altere SOMENTE a √∫ltima cena. O resto fica IGUAL.
- Pedido: "a cena 3 t√° confusa" ‚Üí Altere SOMENTE a cena 3. O resto fica IGUAL.
- Pedido: "mais informal" (geral) ‚Üí Aplique o tom informal em TODAS as cenas.
- Pedido: "mais curto" (geral) ‚Üí Reduza TODAS as cenas proporcionalmente.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
REGRA #2 ‚Äî PRESERVE A ESTRUTURA DE PAR√ÅGRAFOS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- O campo "fala" DEVE manter quebras de par√°grafo usando \\n\\n
- NUNCA junte todo o texto em um bloco √∫nico
- Se a fala original tinha 3 par√°grafos, a vers√£o refinada deve ter ~3 par√°grafos
- Cada par√°grafo representa uma pausa natural na fala ‚Äî respeite isso

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
REGRA #3 ‚Äî INTELIG√äNCIA M√ÅXIMA NA INTERPRETA√á√ÉO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
O usu√°rio pode descrever o que quer de forma simples, leiga ou at√© vaga. Interprete com intelig√™ncia:

- "ficou ruim o come√ßo" = melhore SOMENTE a abertura/gancho (cena 1)
- "muito grande" = reduza o texto geral, corte o desnecess√°rio
- "parece rob√¥" = torne mais natural, humano, conversacional
- "sem gra√ßa" = adicione personalidade, humor, leveza
- "confuso" = simplifique, organize melhor a l√≥gica
- "travado" = melhore o ritmo, fluidez entre frases
- "n√£o convence" = torne mais persuasivo, com argumentos melhores
- "chato" = torne mais envolvente, din√¢mico, com varia√ß√£o de ritmo
- "gen√©rico" = adicione exemplos espec√≠ficos, dados, hist√≥rias
- "pesado" = alivie o tom, simplifique vocabul√°rio
- "o CTA t√° fraco" = melhore SOMENTE o CTA final, n√£o mexa no resto
- "a transi√ß√£o t√° estranha" = melhore SOMENTE a passagem entre cenas

${isReelsTiktok ? `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
CONTEXTO REELS/TIKTOK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- Mantenha o tom de aproxima√ß√£o e autenticidade
- Os primeiros segundos s√£o decisivos (n√£o perca isso ao refinar)
- Cada cena precisa ter um motivo para a pessoa continuar assistindo
- O conte√∫do precisa fazer a pessoa pensar "nossa, eu n√£o sabia disso"
- Ao refinar, n√£o quebre a cad√™ncia de reten√ß√£o do v√≠deo
` : ''}

RESPONDA APENAS COM JSON PURO. Sem markdown, sem \`\`\`, sem explica√ß√µes.`;

            const userPrompt = `MELHORIA SOLICITADA: ${instrucaoRefinamento}

ROTEIRO ATUAL (em formato texto extra√≠do):
${roteiroAtual}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
INSTRU√á√ïES DE EXECU√á√ÉO:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
1. Leia o pedido de melhoria com aten√ß√£o m√°xima
2. Identifique EXATAMENTE qual parte do roteiro o usu√°rio quer mudar
3. Altere SOMENTE essa parte ‚Äî o restante deve ficar ID√äNTICO
4. Mantenha par√°grafos separados com \\n\\n nos campos de texto
5. Mantenha a mesma quantidade de cenas/v√≠deos
6. N√£o invente conte√∫do novo a menos que o usu√°rio pe√ßa
7. Preserve o tom, estilo e personalidade do roteiro original nas partes n√£o alteradas

${formatoJSON}

Retorne APENAS o JSON, sem markdown, sem explica√ß√µes.`;

            try {
                const resposta = await chamarAPI(systemPrompt, userPrompt);
                const jsonLimpo = resposta.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const dados = JSON.parse(jsonLimpo);

                // Garantir que par√°grafos sejam preservados nos textos
                if (dados.videos) {
                    dados.videos.forEach(video => {
                        // Processar narrativa
                        if (video.narrativa) {
                            video.narrativa = video.narrativa
                                .replace(/\\n\\n/g, '\n\n')
                                .replace(/\\n/g, '\n');
                        }
                        // Processar cen√°rio
                        if (video.cenario) {
                            video.cenario = video.cenario
                                .replace(/\\n\\n/g, '\n\n')
                                .replace(/\\n/g, '\n');
                        }
                        // Processar cenas
                        if (video.cenas) {
                            video.cenas.forEach(cena => {
                                if (cena.fala) {
                                    cena.fala = cena.fala
                                        .replace(/\\n\\n/g, '\n\n')
                                        .replace(/\\n/g, '\n');
                                }
                            });
                        }
                    });
                }

                // Preservar o header (tudo antes dos video-blocks)
                let roteiro = outputArea.innerHTML.split('<div class="video-block">')[0];

                // Renderizar com a fun√ß√£o correta e formato correto
                videoCounter = 0;
                dados.videos.forEach(video => {
                    roteiro += renderizarVideoNovo(video, formatoSaida);
                });

                outputArea.innerHTML = roteiro;
                refineCount++;
                updateRefineUI();
                limparSelecaoRefine();
                mostrarNotificacao('Roteiro refinado com sucesso!', 'success');

            } catch (error) {
                mostrarNotificacao('Erro ao refinar: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg> Aplicar Melhoria`;
            }
        }
    </script>
</body>
</html>
