<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts - StudioDias</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@400;500;600;700;800;900&family=Playfair+Display:wght@400;700;900&family=Poppins:wght@300;400;500;600;700;800&family=Dancing+Script:wght@400;500;600;700&family=Caveat:wght@400;500;600;700&family=Pacifico&family=Satisfy&family=Great+Vibes&family=Sacramento&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/auth-block.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* ==================== GENERAL ==================== */
        .page-container { max-width: 1200px; margin: 0 auto; padding: 0 20px 60px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 0.82rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .card-title svg { width: 16px; height: 16px; fill: var(--accent); }

        /* ==================== CONFIG GRID ==================== */
        .config-row { display: grid; grid-template-columns: 1fr 120px; gap: 16px; align-items: end; }
        @media (max-width: 600px) { .config-row { grid-template-columns: 1fr !important; } }
        .field-group { display: flex; flex-direction: column; gap: 4px; }
        .field-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: var(--text-muted); }
        .field-input, .field-select { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--bg-primary); color: var(--text-primary); font-size: 0.85rem; font-family: 'Inter', sans-serif; outline: none; transition: border-color 0.2s; }
        .field-input:focus, .field-select:focus { border-color: var(--accent); }
        .field-textarea { width: 100%; min-height: 100px; padding: 12px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--bg-primary); color: var(--text-primary); font-size: 0.85rem; font-family: 'Inter', sans-serif; resize: vertical; outline: none; transition: border-color 0.2s; }
        .field-textarea:focus { border-color: var(--accent); }

        /* ==================== SUGGESTIONS CHIPS ==================== */
        .suggestions { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 16px; }
        .chip { padding: 6px 14px; border: 1px solid var(--border); border-radius: 9999px; font-size: 0.75rem; color: var(--text-muted); cursor: pointer; transition: all 0.15s; background: transparent; }
        .chip:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

        /* ==================== ACCORDION ==================== */
        .accordion-trigger { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 0; font-size: 0.82rem; font-weight: 600; color: var(--text-muted); border: none; background: none; width: 100%; text-align: left; }
        .accordion-trigger svg { width: 14px; height: 14px; fill: var(--text-muted); transition: transform 0.2s; }
        .accordion-trigger.open svg { transform: rotate(180deg); }
        .accordion-body { display: none; padding-top: 12px; }
        .accordion-body.open { display: block; }
        .adv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        @media (max-width: 600px) { .adv-grid { grid-template-columns: 1fr; } }

        /* ==================== PROFILE SECTION ==================== */
        .perfil-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .perfil-foto-wrap { width: 48px; height: 48px; border-radius: 50%; overflow: hidden; border: 2px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; background: var(--bg-secondary); flex-shrink: 0; }
        .perfil-foto-wrap img { width: 100%; height: 100%; object-fit: cover; }
        .perfil-foto-wrap svg { width: 20px; height: 20px; fill: var(--text-muted); }

        /* ==================== GENERATE BUTTON ==================== */
        .btn-generate { display: inline-flex; align-items: center; gap: 8px; padding: 12px 28px; background: var(--accent); color: white; border: none; border-radius: var(--radius-sm); font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.15s; float: right; }
        .btn-generate:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-generate:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-generate svg { width: 16px; height: 16px; fill: white; }

        /* ==================== ACTION BAR ==================== */
        .action-bar { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
        .action-bar-title { font-size: 0.95rem; font-weight: 700; color: var(--text-primary); margin-right: auto; display: flex; align-items: center; gap: 8px; }
        .action-bar-title svg { width: 18px; height: 18px; fill: var(--accent); }
        .btn-action { display: inline-flex; align-items: center; gap: 6px; padding: 7px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm); background: transparent; color: var(--text-primary); font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.15s; }
        .btn-action:hover { border-color: var(--accent); color: var(--accent); }
        .btn-action svg { width: 14px; height: 14px; fill: currentColor; }
        .btn-action.primary { border-color: var(--accent); color: var(--accent); }
        .btn-action.primary:hover { background: var(--accent); color: white; }
        .btn-action.primary:hover svg { fill: white; }

        /* ==================== SLIDES CONTAINER ==================== */
        .slides-scroll { display: flex; gap: 16px; overflow-x: auto; padding: 8px 4px 16px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .slides-scroll::-webkit-scrollbar { height: 6px; }
        .slides-scroll::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 3px; }
        .slides-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* ==================== SLIDE CARD ==================== */
        .slide-wrap { flex-shrink: 0; scroll-snap-align: start; position: relative; transition: transform 0.15s; }

        .slide-card { width: 270px; height: 337.5px; border-radius: 12px; overflow: hidden; position: relative; background: #0D1B2A; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
        .slide-card * { box-sizing: border-box; }

        .slide-number { position: absolute; top: 10px; left: 10px; width: 24px; height: 24px; border-radius: 50%; background: rgba(0,201,183,0.9); color: white; font-size: 0.65rem; font-weight: 700; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .slide-badge { position: absolute; top: 10px; right: 10px; padding: 3px 10px; border-radius: 4px; background: rgba(0,0,0,0.5); color: white; font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; z-index: 10; }

        /* Slide edit overlay */
        .slide-edit-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; gap: 8px; opacity: 0; pointer-events: none; transition: opacity 0.15s; z-index: 20; border-radius: 12px; }
        .slide-wrap:hover .slide-edit-overlay { opacity: 1; pointer-events: auto; }
        .slide-wrap.editing .slide-edit-overlay { display: none !important; }
        .slide-edit-btn { padding: 8px 14px; border-radius: 8px; border: 1.5px solid white; background: rgba(0,0,0,0.4); color: white; font-size: 0.72rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.15s; }
        .slide-edit-btn:hover { background: white; color: #0D1B2A; }
        .slide-edit-btn svg { width: 13px; height: 13px; fill: currentColor; }

        /* ==================== 10 LAYOUTS ==================== */
        /* Base image */
        .slide-bg { position: absolute; inset: 0; background-size: cover; background-position: center; }
        .slide-overlay { position: absolute; inset: 0; }
        .slide-headline { text-shadow: 0 1px 6px rgba(0,0,0,0.5), 0 2px 12px rgba(0,0,0,0.3); }
        .slide-body { text-shadow: 0 1px 4px rgba(0,0,0,0.4); }

        /* Slide sem imagem */
        .slide-card.no-bg-image { background: linear-gradient(145deg, #0D1B2A 0%, #112240 50%, #162a4a 100%); }
        .slide-card.no-bg-image.fundo-claro { background: linear-gradient(145deg, #e8ecf0 0%, #f0f2f5 50%, #f7f8fa 100%) !important; }
        .slide-card.no-bg-image .slide-overlay { background: none !important; }
        .slide-card.no-bg-image .slide-headline { font-size: 1.5rem !important; line-height: 1.25 !important; text-shadow: none; }
        .slide-card.no-bg-image .slide-body { font-size: 0.82rem !important; opacity: 0.9; text-shadow: none; }
        .slide-card.no-bg-image .slide-content { justify-content: center; }

        .fundo-claro .slide-number { background: rgba(10,46,46,0.85) !important; }
        .fundo-claro .slide-headline, .fundo-claro .slide-body { text-shadow: none !important; }

        /* ==================== DESIGNER SELECTOR ==================== */
        .designer-select { width: 100%; padding: 10px 32px 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--bg-primary); color: var(--text-primary); font-size: 0.85rem; font-family: 'Inter', sans-serif; font-weight: 600; outline: none; transition: border-color 0.2s; cursor: pointer; appearance: none; -webkit-appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='%23888'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; }
        .designer-select:focus { border-color: var(--accent); }
        .designer-select option { background: var(--bg-card); color: var(--text-primary); padding: 8px; }

        /* ==================== DESIGNER NOTICIA — CAPA ==================== */
        .noticia-capa { position: relative; overflow: hidden; }
        .noticia-capa .slide-bg { position: absolute; inset: 0; background-size: cover; background-position: center; }
        .noticia-capa .slide-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(13,27,42,0.05) 0%, transparent 20%, transparent 35%, rgba(13,27,42,0.4) 50%, rgba(13,27,42,0.85) 75%, rgba(13,27,42,0.97) 100%); }
        .noticia-capa .slide-content { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px 20px 22px; display: flex; flex-direction: column; justify-content: flex-end; z-index: 5; }
        .noticia-capa .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.1rem; line-height: 1.2; color: #E8ECF1; text-transform: uppercase; letter-spacing: -0.2px; }
        .noticia-capa .slide-body { font-family: 'Inter', sans-serif; font-size: 0.78rem; color: rgba(255,255,255,0.65); line-height: 1.45; margin-top: 6px; }
        /* Gradient line — position A: bottom horizontal */
        .noticia-capa .noticia-line.line-bottom { position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: linear-gradient(to right, transparent, #00C9B7, transparent); z-index: 10; }
        /* Gradient line — position B: left vertical */
        .noticia-capa .noticia-line.line-left { position: absolute; top: 0; left: 0; bottom: 0; width: 4px; background: linear-gradient(to bottom, transparent, #00C9B7, transparent); z-index: 10; }

        /* ==================== NOTICIA — GLASS CARD BASE ==================== */
        .noticia-glass-card { position: absolute; background: rgba(255,255,255,0.035); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.07); border-radius: 16px; z-index: 5; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
        .noticia-glass-card .slide-content { position: relative; inset: auto; padding: 0; display: flex; flex-direction: column; justify-content: center; height: 100%; }
        /* Reset glass-card para modelos sem card (2-5, 7-8) — modelo 6 USA glass-card */
        .noticia-2 .noticia-glass-card, .noticia-3 .noticia-glass-card, .noticia-4 .noticia-glass-card, .noticia-5 .noticia-glass-card, .noticia-7 .noticia-glass-card, .noticia-8 .noticia-glass-card { all: unset; position: absolute; inset: 0; background: none; border: none; box-shadow: none; backdrop-filter: none; -webkit-backdrop-filter: none; border-radius: 0; z-index: 5; display: block; }

        /* ==================== MODELO 1: Glass Card iPhone ==================== */
        .noticia-1 { background: #0D1B2A; }
        .noticia-1 .slide-bg { position: absolute; inset: 0; background-size: cover; background-position: center; }
        .noticia-1 .slide-overlay { position: absolute; inset: 0; background: linear-gradient(180deg, rgba(13,27,42,0.1) 0%, rgba(13,27,42,0.35) 40%, rgba(13,27,42,0.75) 100%); }
        .noticia-1 .noticia-glass-card { bottom: 18px; right: 14px; left: 14px; top: 44%; padding: 18px 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 0 30px rgba(0,201,183,0.03); }
        .noticia-1 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.15rem; color: #F0F4F8; line-height: 1.25; text-transform: uppercase; text-shadow: none; }
        .noticia-1 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.78rem; color: rgba(255,255,255,0.75); line-height: 1.55; margin-top: 8px; text-shadow: none; }
        .noticia-1 .noticia-deco-a { position: absolute; bottom: 0; left: 0; width: 140px; height: 140px; background: radial-gradient(ellipse at bottom left, rgba(0,201,183,0.1) 0%, transparent 70%); z-index: 2; pointer-events: none; }
        .noticia-1 .noticia-deco-b { position: absolute; top: 0; left: 0; width: 3px; height: 44%; background: linear-gradient(to bottom, transparent, #00C9B7, transparent); z-index: 6; pointer-events: none; }
        .noticia-1 .noticia-deco-c { position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(ellipse at top right, rgba(30,120,255,0.06) 0%, transparent 70%); z-index: 2; pointer-events: none; }

        /* ==================== MODELO 2: Imagem Full + Texto Overlay Embaixo ==================== */
        .noticia-2 { background: #0D1B2A; }
        .noticia-2 .slide-bg { position: absolute; inset: 0; background-size: cover; background-position: center; }
        .noticia-2 .slide-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 15%, rgba(13,27,42,0.25) 40%, rgba(13,27,42,0.88) 65%, rgba(13,27,42,0.98) 100%); }
        .noticia-2 .slide-content { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 22px 24px; display: flex; flex-direction: column; justify-content: flex-end; z-index: 5; }
        .noticia-2 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.25rem; color: #FFFFFF; line-height: 1.2; text-transform: uppercase; text-shadow: 0 2px 16px rgba(0,0,0,0.6); }
        .noticia-2 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.78rem; color: rgba(255,255,255,0.82); line-height: 1.55; margin-top: 8px; text-shadow: 0 1px 8px rgba(0,0,0,0.4); }
        .noticia-2 .noticia-deco-a { position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: linear-gradient(to right, #F5C542, #00C9B7, transparent); z-index: 8; }
        .noticia-2 .noticia-deco-b { position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(to right, transparent, rgba(0,201,183,0.2), transparent); z-index: 6; }
        .noticia-2 .noticia-deco-c { display: none; }

        /* ==================== MODELO 3: Imagem Topo + Texto Embaixo com Textura ==================== */
        .noticia-3 { background: #0D1B2A; }
        .noticia-3 .slide-bg { position: absolute; top: 0; left: 0; right: 0; height: 52%; background-size: cover; background-position: center; }
        .noticia-3 .slide-overlay { position: absolute; top: 0; left: 0; right: 0; height: 52%; background: linear-gradient(to bottom, transparent 30%, rgba(13,27,42,0.5) 70%, #0D1B2A 100%); }
        .noticia-3 .slide-content { position: absolute; bottom: 0; left: 0; right: 0; height: 52%; padding: 14px 22px 22px; display: flex; flex-direction: column; justify-content: center; z-index: 5; }
        .noticia-3 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.15rem; color: #F0F4F8; line-height: 1.22; text-transform: uppercase; text-shadow: none; }
        .noticia-3 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.78rem; color: rgba(255,255,255,0.68); line-height: 1.55; margin-top: 8px; text-shadow: none; }
        .noticia-3 .noticia-deco-a { position: absolute; top: 52%; left: 0; right: 0; height: 3px; background: linear-gradient(to right, #00C9B7, rgba(30,120,255,0.4), transparent); z-index: 8; }
        .noticia-3 .noticia-deco-b { position: absolute; bottom: 0; right: 0; width: 160px; height: 160px; background: radial-gradient(ellipse at bottom right, rgba(30,120,255,0.06) 0%, transparent 70%); z-index: 1; pointer-events: none; }
        .noticia-3 .noticia-deco-c { position: absolute; bottom: 48%; left: 0; right: 0; height: 48%; background-image: radial-gradient(rgba(0,201,183,0.02) 1px, transparent 1px); background-size: 16px 16px; z-index: 1; pointer-events: none; }

        /* ==================== MODELO 4: Gradiente Teal→Azul com Textura Noise ==================== */
        .noticia-4 { background: linear-gradient(145deg, #061520 0%, #0A2035 40%, #0D1B3A 100%); overflow: hidden; }
        .noticia-4 .slide-bg { display: none; }
        .noticia-4 .slide-overlay { display: none; }
        .noticia-4 .slide-content { position: absolute; inset: 0; padding: 28px 22px; display: flex; flex-direction: column; justify-content: center; z-index: 5; }
        .noticia-4 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.3rem; color: #F0F4F8; line-height: 1.18; text-transform: uppercase; text-shadow: none; }
        .noticia-4 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.8rem; color: rgba(190,225,245,0.62); line-height: 1.6; margin-top: 12px; text-shadow: none; }
        .noticia-4 .noticia-deco-a { position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: linear-gradient(to right, transparent, #00C9B7, rgba(30,120,255,0.5), transparent); z-index: 6; }
        .noticia-4 .noticia-deco-b { position: absolute; inset: 0; background-image: radial-gradient(rgba(0,201,183,0.025) 1px, transparent 1px); background-size: 14px 14px; z-index: 1; pointer-events: none; }
        .noticia-4 .noticia-deco-c { position: absolute; top: -10%; left: -10%; width: 200px; height: 200px; background: radial-gradient(ellipse at center, rgba(0,201,183,0.07) 0%, transparent 65%); z-index: 1; pointer-events: none; }

        /* ==================== MODELO 5: Split Horizontal — Imagem Esquerda + Texto Direita ==================== */
        .noticia-5 { background: #0D1B2A; }
        .noticia-5 .slide-bg { position: absolute; top: 0; left: 0; width: 48%; height: 100%; background-size: cover; background-position: center; }
        .noticia-5 .slide-overlay { position: absolute; top: 0; left: 0; width: 48%; height: 100%; background: linear-gradient(to left, #0D1B2A 0%, rgba(13,27,42,0.85) 15%, rgba(13,27,42,0.35) 50%, rgba(13,27,42,0.1) 80%, rgba(13,27,42,0.05) 100%); }
        .noticia-5 .slide-content { position: absolute; top: 0; right: 0; width: 56%; height: 100%; padding: 28px 22px 28px 14px; display: flex; flex-direction: column; justify-content: center; z-index: 5; }
        .noticia-5 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.05rem; color: #F0F4F8; line-height: 1.25; text-shadow: none; }
        .noticia-5 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.76rem; color: rgba(255,255,255,0.68); line-height: 1.55; margin-top: 10px; text-shadow: none; }
        .noticia-5 .noticia-deco-a { position: absolute; top: 12%; left: 46%; width: 1px; height: 76%; background: linear-gradient(to bottom, transparent, rgba(30,120,255,0.25), transparent); z-index: 6; box-shadow: 0 0 8px rgba(30,120,255,0.06); }
        .noticia-5 .noticia-deco-b { position: absolute; bottom: 16px; right: 22px; width: 30px; height: 3px; background: linear-gradient(to right, #00C9B7, rgba(30,120,255,0.4)); z-index: 8; border-radius: 2px; }
        .noticia-5 .noticia-deco-c { position: absolute; bottom: 0; left: 40%; width: 180px; height: 120px; background: radial-gradient(ellipse at bottom center, rgba(0,201,183,0.04) 0%, transparent 70%); z-index: 1; pointer-events: none; }

        /* ==================== ICONE 3D — posição comum ==================== */
        .noticia-icon { position: absolute; z-index: 4; pointer-events: none; opacity: 0.18; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3)); }
        .noticia-icon img { width: 100%; height: 100%; object-fit: contain; }
        .noticia-capa .noticia-icon { top: 14px; right: 14px; width: 50px; height: 50px; opacity: 0.15; }

        /* ==================== MODELO 6: "Glass iPhone" — Glassmorphism, número GIGANTE sutil de fundo, ícone visível, serif ==================== */
        .noticia-6 { background: linear-gradient(160deg, #0A0F1C 0%, #0D1B2A 40%, #112240 100%); overflow: hidden; }
        .noticia-6 .slide-bg { display: none; }
        .noticia-6 .slide-overlay { display: none; }
        .noticia-6 .noticia-glass-card { all: revert; position: absolute; left: 14px; right: 14px; bottom: 18px; top: auto; padding: 20px 18px; background: rgba(255,255,255,0.04); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.06); border-image: linear-gradient(135deg, rgba(0,201,183,0.2), rgba(30,120,255,0.15), rgba(0,201,183,0.08)) 1; border-image-slice: 1; border-radius: 16px; z-index: 5; box-shadow: 0 8px 40px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.06); display: block; overflow: hidden; }
        .noticia-6 .noticia-glass-card::before { content: ''; position: absolute; inset: -1px; border-radius: 16px; padding: 1px; background: linear-gradient(135deg, rgba(0,201,183,0.25), rgba(30,120,255,0.15), rgba(0,201,183,0.05)); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; }
        .noticia-6 .slide-content { position: relative; inset: auto; padding: 0; display: flex; flex-direction: column; z-index: 5; height: auto; }
        .noticia-6 .slide-headline { font-family: 'Playfair Display', 'Georgia', serif; font-weight: 800; font-size: 1.2rem; color: #F0F4F8; line-height: 1.2; text-transform: none; font-style: italic; }
        .noticia-6 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.72rem; color: rgba(200,220,245,0.55); line-height: 1.55; margin-top: 8px; font-weight: 300; }
        .noticia-6 .noticia-icon { top: 18px; right: 18px; width: 42px; height: 42px; opacity: 0.65; transform: none; left: auto; bottom: auto; filter: drop-shadow(0 2px 12px rgba(0,201,183,0.15)); }
        .noticia-6 .noticia-deco-a { position: absolute; inset: 0; background-image: radial-gradient(ellipse 100% 80% at 70% 30%, rgba(0,201,183,0.04) 0%, transparent 60%), radial-gradient(ellipse 80% 60% at 30% 70%, rgba(30,120,255,0.03) 0%, transparent 50%); z-index: 1; pointer-events: none; }
        .noticia-6 .noticia-deco-b { display: none; }
        .noticia-6 .noticia-deco-c { display: none; }

        /* ==================== MODELO 7: "Destaque Número" — Número GRANDE protagonista, card com borda degradê, ícone tag ==================== */
        .noticia-7 { background: #0D1B2A; overflow: hidden; }
        .noticia-7 .slide-bg { display: none; }
        .noticia-7 .slide-overlay { display: none; }
        .noticia-7 .slide-content { position: absolute; left: 16px; right: 16px; bottom: 22px; top: auto; padding: 20px 18px; display: flex; flex-direction: column; z-index: 5; background: rgba(255,255,255,0.02); border-radius: 14px; overflow: hidden; }
        .noticia-7 .slide-content::before { content: ''; position: absolute; inset: -1px; border-radius: 14px; padding: 1px; background: linear-gradient(160deg, rgba(0,201,183,0.3), rgba(30,120,255,0.12), transparent 60%); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; }
        .noticia-7 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.15rem; color: #F0F4F8; line-height: 1.2; text-transform: uppercase; position: relative; z-index: 2; }
        .noticia-7 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.72rem; color: rgba(180,210,250,0.5); line-height: 1.55; margin-top: 8px; position: relative; z-index: 2; }
        .noticia-7 .noticia-icon { top: auto; bottom: 78px; left: 18px; right: auto; width: 28px; height: 28px; opacity: 0.7; transform: none; filter: drop-shadow(0 2px 8px rgba(0,201,183,0.2)); }
        .noticia-7 .noticia-deco-a { position: absolute; inset: 0; background-image: radial-gradient(rgba(0,201,183,0.02) 1px, transparent 1px); background-size: 20px 20px; z-index: 1; pointer-events: none; }
        .noticia-7 .noticia-deco-b { display: none; }
        .noticia-7 .noticia-deco-c { position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(to right, #00C9B7, rgba(30,120,255,0.4), transparent 70%); z-index: 6; }

        /* ==================== MODELO 8: "Compacto Clean" — Número menor ao lado do título, ícone grande, minimalista ==================== */
        .noticia-8 { background: linear-gradient(180deg, #0D1B2A 0%, #0F2236 100%); overflow: hidden; }
        .noticia-8 .slide-bg { display: none; }
        .noticia-8 .slide-overlay { display: none; }
        .noticia-8 .slide-content { position: absolute; inset: 0; padding: 26px 22px; display: flex; flex-direction: column; justify-content: center; z-index: 5; }
        .noticia-8 .slide-headline { font-family: 'Poppins', sans-serif; font-weight: 800; font-size: 1.2rem; color: #F0F4F8; line-height: 1.2; text-transform: uppercase; letter-spacing: -0.3px; }
        .noticia-8 .slide-body { font-family: 'Inter', sans-serif; font-size: 0.76rem; color: rgba(190,220,245,0.5); line-height: 1.6; margin-top: 10px; }
        .noticia-8 .noticia-icon { top: 22px; right: 22px; width: 56px; height: 56px; opacity: 0.55; filter: drop-shadow(0 4px 16px rgba(0,201,183,0.15)); }
        .noticia-8 .noticia-deco-a { position: absolute; bottom: 22px; left: 22px; right: 22px; height: 1px; background: linear-gradient(to right, rgba(0,201,183,0.2), rgba(30,120,255,0.1), transparent); z-index: 6; }
        .noticia-8 .noticia-deco-b { position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background: linear-gradient(to right, #00C9B7, rgba(30,120,255,0.4), transparent); z-index: 6; }
        .noticia-8 .noticia-deco-c { position: absolute; top: 0; right: 0; width: 120px; height: 120px; background: radial-gradient(ellipse at top right, rgba(0,201,183,0.04) 0%, transparent 70%); z-index: 1; pointer-events: none; }

        /* ==================== NOTICIA — MODO CLARO ==================== */
        .noticia-capa.fundo-claro .slide-overlay { background: linear-gradient(to bottom, rgba(13,27,42,0.03) 0%, transparent 20%, transparent 35%, rgba(240,242,245,0.5) 50%, rgba(240,242,245,0.92) 75%, rgba(240,242,245,0.99) 100%); }
        .noticia-capa.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-capa.fundo-claro .slide-body { color: #555; }
        .noticia-capa.fundo-claro .noticia-line.line-bottom { background: linear-gradient(to right, transparent, #00C9B7, transparent); }
        /* Modelo 1 claro */
        .noticia-1.fundo-claro .noticia-glass-card { background: rgba(255,255,255,0.6); border: 1px solid rgba(13,27,42,0.06); box-shadow: 0 4px 20px rgba(0,0,0,0.06); backdrop-filter: blur(12px); }
        /* Modelos 2-5, 7-8 claro — glass-card reset (modelo 6 USA glass-card) */
        .noticia-2.fundo-claro .noticia-glass-card, .noticia-3.fundo-claro .noticia-glass-card, .noticia-4.fundo-claro .noticia-glass-card, .noticia-5.fundo-claro .noticia-glass-card, .noticia-7.fundo-claro .noticia-glass-card, .noticia-8.fundo-claro .noticia-glass-card { all: unset; position: absolute; inset: 0; background: none; border: none; box-shadow: none; backdrop-filter: none; -webkit-backdrop-filter: none; border-radius: 0; z-index: 5; display: block; }
        .noticia-1.fundo-claro { background: #f0f2f5 !important; }
        .noticia-1.fundo-claro .slide-headline { color: #0D1B2A; text-shadow: none; }
        .noticia-1.fundo-claro .slide-body { color: #444; text-shadow: none; opacity: 1; }
        .noticia-2.fundo-claro .slide-overlay { background: linear-gradient(to bottom, transparent 15%, rgba(240,242,245,0.25) 40%, rgba(240,242,245,0.9) 65%, rgba(240,242,245,0.98) 100%); }
        .noticia-2.fundo-claro .slide-headline { color: #0D1B2A; text-shadow: none; }
        .noticia-2.fundo-claro .slide-body { color: #444; text-shadow: none; }
        .noticia-3.fundo-claro { background: #f0f2f5 !important; }
        .noticia-3.fundo-claro .slide-overlay { background: linear-gradient(to bottom, transparent 30%, rgba(240,242,245,0.5) 70%, #f0f2f5 100%); }
        .noticia-3.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-3.fundo-claro .slide-body { color: #444; }
        .noticia-4.fundo-claro { background: linear-gradient(145deg, #e8ecf0 0%, #f0f2f5 40%, #edf0f6 100%) !important; }
        .noticia-4.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-4.fundo-claro .slide-body { color: #555; }
        .noticia-4.fundo-claro .noticia-deco-b { background-image: radial-gradient(rgba(13,27,42,0.02) 1px, transparent 1px); }
        .noticia-5.fundo-claro { background: #f0f2f5 !important; }
        .noticia-5.fundo-claro .slide-overlay { background: linear-gradient(to left, #f0f2f5 0%, rgba(240,242,245,0.85) 15%, rgba(240,242,245,0.35) 50%, rgba(240,242,245,0.1) 80%, rgba(240,242,245,0.03) 100%); }
        .noticia-5.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-5.fundo-claro .slide-body { color: #444; }
        .fundo-claro .noticia-icon { opacity: 0.12; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.1)); }
        /* Modelo 6 claro */
        .noticia-6.fundo-claro { background: linear-gradient(160deg, #e8ecf0 0%, #f0f2f5 40%, #edf0f6 100%) !important; }
        .noticia-6.fundo-claro .slide-headline { color: #0D1B2A; font-style: italic; }
        .noticia-6.fundo-claro .slide-body { color: #555; }
        .noticia-6.fundo-claro .noticia-glass-card { background: rgba(255,255,255,0.5); border-color: rgba(0,201,183,0.08); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .noticia-6.fundo-claro .noticia-glass-card::before { background: linear-gradient(135deg, rgba(0,201,183,0.15), rgba(30,120,255,0.08), transparent 60%); }
        /* Modelo 7 claro */
        .noticia-7.fundo-claro { background: #E8ECF5 !important; }
        .noticia-7.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-7.fundo-claro .slide-body { color: #555; }
        .noticia-7.fundo-claro .slide-content { background: rgba(0,0,0,0.015); }
        .noticia-7.fundo-claro .slide-content::before { background: linear-gradient(160deg, rgba(0,201,183,0.2), rgba(30,120,255,0.08), transparent 60%); }
        .noticia-7.fundo-claro .noticia-deco-a { background-image: radial-gradient(rgba(0,201,183,0.02) 1px, transparent 1px); }
        /* Modelo 8 claro */
        .noticia-8.fundo-claro { background: linear-gradient(180deg, #f0f2f5 0%, #edf0f6 100%) !important; }
        .noticia-8.fundo-claro .slide-headline { color: #0D1B2A; }
        .noticia-8.fundo-claro .slide-body { color: #555; }

        /* ==================== NÚMERO DECORATIVO (modelos sem-imagem 6-8) ==================== */
        .noticia-slide-number { position: absolute; line-height: 1; pointer-events: none; }

        /* Modelo 6 "Glass iPhone": número GIGANTE outline sutil como background atrás do card */
        .noticia-6 .noticia-slide-number { top: 8px; left: 12px; font-family: 'Playfair Display', 'Georgia', serif; font-weight: 900; font-size: 9rem; color: transparent; -webkit-text-stroke: 1.5px rgba(0,201,183,0.045); z-index: 1; font-style: italic; }

        /* Modelo 7 "Destaque Número": número GRANDE bem visível como protagonista, topo esquerdo */
        .noticia-7 .noticia-slide-number { top: 22px; left: 18px; font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 5.5rem; color: rgba(0,201,183,0.14); z-index: 3; text-shadow: 0 4px 30px rgba(0,201,183,0.06); letter-spacing: -4px; }

        /* Modelo 8 "Compacto": número pequeno elegante ao lado do headline, antes do texto */
        .noticia-8 .noticia-slide-number { top: 26px; left: 22px; font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 0.7rem; color: #00C9B7; z-index: 6; letter-spacing: 3px; padding-bottom: 4px; border-bottom: 2px solid rgba(0,201,183,0.3); }

        /* Fundo claro */
        .noticia-6.fundo-claro .noticia-slide-number { -webkit-text-stroke-color: rgba(0,201,183,0.06); }
        .noticia-7.fundo-claro .noticia-slide-number { color: rgba(0,201,183,0.1); text-shadow: none; }
        .noticia-8.fundo-claro .noticia-slide-number { color: #00A090; border-bottom-color: rgba(0,160,144,0.2); }

        /* ==================== CAROUSEL SWIPE INDICATOR ==================== */
        .swipe-indicator { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); z-index: 15; opacity: 0.35; pointer-events: none; animation: swipePulse 2.5s ease-in-out infinite; }
        .swipe-indicator svg { width: 14px; height: 14px; fill: white; filter: drop-shadow(0 1px 3px rgba(0,0,0,0.4)); }
        .fundo-claro .swipe-indicator svg { fill: #0D1B2A; }
        @keyframes swipePulse { 0%, 100% { opacity: 0.25; transform: translateY(-50%) translateX(0); } 50% { opacity: 0.5; transform: translateY(-50%) translateX(-3px); } }

        /* ==================== DESIGNER POST — BASE (sempre fundo branco) ==================== */
        /* Post profile header — compacto, sem linha, sem verificado */
        .post-profile { display: flex; align-items: center; gap: 8px; padding: 0 0 8px 0; z-index: 12; background: transparent; flex-shrink: 0; position: relative; }
        .post-profile-pic { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid #2D8CFF; flex-shrink: 0; }
        .post-profile-pic-placeholder { width: 30px; height: 30px; border-radius: 50%; background: #2D8CFF; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .post-profile-pic-placeholder svg { width: 14px; height: 14px; fill: white; }
        .post-profile-info { display: flex; flex-direction: column; }
        .post-profile-name { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 0.7rem; color: #1a1a1a; line-height: 1.2; }
        .post-profile-handle { font-family: 'Inter', sans-serif; font-weight: 400; font-size: 0.55rem; color: #888; line-height: 1.2; }

        /* Noticia emphasis — risco amarelo fino embaixo da palavra */
        .noticia-emphasis { display: inline; background: linear-gradient(transparent 82%, #F5C542 82%, #F5C542 94%, transparent 94%); padding: 0 1px; box-decoration-break: clone; -webkit-box-decoration-break: clone; }
        .fundo-claro .noticia-emphasis { background: linear-gradient(transparent 82%, rgba(245,197,66,0.55) 82%, rgba(245,197,66,0.55) 94%, transparent 94%); }
        /* Noticia bold — negrito no body para destaque sem risco */
        .noticia-bold { font-weight: 700; color: rgba(255,255,255,0.85); }
        .fundo-claro .noticia-bold { color: #1a2a3a; }

        /* Post emphasis — estilo canetao (risco abaixo da letra, cor solida) */
        .post-emphasis { display: inline; background: linear-gradient(transparent 78%, #E63946 78%, #E63946 92%, transparent 92%); padding: 0 3px; padding-bottom: 3px; }

        /* Post slide counter */
        .post-counter { position: absolute; top: 12px; right: 14px; font-family: 'Inter', sans-serif; font-size: 0.6rem; font-weight: 700; color: #bbb; z-index: 12; letter-spacing: 0.5px; }

        /* Post inline images */
        .post-inline-img { border-radius: 10px; object-fit: cover; display: block; }
        .post-img-single { width: 100%; max-height: 150px; }
        .post-img-row { display: flex; gap: 6px; width: 100%; }
        .post-img-row .post-inline-img { flex: 1; min-width: 0; height: 110px; }
        .post-img-centered { width: 100%; max-height: 170px; border-radius: 10px; }

        /* Post unified text wrapper — titulo e corpo quase mesmo tamanho */
        .post-text { display: flex; flex-direction: column; gap: 0; position: relative; }
        .post-text .slide-headline { font-family: 'Inter', sans-serif; font-weight: 500; font-size: 0.88rem; color: #1a1a1a; line-height: 1.5; text-shadow: none; margin-bottom: 4px; }
        .post-text .slide-body { font-family: 'Inter', sans-serif; font-weight: 500; font-size: 0.85rem; color: #1a1a1a; line-height: 1.5; text-shadow: none; opacity: 1; }

        /* ==================== DESIGNER POST — CAPA ==================== */
        .post-capa { position: relative; overflow: hidden; background: #ffffff !important; }
        .post-capa .slide-bg { display: none; }
        .post-capa .slide-overlay { display: none; }
        .post-capa .slide-content { position: absolute; top: 0 !important; left: 0; right: 0; bottom: 0 !important; display: flex; flex-direction: column; justify-content: center !important; padding: 20px 20px 42px; z-index: 5; }
        /* Override do is-cover global — Post nao usa uppercase nem tamanho grande */
        .post-capa.is-cover .slide-headline { text-transform: none !important; font-size: 0.88rem !important; font-weight: 500 !important; line-height: 1.5 !important; letter-spacing: normal !important; }
        .post-capa.is-cover .slide-body { font-size: 0.85rem !important; font-weight: 500 !important; opacity: 1 !important; }

        /* ==================== DESIGNER POST — MODELO 1: Texto + imagem embaixo ==================== */
        .post-1 { overflow: hidden; background: #ffffff !important; }
        .post-1 .slide-bg { display: none; }
        .post-1 .slide-overlay { display: none; }
        .post-1 .slide-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; padding: 20px 20px 42px; z-index: 5; }
        .post-1 .post-inline-img { margin-top: auto; }

        /* ==================== DESIGNER POST — MODELO 2: Texto puro centralizado ==================== */
        .post-2 { overflow: hidden; background: #ffffff !important; }
        .post-2 .slide-bg { display: none; }
        .post-2 .slide-overlay { display: none; }
        .post-2 .slide-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: center; padding: 20px 20px 42px; z-index: 5; }

        /* ==================== DESIGNER POST — MODELO 3: Imagem no topo + texto ==================== */
        .post-3 { overflow: hidden; background: #ffffff !important; }
        .post-3 .slide-bg { display: none; }
        .post-3 .slide-overlay { display: none; }
        .post-3 .slide-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; padding: 20px 20px 42px; z-index: 5; }
        .post-3 .post-inline-img { margin-bottom: 10px; }

        /* ==================== DESIGNER POST — MODELO 4: Duas imagens lado a lado + texto ==================== */
        .post-4 { overflow: hidden; background: #ffffff !important; }
        .post-4 .slide-bg { display: none; }
        .post-4 .slide-overlay { display: none; }
        .post-4 .slide-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: center; padding: 20px 20px 42px; z-index: 5; }

        /* ==================== DESIGNER POST — MODELO 5: Texto puro (sem imagem) ==================== */
        .post-5 { overflow: hidden; background: #ffffff !important; }
        .post-5 .slide-bg { display: none; }
        .post-5 .slide-overlay { display: none; }
        .post-5 .slide-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: center; padding: 20px 20px 42px; z-index: 5; }

        /* ==================== FUNDO TOGGLE (claro/escuro para todos) ==================== */
        .fundo-toggle { display: inline-flex; border: 1.5px solid var(--border); border-radius: 9999px; overflow: hidden; cursor: pointer; user-select: none; }
        .fundo-option { display: flex; align-items: center; gap: 4px; padding: 7px 12px; font-size: 0.72rem; font-weight: 600; color: var(--text-muted); transition: all 0.2s; white-space: nowrap; }
        .fundo-option.active { background: var(--accent); color: white; }
        .fundo-option:not(.active):hover { background: var(--accent-glow); color: var(--accent); }

        /* ==================== CAPTION SECTION ==================== */
        .caption-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .caption-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .caption-title { font-size: 0.78rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--accent); }
        .caption-toggles { display: flex; gap: 12px; }
        .caption-toggle { display: flex; align-items: center; gap: 5px; font-size: 0.7rem; color: var(--text-muted); cursor: pointer; }
        .caption-toggle input[type="checkbox"] { accent-color: var(--accent); }
        .caption-text { font-size: 0.82rem; color: var(--text-primary); line-height: 1.6; white-space: pre-wrap; background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); position: relative; }
        .btn-copy-caption { position: absolute; top: 8px; right: 8px; padding: 5px 12px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text-muted); font-size: 0.7rem; font-weight: 600; cursor: pointer; }
        .btn-copy-caption:hover { border-color: var(--accent); color: var(--accent); }

        /* ==================== IMAGE SEARCH MODAL ==================== */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: var(--bg-card); border-radius: var(--radius-lg); width: 90%; max-width: 700px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .modal-header input { flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--bg-primary); color: var(--text-primary); font-size: 0.85rem; outline: none; }
        .modal-header input:focus { border-color: var(--accent); }
        .modal-header button { padding: 10px 18px; background: var(--accent); color: white; border: none; border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .modal-close { padding: 8px; background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem; }
        .modal-body { padding: 16px; overflow-y: auto; flex: 1; }
        .img-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        @media (max-width: 500px) { .img-grid { grid-template-columns: repeat(2, 1fr); } }
        .img-grid-item { aspect-ratio: 4/3; border-radius: 8px; overflow: hidden; cursor: pointer; position: relative; border: 2px solid transparent; transition: all 0.15s; }
        .img-grid-item:hover { border-color: var(--accent); transform: scale(1.02); }
        .img-grid-item img { width: 100%; height: 100%; object-fit: cover; }
        .img-grid-item .img-credit { position: absolute; bottom: 0; left: 0; right: 0; padding: 3px 6px; background: rgba(0,0,0,0.6); color: white; font-size: 0.55rem; }
        .modal-footer { padding: 12px 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-footer .page-info { font-size: 0.75rem; color: var(--text-muted); }
        .modal-footer button { padding: 7px 16px; border: 1px solid var(--border); border-radius: 6px; background: transparent; color: var(--text-primary); font-size: 0.75rem; cursor: pointer; }
        .modal-footer button:hover { border-color: var(--accent); }
        .modal-footer button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* Upload tab in modal */
        .modal-tabs { display: flex; border-bottom: 1px solid var(--border); }
        .modal-tab { padding: 10px 20px; font-size: 0.78rem; font-weight: 600; color: var(--text-muted); border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent; }
        .modal-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .upload-area { border: 2px dashed var(--border); border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: border-color 0.2s; }
        .upload-area:hover { border-color: var(--accent); }
        .upload-area p { font-size: 0.82rem; color: var(--text-muted); margin-top: 8px; }

        /* ==================== EDIT TOOLBAR ==================== */
        .edit-toolbar { display: none; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 8px 12px; margin-top: 8px; flex-direction: column; gap: 6px; }
        .edit-toolbar.active { display: flex; }
        .edit-toolbar .edit-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .edit-toolbar .edit-group { display: flex; align-items: center; gap: 4px; padding-right: 8px; border-right: 1px solid var(--border); }
        .edit-toolbar .edit-group:last-child { border-right: none; }
        .edit-toolbar label { font-size: 0.65rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
        .edit-toolbar input[type="color"] { width: 24px; height: 24px; border: 1px solid var(--border); border-radius: 4px; cursor: pointer; padding: 0; }
        .edit-toolbar select { padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 0.72rem; }
        .edit-toolbar input[type="range"] { width: 70px; }
        .edit-toolbar .edit-btn-icon { width: 28px; height: 28px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; transition: all 0.15s; }
        .edit-toolbar .edit-btn-icon:hover { background: var(--accent); color: white; border-color: var(--accent); }
        .edit-toolbar .edit-btn-icon.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* Image edit buttons in overlay */
        .img-edit-actions { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); display: none; gap: 4px; z-index: 15; }
        .slide-wrap:hover .img-edit-actions { display: flex; }
        .slide-wrap.editing .img-edit-actions { display: flex; }
        .img-edit-btn { padding: 4px 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.4); background: rgba(0,0,0,0.55); color: white; font-size: 0.6rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 3px; transition: all 0.15s; backdrop-filter: blur(4px); }
        .img-edit-btn:hover { background: rgba(255,255,255,0.9); color: #1a1a1a; }
        .img-edit-btn svg { width: 11px; height: 11px; fill: currentColor; }

        /* Draggable elements in edit mode */
        .slide-wrap.editing .post-profile.draggable-active { cursor: move; }
        .slide-wrap.editing .post-profile.draggable-active:hover { outline: 1px dashed rgba(0,180,216,0.5); border-radius: 4px; }
        .slide-wrap.editing .post-inline-img.draggable-active { cursor: move; }
        .slide-wrap.editing .post-inline-img.draggable-active:hover { outline: 2px dashed rgba(0,180,216,0.5); border-radius: 4px; }
        .slide-wrap.editing .post-text.draggable-active { cursor: move; }
        .slide-wrap.editing .post-text.draggable-active:hover { outline: 1px dashed rgba(0,180,216,0.5); border-radius: 4px; }

        /* ==================== STATUS ==================== */
        .status-bar { display: none; padding: 12px 16px; border-radius: var(--radius-sm); background: var(--bg-secondary); margin-bottom: 16px; font-size: 0.8rem; color: var(--text-muted); text-align: center; }
        .status-bar.active { display: block; }

        /* ==================== LOGO CONFIG ==================== */
        .logo-config { display: flex; align-items: center; gap: 12px; margin-top: 8px; }
        .logo-config label { font-size: 0.72rem; color: var(--text-muted); }
        .logo-config select { padding: 4px 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 0.75rem; }
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { display: none; }
        .switch .slider { position: absolute; inset: 0; background: var(--border); border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .switch .slider::before { content: ''; position: absolute; width: 16px; height: 16px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: 0.2s; }
        .switch input:checked + .slider { background: var(--accent); }
        .switch input:checked + .slider::before { transform: translateX(16px); }

        /* ==================== IMAGE MODE TOGGLE ==================== */
        .img-mode-toggle { display: inline-flex; border: 1.5px solid var(--border); border-radius: 9999px; overflow: hidden; cursor: pointer; user-select: none; }
        .img-mode-option { display: flex; align-items: center; gap: 4px; padding: 7px 14px; font-size: 0.72rem; font-weight: 600; color: var(--text-muted); transition: all 0.2s; white-space: nowrap; }
        .img-mode-option.active { background: var(--accent); color: white; }
        .img-mode-option:not(.active):hover { background: var(--accent-glow); color: var(--accent); }

        /* ==================== IMAGE TYPE SELECTOR ==================== */
        .img-type-option { display: inline-flex; align-items: center; gap: 5px; padding: 7px 14px; border: 1.5px solid var(--border); border-radius: 9999px; font-size: 0.75rem; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: all 0.15s; user-select: none; }
        .img-type-option:hover { border-color: var(--accent); color: var(--accent); }
        .img-type-option.selected { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

        /* ==================== CONTENT TYPE SELECTOR ==================== */
        .content-type-option { display: inline-flex; align-items: center; gap: 5px; padding: 7px 14px; border: 1.5px solid var(--border); border-radius: 9999px; font-size: 0.75rem; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: all 0.15s; user-select: none; }
        .content-type-option:hover { border-color: var(--accent); color: var(--accent); }
        .content-type-option.selected { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

        /* Clearfix */
        .clearfix::after { content: ''; display: table; clear: both; }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Hero -->
        <section class="hero">
            <h1 class="hero-title">Posts</h1>
            <p class="hero-subtitle">Crie posts e carrosseis profissionais para redes sociais com IA</p>
        </section>

        <!-- Config Card -->
        <div class="card">
            <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap;margin-bottom:12px">
                <div class="field-group" style="flex-shrink:0;min-width:140px">
                    <span class="field-label">Designer</span>
                    <select id="designerSelect" class="designer-select" onchange="selecionarDesigner(this.value)">
                        <option value="noticia">📐 Padrão</option>
                        <option value="noticia-si">✨ Sem Imagem</option>
                        <option value="post">📱 Post</option>
                    </select>
                </div>
                <div class="field-group" style="flex-shrink:0" id="fundoGroup">
                    <span class="field-label">Fundo</span>
                    <div class="fundo-toggle" id="fundoToggle" onclick="toggleFundo()">
                        <div class="fundo-option active" data-fundo="escuro">🌙 Escuro</div>
                        <div class="fundo-option" data-fundo="claro">☀️ Claro</div>
                    </div>
                </div>
                <div class="field-group" style="flex-shrink:0">
                    <span class="field-label">Slides</span>
                    <input type="number" id="numSlides" class="field-input" value="5" min="1" max="15" style="width:80px">
                </div>
                <div class="field-group" id="tipoImagemGroup" style="flex:1;min-width:200px">
                    <span class="field-label">Tipo de imagem</span>
                    <div style="display:flex;gap:6px;flex-wrap:wrap">
                        <label class="img-type-option selected" onclick="selecionarTipoImagem('aleatorio',this)">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" fill="currentColor"/></svg>
                            Aleatorio
                        </label>
                        <label class="img-type-option" onclick="selecionarTipoImagem('famosos',this)">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z" fill="currentColor"/></svg>
                            Famosos
                        </label>
                        <label class="img-type-option" onclick="selecionarTipoImagem('historia',this)">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" fill="currentColor"/></svg>
                            Historia
                        </label>
                        <label class="img-type-option" onclick="selecionarTipoImagem('empresa',this)">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z" fill="currentColor"/></svg>
                            Empresa
                        </label>
                    </div>
                </div>
            </div>

            <!-- Tipo de conteúdo -->
            <div class="field-group" style="flex:1">
                <span class="field-label">Tipo de conteúdo</span>
                <div style="display:flex;gap:6px;flex-wrap:wrap">
                    <label class="content-type-option selected" onclick="selecionarTipoConteudo('livre',this)">📝 Livre</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('dicas',this)">📋 Dicas</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('passos',this)">🔢 Passos</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('mitos',this)">❌✅ Mitos e Verdades</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('motivacional',this)">💪 Motivacional</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('noticia',this)">📰 Notícia</label>
                    <label class="content-type-option" onclick="selecionarTipoConteudo('informal',this)">💬 Informal</label>
                </div>
            </div>

            <!-- Advanced -->
            <button class="accordion-trigger" onclick="toggleAccordion(this)">
                <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                Avancado
                <svg viewBox="0 0 24 24" style="margin-left:auto"><path d="M7 10l5 5 5-5z"/></svg>
            </button>
            <div class="accordion-body" id="advancedPanel">
                <!-- Perfil -->
                <div class="card-title" style="margin-top:0">Perfil</div>
                <div class="perfil-row">
                    <div class="perfil-foto-wrap" onclick="document.getElementById('perfilFotoInput').click()" id="perfilFotoPreview">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                    <input type="file" id="perfilFotoInput" accept="image/*" style="display:none" onchange="carregarFotoPerfil(this)">
                    <div style="flex:1;display:flex;gap:8px">
                        <input type="text" id="perfilNome" class="field-input" placeholder="Nome / Marca" style="flex:1">
                        <input type="text" id="perfilArroba" class="field-input" placeholder="@perfil" style="width:120px">
                    </div>
                </div>

                <div class="adv-grid">
                    <!-- Cores -->
                    <div class="field-group">
                        <span class="field-label">Cor Principal</span>
                        <div style="display:flex;gap:8px;align-items:center">
                            <input type="color" id="corPrincipal" value="#00b4d8" style="width:36px;height:32px;border:1px solid var(--border);border-radius:4px;cursor:pointer">
                            <span style="font-size:0.72rem;color:var(--text-muted)" id="corPrincipalHex">#00b4d8</span>
                        </div>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Cor Secundaria</span>
                        <div style="display:flex;gap:8px;align-items:center">
                            <input type="color" id="corSecundaria" value="#f4c542" style="width:36px;height:32px;border:1px solid var(--border);border-radius:4px;cursor:pointer">
                            <span style="font-size:0.72rem;color:var(--text-muted)" id="corSecundariaHex">#f4c542</span>
                        </div>
                    </div>

                    <!-- Logo -->
                    <div class="field-group">
                        <span class="field-label">Logo nos slides</span>
                        <div class="logo-config">
                            <label class="switch">
                                <input type="checkbox" id="logoAtivo">
                                <span class="slider"></span>
                            </label>
                            <select id="logoPosicao" class="field-select" style="width:auto;padding:6px 10px;font-size:0.75rem">
                                <option value="bottom-right">Inferior direito</option>
                                <option value="bottom-left">Inferior esquerdo</option>
                                <option value="top-right">Superior direito</option>
                                <option value="top-left">Superior esquerdo</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                Tema e conteudo
            </div>
            <div class="field-group" style="margin-bottom:12px">
                <span class="field-label">Tema</span>
                <input type="text" id="inputTema" class="field-input" placeholder="Ex: 5 dicas de produtividade para empreendedores">
            </div>
            <div class="field-group" style="margin-bottom:16px">
                <span class="field-label">Conteudo (opcional)</span>
                <textarea id="inputConteudo" class="field-textarea" placeholder="Cole aqui o conteudo base para gerar os slides, ou descreva o que quer no carrossel..."></textarea>
            </div>
            <div class="clearfix">
                <button class="btn-generate" id="btnGenerate" onclick="gerarPost()">
                    <svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                    Gerar slides
                </button>
            </div>
        </div>

        <!-- Status -->
        <div class="status-bar" id="statusBar"></div>

        <!-- Preview Section -->
        <div id="previewSection" class="card" style="display:none">
            <!-- Action bar -->
            <div class="action-bar">
                <div class="action-bar-title">
                    <svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
                    Seus slides
                </div>
                <button class="btn-action primary" onclick="refazerDesign()">
                    <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    Refazer design
                </button>
                <button class="btn-action" onclick="baixarTodosSlides()">
                    <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                    Baixar slides
                </button>
                <button class="btn-action" onclick="baixarZIP()">
                    <svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6 10H8v-2h6v2zm4-4H8v-2h10v2z"/></svg>
                    ZIP
                </button>
                <button class="btn-action" onclick="copiarLegenda()">
                    <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    Copiar legenda
                </button>
            </div>

            <!-- Slides -->
            <div class="slides-scroll" id="slidesContainer"></div>

            <!-- Caption -->
            <div class="caption-section">
                <div class="caption-header">
                    <span class="caption-title">Legenda sugerida</span>
                    <div class="caption-toggles">
                        <label class="caption-toggle"><input type="checkbox" id="toggleEmojis" checked onchange="atualizarLegenda()"> Emojis</label>
                        <label class="caption-toggle"><input type="checkbox" id="toggleHashtags" checked onchange="atualizarLegenda()"> Hashtags</label>
                        <label class="caption-toggle"><input type="checkbox" id="toggleCTA" checked onchange="atualizarLegenda()"> CTA</label>
                    </div>
                </div>
                <div class="caption-text" id="captionText">
                    <button class="btn-copy-caption" onclick="copiarLegenda()">Copiar</button>
                    <span id="captionContent"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Search Modal -->
    <div class="modal-overlay" id="imageModal" onclick="if(event.target===this)fecharModal()">
        <div class="modal-box">
            <div style="display:flex;align-items:center;border-bottom:1px solid var(--border)">
                <div class="modal-tabs" style="flex:1;border-bottom:none">
                    <button class="modal-tab active" onclick="switchModalTab('search',this)">Pixabay</button>
                    <button class="modal-tab" onclick="switchModalTab('famosos',this)">Famosos</button>
                    <button class="modal-tab" onclick="switchModalTab('upload',this)">Upload</button>
                </div>
                <button class="modal-close" onclick="fecharModal()" style="margin-right:12px;font-size:1.5rem">&times;</button>
            </div>
            <!-- Pixabay search header -->
            <div class="modal-header" id="modalSearchHeader">
                <input type="text" id="modalSearchInput" placeholder="Buscar imagens no Pixabay..." onkeydown="if(event.key==='Enter')buscarImagens()">
                <button onclick="buscarImagens()">Buscar</button>
            </div>
            <!-- Famosos search header -->
            <div id="famososHeader" style="display:none;padding:12px 20px;border-bottom:1px solid var(--border);gap:8px">
                <div style="display:flex;gap:8px">
                    <input type="text" id="famososInput" placeholder="Nome do famoso (ex: Anitta, Neymar, Einstein...)" style="flex:1;padding:10px 14px;background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-primary);font-size:0.85rem;outline:none" onkeydown="if(event.key==='Enter')buscarFamosos()">
                    <button onclick="buscarFamosos()" style="padding:10px 18px;background:var(--accent);color:white;border:none;border-radius:var(--radius-sm);font-size:0.8rem;font-weight:600;cursor:pointer">Buscar</button>
                </div>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="img-grid" id="imgGrid"></div>
                <div id="famososGrid" class="img-grid" style="display:none"></div>
                <div id="uploadArea" style="display:none">
                    <div class="upload-area" onclick="document.getElementById('uploadImgInput').click()">
                        <svg viewBox="0 0 24 24" width="40" height="40" fill="var(--text-muted)"><path d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"/></svg>
                        <p>Clique para enviar uma imagem</p>
                    </div>
                    <input type="file" id="uploadImgInput" accept="image/*" style="display:none" onchange="uploadImagem(this)">
                </div>
            </div>
            <div class="modal-footer" id="modalFooter">
                <span class="page-info" id="pageInfo"></span>
                <div style="display:flex;gap:8px">
                    <button id="btnPrevPage" onclick="buscarImagens(currentPage-1)" disabled>&laquo; Anterior</button>
                    <button id="btnNextPage" onclick="buscarImagens(currentPage+1)">Proxima &raquo;</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden render container for downloads -->
    <div id="renderContainer" style="position:fixed;left:-9999px;top:0;z-index:-1;"></div>

    <script src="../js/common.js?v=005"></script>
    <script src="../js/config.js?v=005"></script>
    <script>
        renderHeader('posts');

        // ==================== GLOBALS ====================
        let dadosGerados = null;
        let currentLayoutIndex = 0;
        let editingSlideIndex = -1;
        let currentPage = 1;
        let modalCallback = null;
        let perfilFotoBase64 = localStorage.getItem('post_perfil_foto') || '';
        let tipoImagem = 'aleatorio'; // 'aleatorio', 'famosos', 'historia', 'empresa'
        let tipoConteudo = 'livre'; // 'livre', 'dicas', 'passos', 'mitos', 'motivacional', 'noticia', 'informal'
        let designerModelo = 'noticia'; // 'noticia' (padrao), 'noticia-si' (sem imagem) ou 'post'
        let fundoTema = 'escuro'; // 'escuro' ou 'claro'
        let gradientLinePosition = 0; // 0 = bottom (horizontal), 1 = left (vertical)

        function selecionarDesigner(modelo) {
            designerModelo = modelo;
            currentLayoutIndex = 0; // resetar ao trocar de designer
            // Hide fundo toggle for Post (always white)
            const fundoGroup = document.getElementById('fundoGroup');
            if (fundoGroup) fundoGroup.style.display = modelo === 'post' ? 'none' : 'flex';
            // Ao trocar designer, regenerar conteúdo com IA (texto e títulos mudam conforme o estilo)
            if (dadosGerados && document.getElementById('inputTema').value.trim()) {
                gerarPost();
            }
        }

        function toggleFundo() {
            const options = document.querySelectorAll('.fundo-option');
            if (fundoTema === 'escuro') {
                fundoTema = 'claro';
                options[0].classList.remove('active');
                options[1].classList.add('active');
            } else {
                fundoTema = 'escuro';
                options[1].classList.remove('active');
                options[0].classList.add('active');
            }
            if (dadosGerados) renderizarSlides();
        }

        function selecionarTipoConteudo(tipo, el) {
            tipoConteudo = tipo;
            document.querySelectorAll('.content-type-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
        }

        function selecionarTipoImagem(tipo, el) {
            tipoImagem = tipo;
            document.querySelectorAll('.img-type-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
        }

        // Restaurar perfil
        document.getElementById('perfilNome').value = localStorage.getItem('post_perfil_nome') || '';
        document.getElementById('perfilArroba').value = localStorage.getItem('post_perfil_arroba') || '';
        if (perfilFotoBase64) {
            document.getElementById('perfilFotoPreview').innerHTML = `<img src="${perfilFotoBase64}" alt="Foto">`;
        }

        // Salvar perfil ao mudar
        document.getElementById('perfilNome').addEventListener('change', function() { localStorage.setItem('post_perfil_nome', this.value); });
        document.getElementById('perfilArroba').addEventListener('change', function() { localStorage.setItem('post_perfil_arroba', this.value); });
        document.getElementById('corPrincipal').addEventListener('input', function() { document.getElementById('corPrincipalHex').textContent = this.value; });
        document.getElementById('corSecundaria').addEventListener('input', function() { document.getElementById('corSecundariaHex').textContent = this.value; });

        // ==================== UTILS ====================
        function toggleAccordion(btn) {
            btn.classList.toggle('open');
            const body = btn.nextElementSibling;
            body.classList.toggle('open');
        }

        function usarSugestao(texto) {
            const input = document.getElementById('inputTema');
            input.value = texto;
            input.focus();
            input.setSelectionRange(texto.length, texto.length);
        }

        function showStatus(msg) {
            const bar = document.getElementById('statusBar');
            bar.textContent = msg;
            bar.classList.add('active');
        }
        function hideStatus() {
            document.getElementById('statusBar').classList.remove('active');
        }

        function carregarFotoPerfil(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    perfilFotoBase64 = e.target.result;
                    localStorage.setItem('post_perfil_foto', perfilFotoBase64);
                    document.getElementById('perfilFotoPreview').innerHTML = `<img src="${perfilFotoBase64}" alt="Foto">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ==================== BANCOS DE IMAGENS ====================
        const _pk = '==wN5IjMyUjNhFmZxQTY3IGNkJDM0EzNxImZtIDOwQTM2QTN';
        const PIXABAY_KEY = (function(){ try { return atob(_pk.split('').reverse().join('')); } catch(e) { return ''; } })();
        const PEXELS_KEY = 'nYMWBpMFOaBkaFPcoJkuAVcPMxFsGHoMg3UyzhAGjrOyYlBUkKK4kDBl';

        // ---- PIXABAY (max 200 por pagina) ----
        async function buscarPixabayAPI(query, perPage = 15, page = 1) {
            try {
                const url = `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(query)}&image_type=photo&per_page=${Math.min(perPage, 200)}&page=${page}&safesearch=true&order=popular&lang=pt`;
                const resp = await fetch(url);
                if (!resp.ok) return [];
                const data = await resp.json();
                return (data.hits || []).map(h => ({
                    url: h.largeImageURL || h.webformatURL,
                    thumb: h.webformatURL,
                    credit: h.user + ' - Pixabay',
                    tags: h.tags,
                    likes: h.likes || 0,
                    fonte: 'pixabay'
                }));
            } catch(e) { return []; }
        }

        // ---- PEXELS (max 80 por pagina) ----
        async function buscarPexelsAPI(query, perPage = 15, page = 1) {
            try {
                const url = `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=${Math.min(perPage, 80)}&page=${page}&size=medium`;
                const resp = await fetch(url, { headers: { 'Authorization': PEXELS_KEY } });
                if (!resp.ok) return [];
                const data = await resp.json();
                return (data.photos || []).map(p => ({
                    url: p.src.large2x || p.src.large || p.src.original,
                    thumb: p.src.medium || p.src.small,
                    credit: p.photographer + ' - Pexels',
                    tags: p.alt || '',
                    likes: 0,
                    fonte: 'pexels'
                }));
            } catch(e) { return []; }
        }

        // ---- BUSCA UNIFICADA: Pixabay + Pexels simultâneo ----
        async function buscarPixabay(query, perPage = 20, page = 1) {
            // Buscar em TODOS os bancos ao mesmo tempo
            const [pixabay, pexels] = await Promise.allSettled([
                buscarPixabayAPI(query, perPage),
                buscarPexelsAPI(query, perPage)
            ]);

            let todas = [];
            if (pixabay.status === 'fulfilled') todas.push(...pixabay.value);
            if (pexels.status === 'fulfilled') todas.push(...pexels.value);

            console.log('[Busca] "' + query + '" -> Pixabay: ' + (pixabay.value?.length || 0) + ', Pexels: ' + (pexels.value?.length || 0) + ' = Total: ' + todas.length);

            // Intercalar resultados (1 pixabay, 1 pexels, 1 pixabay...)
            // para dar variedade
            const pixFotos = todas.filter(f => f.fonte === 'pixabay');
            const pexFotos = todas.filter(f => f.fonte === 'pexels');
            const intercaladas = [];
            const max = Math.max(pixFotos.length, pexFotos.length);
            for (let i = 0; i < max; i++) {
                if (i < pixFotos.length) intercaladas.push(pixFotos[i]);
                if (i < pexFotos.length) intercaladas.push(pexFotos[i]);
            }

            return {
                fotos: intercaladas.map(f => ({
                    url: f.url,
                    thumb: f.thumb,
                    credit: f.credit,
                    tags: f.tags
                })),
                total: intercaladas.length
            };
        }

        // Buscar imagem de pessoa na Wikipedia (famosos/historia)
        async function buscarImagemWikipedia(nome) {
            try {
                const [ptResp, enResp] = await Promise.allSettled([
                    fetch(`https://pt.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(nome)}&gsrlimit=3&prop=pageimages&piprop=original|thumbnail&pithumbsize=800&format=json&origin=*`),
                    fetch(`https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(nome)}&gsrlimit=3&prop=pageimages&piprop=original|thumbnail&pithumbsize=800&format=json&origin=*`)
                ]);

                // Tentar PT primeiro
                if (ptResp.status === 'fulfilled' && ptResp.value.ok) {
                    const data = await ptResp.value.json();
                    if (data.query && data.query.pages) {
                        const pages = Object.values(data.query.pages);
                        for (const page of pages) {
                            if (page.original) {
                                console.log('[Wiki PT] "' + nome + '" -> ' + page.title);
                                return page.original.source;
                            }
                            if (page.thumbnail) {
                                console.log('[Wiki PT] "' + nome + '" -> ' + page.title + ' (thumb)');
                                return page.thumbnail.source;
                            }
                        }
                    }
                }

                // Fallback EN
                if (enResp.status === 'fulfilled' && enResp.value.ok) {
                    const data = await enResp.value.json();
                    if (data.query && data.query.pages) {
                        const pages = Object.values(data.query.pages);
                        for (const page of pages) {
                            if (page.original) {
                                console.log('[Wiki EN] "' + nome + '" -> ' + page.title);
                                return page.original.source;
                            }
                            if (page.thumbnail) {
                                console.log('[Wiki EN] "' + nome + '" -> ' + page.title + ' (thumb)');
                                return page.thumbnail.source;
                            }
                        }
                    }
                }

                return '';
            } catch(e) {
                console.warn('[Wiki] erro:', e);
                return '';
            }
        }

        // Buscar logo/imagem de empresa no Pixabay (inclui ilustracoes e vetores)
        async function buscarLogoPixabay(nome) {
            // Tentar varias combinacoes para achar o melhor resultado
            const termos = [
                `${nome} logo`,
                `${nome} app`,
                `${nome} brand`,
                nome
            ];
            for (const termo of termos) {
                try {
                    const url = `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(termo)}&image_type=all&per_page=10&safesearch=true&order=popular`;
                    const resp = await fetch(url);
                    if (!resp.ok) continue;
                    const data = await resp.json();
                    if (data.hits && data.hits.length > 0) {
                        const pick = data.hits[0]; // primeiro resultado e geralmente o mais relevante
                        console.log('[Logo] "' + termo + '" -> OK (' + data.totalHits + ' resultados)');
                        return pick.largeImageURL || pick.webformatURL;
                    }
                } catch(e) {}
            }
            return '';
        }

        // Buscar 1 imagem para um slide (roteador por tipo)
        // isCapa = true so para o slide 1 (capa)
        async function buscarImagemParaSlide(query, isCapa = false) {
            // SÓ NA CAPA: buscar imagem especial conforme tipo
            if (isCapa && tipoImagem === 'empresa') {
                // Empresa: buscar logo no Pixabay (inclui vetores/ilustracoes)
                const logo = await buscarLogoPixabay(query);
                if (logo) return logo;
                // Fallback Wikipedia
                const wikiImg = await buscarImagemWikipedia(query);
                if (wikiImg) return wikiImg;
                console.log('[Posts] Logo nao encontrado para "' + query + '", usando Pixabay generico...');
            } else if (isCapa && (tipoImagem === 'famosos' || tipoImagem === 'historia')) {
                // Famosos/Historia: Wikipedia para foto da pessoa
                const wikiImg = await buscarImagemWikipedia(query);
                if (wikiImg) return wikiImg;
                console.log('[Posts] Wiki nao encontrou "' + query + '", tentando Pixabay...');
            }

            // Todos os outros slides + fallback: busca unificada (Pixabay + Pexels)
            const { fotos } = await buscarPixabay(query, 15);
            if (fotos.length > 0) {
                // Evitar imagens repetidas entre slides
                const disponivel = fotos.find(f => !imagensUsadas.has(f.url));
                const pick = disponivel || fotos[0];
                imagensUsadas.add(pick.url);
                console.log('[Busca] "' + query + '" -> ' + pick.credit);
                return pick.url;
            }
            // Fallback: tentar só a primeira palavra
            const primeira = query.split(/\s+/)[0];
            if (primeira && primeira !== query) {
                const { fotos: fotos2 } = await buscarPixabay(primeira, 15);
                if (fotos2.length > 0) {
                    const disponivel = fotos2.find(f => !imagensUsadas.has(f.url));
                    const pick = disponivel || fotos2[0];
                    imagensUsadas.add(pick.url);
                    return pick.url;
                }
            }
            return '';
        }

        // Tracker de imagens já usadas (evitar repetição)
        let imagensUsadas = new Set();

        // ==================== AI GENERATION ====================
        async function gerarPost() {
            // Verificar API configurada
            if (!APIConfig.isConfigured) {
                mostrarNotificacao('API nao configurada. Acesse o painel admin para configurar.', 'error');
                if (confirm('A chave da API DeepSeek nao esta configurada.\n\nDeseja ir ao painel admin para configurar?')) {
                    window.location.href = '../admin.html';
                }
                return;
            }

            const tema = document.getElementById('inputTema').value.trim();
            const conteudo = document.getElementById('inputConteudo').value.trim();
            const numSlides = parseInt(document.getElementById('numSlides').value) || 5;
            imagensUsadas = new Set(); // resetar tracker de imagens

            if (!tema && !conteudo) {
                mostrarNotificacao('Digite um tema ou conteudo', 'error');
                return;
            }

            const btn = document.getElementById('btnGenerate');
            btn.disabled = true;
            btn.innerHTML = '<svg viewBox="0 0 24 24" style="animation:spin 1s linear infinite"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg> Gerando...';
            showStatus('Gerando conteudo com IA...');

            const systemPrompt = `Voce e um estrategista de conteudo e copywriter especialista em posts virais para Instagram. Sua especialidade e criar GANCHOS IRRESISTIVEIS na capa que fazem as pessoas pararem de rolar o feed e quererem ler todos os slides.
REGRA DE OURO DA CAPA: O titulo da capa NUNCA deve ser generico ou descritivo. Ele DEVE ser um GANCHO que gere CURIOSIDADE, URGENCIA ou CONTROVERSIA. Use tecnicas como: pergunta provocadora, afirmacao surpreendente, "o que ninguem te conta", numeros impactantes, promessa de transformacao, ou revelacao de segredo.
EXEMPLOS DE GANCHOS RUINS (NUNCA use): "Dicas de produtividade", "Tudo sobre marketing", "Beneficios do exercicio"
EXEMPLOS DE GANCHOS BONS: "VOCE ESTA PERDENDO DINHEIRO SEM SABER", "O ERRO QUE 90% DOS INICIANTES COMETEM", "PARE DE FAZER ISSO AGORA", "NINGUEM TE CONTOU ESSE SEGREDO"
Sempre responda em portugues brasileiro com acentos corretos.
Retorne APENAS o JSON solicitado, sem explicacoes ou markdown.`;

            let userPrompt = '';
            if (conteudo && !tema) {
                // Modo 3: colar texto
                userPrompt = `Transforme o texto abaixo em um carrossel de ${numSlides} slides para Instagram:

TEXTO:
${conteudo}`;
            } else if (tema && conteudo) {
                // Modo 2: tema + conteudo
                userPrompt = `Crie um carrossel de ${numSlides} slides para Instagram sobre:
TEMA: ${tema}
CONTEUDO BASE: ${conteudo}`;
            } else {
                // Modo 1: so tema
                userPrompt = `Crie um carrossel de ${numSlides} slides para Instagram sobre: ${tema}`;
            }

            // Regra de busca_imagem para famosos/historia: a IA precisa informar o nome da pessoa na capa
            let regraCapa = '';
            if (tipoImagem === 'famosos') {
                regraCapa = `\n6. busca_pessoa: NO SLIDE 1 (CAPA), inclua o campo "busca_pessoa" com o NOME COMPLETO da pessoa famosa principal do tema. Ex: "Anitta", "Neymar Jr", "Elon Musk". A foto sera buscada na Wikipedia.`;
            } else if (tipoImagem === 'historia') {
                regraCapa = `\n6. busca_pessoa: NO SLIDE 1 (CAPA), inclua o campo "busca_pessoa" com o NOME COMPLETO do personagem historico. Ex: "Albert Einstein", "Dom Pedro II". A foto sera buscada na Wikipedia.`;
            }

            // Regra extra: campo "destaque" opcional (glow azul para noticia, risco vermelho para post)
            let regraDestaque = '';
            if (designerModelo === 'post') {
                regraDestaque = `\n8. destaque: OPCIONAL — em apenas 1 ou 2 slides no maximo (NAO em todos!), inclua o campo "destaque" com 1 PALAVRA-CHAVE que sera marcada com um risco vermelho estilo caneta. Use SOMENTE quando a palavra for realmente impactante e fizer sentido visual. A maioria dos slides NAO deve ter destaque. Ex: destaque="PRODUTO". Se nao houver palavra que mereca destaque, NAO inclua o campo.`;
            } else {
                regraDestaque = `\n8. destaque: OPCIONAL — em apenas 1 ou 2 slides INTERNOS no maximo (NUNCA na capa!), inclua o campo "destaque" com 1 PALAVRA-CHAVE que DEVE existir no titulo (headline). Essa palavra recebera um risco amarelo embaixo no titulo e ficara em negrito no body. Use SOMENTE quando a palavra for impactante. A maioria dos slides NAO deve ter destaque. Ex: destaque="SEGREDO". Se nao houver palavra forte, NAO inclua o campo.`;
            }

            // Regra extra para modo Sem Imagem: ícones 3D
            let regraIcone = '';
            if (designerModelo === 'noticia-si') {
                regraIcone = `\n9. icone: OBRIGATORIO em TODOS os slides (incluindo capa). Inclua o campo "icone" com UMA palavra-chave em INGLES que represente visualmente o assunto do slide. O icone sera buscado no Icons8 3D Fluency. Use nomes simples e comuns como: "instagram", "target", "brain", "money", "rocket", "light-bulb", "chart", "trophy", "clock", "gear", "shield", "star", "heart", "fire", "diamond", "crown", "medal", "puzzle", "key", "lock", "megaphone", "camera", "video", "music", "book", "graduation-cap", "briefcase", "handshake", "thumbs-up", "check-mark", "warning", "idea", "strategy", "growth", "goal". Para redes sociais use: "instagram-new", "tiktok", "youtube", "facebook-new", "twitter", "linkedin", "whatsapp". SEMPRE escolha um icone que tenha relacao direta com o conteudo do slide.`;
            }

            // Regra de tipo de conteúdo
            let regraConteudo = '';
            const numInternos = numSlides - 1;
            if (tipoConteudo === 'dicas') {
                regraConteudo = `\nTIPO DE CONTEUDO: DICAS — SIGA OBRIGATORIAMENTE
- A CAPA DEVE ter um gancho que inclua o numero de dicas. NUNCA use titulo generico. Use formato provocador como: "${numInternos} ERROS QUE VOCE COMETE SEM PERCEBER" ou "${numInternos} SEGREDOS QUE VÃO MUDAR SEU JOGO" ou "PARE TUDO E LEIA ESTAS ${numInternos} DICAS".
- Cada slide interno (2 a ${numSlides}) DEVE ser UMA dica. NAO coloque numeros no headline — os numeros sao elementos visuais automaticos do designer.
- O headline deve ser apenas o titulo da dica SEM numero. Ex: "POSTE NOS HORARIOS CERTOS" (e NAO "1. Poste nos horarios certos").
- O body de cada slide explica brevemente a dica com linguagem pratica e direta.`;
            } else if (tipoConteudo === 'passos') {
                regraConteudo = `\nTIPO DE CONTEUDO: PASSO A PASSO — SIGA OBRIGATORIAMENTE
- A CAPA DEVE ter um gancho que indique os passos. Use formato que gere urgencia como: "${numInternos} PASSOS QUE VÃO TRANSFORMAR SEU X" ou "SIGA ESTES ${numInternos} PASSOS E NUNCA MAIS ERRE" ou "O METODO DE ${numInternos} PASSOS QUE NINGUEM ENSINA".
- Cada slide interno DEVE ser UM passo em ordem logica. NAO coloque numeros no headline — os numeros sao elementos visuais automaticos do designer.
- O headline deve ser apenas o titulo do passo SEM numero. Ex: "DEFINA SEU PUBLICO ALVO" (e NAO "1. Defina seu publico alvo").
- Os passos devem seguir uma sequencia logica do inicio ao fim.`;
            } else if (tipoConteudo === 'mitos') {
                regraConteudo = `\nTIPO DE CONTEUDO: MITOS E VERDADES — SIGA OBRIGATORIAMENTE
- A CAPA DEVE ter um gancho provocador que desafie crencas. Use formato como: "TUDO QUE VOCE SABE SOBRE X ESTA ERRADO" ou "VOCE AINDA ACREDITA NESSAS MENTIRAS?" ou "MITOS QUE ESTÃO SABOTANDO SEU X".
- Cada slide interno apresenta UM mito ou verdade. O headline DEVE comecar com "MITO:" ou "VERDADE:" seguido da afirmacao. Ex: "MITO: Agua com limao emagrece" ou "VERDADE: Dormir bem aumenta foco"
- O body explica porque e mito ou verdade com fatos concretos.
- Alterne entre mitos e verdades para manter o interesse. Use mais ou menos 50% de cada.`;
            } else if (tipoConteudo === 'motivacional') {
                regraConteudo = `\nTIPO DE CONTEUDO: MOTIVACIONAL — SIGA OBRIGATORIAMENTE
- Tom inspirador, empoderador e positivo.
- A CAPA DEVE ter uma frase de impacto que emocione e faca a pessoa parar. Use ganchos como: "O DIA QUE VOCE DECIDIR MUDAR TUDO MUDA" ou "SE VOCE ESTA CANSADO LEIA ISSO" ou "A VERDADE QUE VOCE PRECISA OUVIR HOJE".
- Os slides internos devem ter frases motivacionais, reflexoes profundas e mensagens de superacao relacionadas ao tema.
- Headlines devem ser frases curtas e poderosas que inspirem acao.
- O body complementa com uma reflexao ou chamada para acao.
- Use linguagem que emocione e motive. Evite ser generico — conecte ao tema especifico.`;
            } else if (tipoConteudo === 'noticia') {
                regraConteudo = `\nTIPO DE CONTEUDO: NOTICIA — SIGA OBRIGATORIAMENTE
- Tom jornalistico, informativo e urgente.
- A CAPA DEVE parecer uma manchete URGENTE de portal de noticias. Use ganchos como: "URGENTE: NOVA LEI MUDA TUDO NO MERCADO" ou "BOMBA: O QUE ACABOU DE SER REVELADO SOBRE X" ou "ATENCAO: ISSO VAI AFETAR VOCE DIRETAMENTE".
- Os slides internos apresentam a noticia com comeco (o que aconteceu), meio (detalhes e contexto) e fim (impacto e o que muda).
- Use dados, numeros e fatos quando possivel.
- Headlines devem ser diretos e informativos como manchetes.
- O body traz detalhes factuais. Evite opiniao, mantenha imparcialidade.`;
            } else if (tipoConteudo === 'informal') {
                regraConteudo = `\nTIPO DE CONTEUDO: INFORMAL / POST — SIGA OBRIGATORIAMENTE
- Tom descontraido, leve e conversacional como se estivesse falando com um amigo.
- A CAPA DEVE ter um gancho casual mas irresistivel. Use formato como: "ninguem te conta isso sobre X" ou "a real sobre X que voce precisa saber" ou "se voce faz X, para agora e le isso".
- Use linguagem do dia a dia, girias leves, humor quando caber.
- Headlines podem ser perguntas, exclamacoes ou frases coloquiais.
- O body deve ser como uma conversa — direto, sem formalidade excessiva.
- Pode usar expressoes como "serio mesmo", "olha so", "a real e que", "spoiler:", "plot twist:".`;
            }

            userPrompt += `

REGRAS:
1. Slide 1 e SEMPRE a CAPA. ${designerModelo === 'post' ? 'O titulo da capa deve ser um GANCHO irresistivel em frase natural (NAO use maiusculas). Deve gerar curiosidade ou urgencia para a pessoa querer ler os proximos slides. Subtitulo curto (maximo 8 palavras). NUNCA use titulos genericos como "Dicas de X" — use ganchos como "O erro que esta sabotando seu X" ou "Ninguem te conta isso sobre X".' : 'REGRA CRITICA DO TITULO DA CAPA: O titulo DEVE ser um GANCHO IRRESISTIVEL com 5 a 8 palavras TODAS EM MAIUSCULAS. DEVE gerar CURIOSIDADE ou URGENCIA — algo que faca a pessoa PARAR de rolar o feed e querer ler. O titulo TEM QUE ocupar EXATAMENTE 2 linhas completas e cheias — NUNCA 1 linha + 1 palavra solta. NUNCA use titulos genericos descritivos. Use ganchos como: "VOCE ESTA FAZENDO ISSO ERRADO E NAO SABE", "O SEGREDO QUE NINGUEM TE CONTA SOBRE X", "PARE DE COMETER ESSE ERRO AGORA". Subtitulo: 8 a 15 palavras minusculas ocupando 2 linhas cheias, complementando o gancho com promessa de valor.'}
2. Slides 2 a ${numSlides} sao conteudo com começo, meio e fim logico
3. Cada slide deve manter o MESMO ASSUNTO, com progresso na informacao
4. headline: titulo curto e impactante (maximo 6 palavras)
5. body: texto explicativo direto, maximo 3 linhas curtas${regraCapa}
7. A numeracao dos slides internos e opcional - use quando fizer sentido (listas, passos, dicas)${regraDestaque}${regraIcone}${regraConteudo}
10. busca_imagem: OBRIGATORIO em CADA slide. Inclua o campo "busca_imagem" com 1-3 palavras-chave em PORTUGUES que descrevam uma imagem ESPECIFICA para aquele slide. A busca sera feita no Pixabay. Cada slide DEVE ter uma busca DIFERENTE e RELACIONADA ao conteudo especifico daquele slide. NUNCA use a mesma busca para todos os slides. Ex: se o slide fala de "acordar cedo", use busca_imagem="pessoa acordando cedo". Se fala de "investimento", use busca_imagem="grafico financeiro investimento".

Retorne EXATAMENTE este JSON:
{
    "slides": [
        {
            "numero": 1,
            "tipo": "capa",
            "headline": "${designerModelo === 'post' ? 'O erro que esta sabotando sua produtividade' : 'VOCE ESTA PERDENDO TEMPO SEM SABER DISSO'}",
            "body": "${designerModelo === 'post' ? 'Descubra o que muda tudo' : 'Descubra os segredos que podem transformar completamente a sua rotina diaria'}",
            "busca_imagem": "pessoa trabalhando produtividade"${tipoImagem === 'famosos' || tipoImagem === 'historia' ? ',\n            "busca_pessoa": "Nome Completo"' : ''}${designerModelo === 'post' ? ',\n            "destaque": "PRODUTIVIDADE"' : ''}${designerModelo === 'noticia-si' ? ',\n            "icone": "rocket"' : ''}
        },
        {
            "numero": 2,
            "tipo": "conteudo",
            "headline": "Primeiro Ponto",
            "body": "Texto explicativo curto e direto ao ponto.",
            "busca_imagem": "organizacao planejamento"${designerModelo !== 'post' ? ',\n            "destaque": "Ponto"' : ''}${designerModelo === 'noticia-si' ? ',\n            "icone": "light-bulb"' : ''}
        }
    ],
    "legenda": "Texto completo da legenda para Instagram com emojis",
    "hashtags": "#hashtag1 #hashtag2 #hashtag3 #hashtag4 #hashtag5 #hashtag6 #hashtag7 #hashtag8 #hashtag9 #hashtag10",
    "cta_legenda": "Salve este post e compartilhe com alguem que precisa!"
}`;

            try {
                console.log('[Posts] Chamando API DeepSeek...');
                const resposta = await chamarAPI(systemPrompt, userPrompt);
                console.log('[Posts] Resposta recebida:', resposta.substring(0, 200));

                let jsonLimpo = resposta.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const jsonMatch = jsonLimpo.match(/\{[\s\S]*\}/);
                if (jsonMatch) jsonLimpo = jsonMatch[0];

                dadosGerados = JSON.parse(jsonLimpo);
                console.log('[Posts] JSON parsed, slides:', dadosGerados.slides?.length);

                // ===== MONTAR TERMOS DE BUSCA =====
                const temaOriginal = tema || conteudo.split(/[.\n]/)[0].trim();
                const prefixos = /^(a historia d[aoe]s?|historia d[aoe]s?|como fazer|como criar|como|o que [eé]|tudo sobre|dicas de|dicas para|guia d[aoe]s?|guia completo|guia para|passo a passo|erros que|o que ningu[eé]m|antes e depois|mito vs verdade|por que|porque|beneficios d[aoe]s?|vantagens d[aoe]s?|segredos d[aoe]s?|\d+ dicas d[aoe]s?|\d+ dicas)\s*/i;
                const temaChave = temaOriginal.replace(prefixos, '').trim() || temaOriginal;
                console.log('[Posts] Tema: "' + temaOriginal + '" -> Chave busca: "' + temaChave + '"');

                // Garantir que cada slide tenha busca_imagem (fallback para temaChave se IA não retornou)
                dadosGerados.slides.forEach((slide, i) => {
                    if (!slide.busca_imagem || slide.busca_imagem.trim() === '') {
                        slide.busca_imagem = temaChave;
                    }
                });

                // Sem Imagem: pular busca de fotos
                if (designerModelo === 'noticia-si') {
                    dadosGerados.slides.forEach(s => { s.bgImage = ''; });
                    hideStatus();
                    renderizarSlides();
                    document.getElementById('previewSection').style.display = 'block';
                    atualizarLegenda();
                    btn.disabled = false;
                    btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg> Gerar slides';
                    return;
                }

                showStatus('Buscando imagens por slide...');

                // ===== BUSCA DE IMAGENS POR SLIDE (keywords específicas) =====
                // Cada slide busca suas próprias imagens com base no busca_imagem da IA

                // Carregar histórico global de imagens já usadas
                const storageKey = 'imgs_usadas_' + temaChave.toLowerCase().replace(/\s+/g, '_');
                let jaUsadas = new Set();
                try {
                    const saved = localStorage.getItem(storageKey);
                    if (saved) jaUsadas = new Set(JSON.parse(saved));
                } catch(e) {}

                // Buscar imagens individualmente para cada slide
                for (const slide of dadosGerados.slides) {
                    const isCapa = slide.tipo === 'capa' || slide.numero === 1;

                    // Famosos/Historia: capa busca na Wikipedia
                    if (isCapa && (tipoImagem === 'famosos' || tipoImagem === 'historia') && slide.busca_pessoa) {
                        const wikiImg = await buscarImagemWikipedia(slide.busca_pessoa);
                        if (wikiImg) { slide.bgImage = wikiImg; continue; }
                    }

                    // Empresa: capa busca logo
                    if (isCapa && tipoImagem === 'empresa') {
                        const logo = await buscarLogoPixabay(temaChave);
                        if (logo) { slide.bgImage = logo; continue; }
                    }

                    // Buscar fotos específicas para este slide usando busca_imagem da IA
                    const buscaSlide = slide.busca_imagem || temaChave;
                    console.log('[Posts] Slide ' + slide.numero + ' buscando: "' + buscaSlide + '"');

                    let fotosSlide = [];
                    try {
                        const url = `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(buscaSlide)}&image_type=photo&per_page=30&safesearch=true&lang=pt`;
                        const resp = await fetch(url);
                        if (resp.ok) {
                            const data = await resp.json();
                            fotosSlide = (data.hits || []).map(h => h.largeImageURL || h.webformatURL);
                        }
                    } catch(e) { console.warn('[Slide ' + slide.numero + '] erro busca:', e); }

                    // Se busca específica não retornou, tentar com temaChave genérico
                    if (fotosSlide.length === 0 && buscaSlide !== temaChave) {
                        console.log('[Posts] Slide ' + slide.numero + ' fallback para tema: "' + temaChave + '"');
                        try {
                            const url = `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(temaChave)}&image_type=photo&per_page=30&safesearch=true&lang=pt`;
                            const resp = await fetch(url);
                            if (resp.ok) {
                                const data = await resp.json();
                                fotosSlide = (data.hits || []).map(h => h.largeImageURL || h.webformatURL);
                            }
                        } catch(e) {}
                    }

                    // Filtrar já usadas e pegar uma aleatória
                    let fotosNovas = fotosSlide.filter(url => !jaUsadas.has(url));
                    if (fotosNovas.length === 0) fotosNovas = fotosSlide; // Se todas usadas, reutilizar

                    if (fotosNovas.length > 0) {
                        const randomIdx = Math.floor(Math.random() * Math.min(5, fotosNovas.length)); // Top 5 mais relevantes
                        slide.bgImage = fotosNovas[randomIdx];
                        jaUsadas.add(fotosNovas[randomIdx]);
                    }
                }

                // Salvar histórico no localStorage
                try {
                    localStorage.setItem(storageKey, JSON.stringify([...jaUsadas]));
                } catch(e) {}

                hideStatus();
                renderizarSlides();
                document.getElementById('previewSection').style.display = 'block';
                atualizarLegenda();

            } catch(error) {
                console.error('[Posts] ERRO:', error);
                hideStatus();
                mostrarNotificacao('Erro: ' + error.message, 'error');
                alert('Erro ao gerar post:\n\n' + error.message + '\n\nVeja o console (F12) para mais detalhes.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg> Gerar slides';
            }
        }

        // ==================== RENDER SLIDES ====================
        function renderizarSlides() {
            if (!dadosGerados) return;
            const container = document.getElementById('slidesContainer');
            const perfilNome = document.getElementById('perfilNome').value.trim();
            const perfilArroba = document.getElementById('perfilArroba').value.trim();
            const logoAtivo = document.getElementById('logoAtivo').checked;
            const logoPosicao = document.getElementById('logoPosicao').value;

            // Determinar layout conforme designer
            const isNoticia = designerModelo === 'noticia' || designerModelo === 'noticia-si';
            const isPost = designerModelo === 'post';
            const isSemImagem = designerModelo === 'noticia-si';
            const layoutNum = isSemImagem ? (currentLayoutIndex % 3) + 6 : (currentLayoutIndex % 5) + 1;

            let html = '';
            dadosGerados.slides.forEach((slide, index) => {
                const isCapa = slide.tipo === 'capa';
                const hasImage = slide.bgImage && slide.bgImage.trim() !== '';
                const bgStyle = hasImage ? `background-image: url('${slide.bgImage}'); background-size: cover; background-position: center;` : '';
                const noBgClass = hasImage ? '' : 'no-bg-image';
                const badge = isCapa ? '<div class="slide-badge">CAPA</div>' : '';

                // Logo HTML
                let logoHTML = '';
                if (logoAtivo && (perfilNome || perfilArroba)) {
                    const posMap = { 'bottom-right': 'bottom:10px;right:12px;', 'bottom-left': 'bottom:10px;left:12px;', 'top-right': 'top:10px;right:12px;', 'top-left': 'top:10px;left:12px;' };
                    logoHTML = `<div style="position:absolute;${posMap[logoPosicao]}z-index:15;display:flex;align-items:center;gap:5px;font-size:0.55rem;color:rgba(255,255,255,0.7);">
                        ${perfilFotoBase64 ? `<img src="${perfilFotoBase64}" style="width:16px;height:16px;border-radius:50%;object-fit:cover;">` : ''}
                        <span>${perfilArroba || perfilNome}</span>
                    </div>`;
                }

                // ===== MODO NOTICIA =====
                if (isNoticia) {
                    const slideClass = isCapa ? 'noticia-capa' : `noticia-${layoutNum}`;
                    let headlineHTML = slide.headline || '';
                    let bodyHTML = slide.body || '';
                    // Emphasis rendering — risco amarelo SÓ no título, negrito no body
                    if (!isCapa && slide.destaque) {
                        const escapedDestaque = slide.destaque.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        // Título: risco amarelo embaixo da palavra
                        headlineHTML = headlineHTML.replace(new RegExp(`(${escapedDestaque})`, 'gi'), `<span class="noticia-emphasis">$1</span>`);
                        // Body: negrito na mesma palavra (sem risco)
                        bodyHTML = bodyHTML.replace(new RegExp(`(${escapedDestaque})`, 'gi'), `<span class="noticia-bold">$1</span>`);
                    }
                    const totalSlides = dadosGerados.slides.length;
                    const isLastSlide = index === totalSlides - 1;
                    const showSwipe = !isCapa && !isLastSlide && totalSlides > 1;

                    // Elementos decorativos reais (divs)
                    let noticiaExtras = '';
                    if (isCapa) {
                        const lineClass = gradientLinePosition === 0 ? 'line-bottom' : 'line-left';
                        noticiaExtras = `<div class="noticia-line ${lineClass}"></div>`;
                    } else {
                        const decoHTML = `<div class="noticia-deco-a"></div><div class="noticia-deco-b"></div><div class="noticia-deco-c"></div>`;
                        const decoMap = {
                            1: decoHTML, 2: decoHTML, 3: decoHTML, 4: decoHTML, 5: decoHTML,
                            6: decoHTML, 7: decoHTML, 8: decoHTML
                        };
                        noticiaExtras = decoMap[layoutNum] || '';
                    }

                    // Ícone 3D (apenas para modo sem imagem — modelos 6-10)
                    let iconHTML = '';
                    if (isSemImagem && slide.icone) {
                        const iconSlug = slide.icone.toLowerCase().replace(/\s+/g, '-');
                        iconHTML = `<div class="noticia-icon"><img src="https://img.icons8.com/3d-fluency/256/${iconSlug}.png" alt="" onerror="this.parentElement.style.display='none'"></div>`;
                    }

                    // Número decorativo visual (todos os modelos sem-imagem 6-10, exceto capa)
                    let slideNumberHTML = '';
                    if (isSemImagem && !isCapa) {
                        const slideNum = index;
                        slideNumberHTML = `<div class="noticia-slide-number">${String(slideNum).padStart(2, '0')}</div>`;
                    }

                    // Swipe indicator (sutil, só em slides internos)
                    const swipeHTML = showSwipe ? `<div class="swipe-indicator"><svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></div>` : '';

                    html += `
                    <div class="slide-wrap" data-index="${index}">
                        <div class="slide-card ${slideClass} ${fundoTema === 'claro' ? 'fundo-claro' : ''} ${isCapa ? 'is-cover' : ''} ${noBgClass}" id="slide-${index}">
                            <div class="slide-bg" style="${bgStyle}"></div>
                            <div class="slide-overlay"></div>
                            ${noticiaExtras}
                            ${iconHTML}
                            ${slideNumberHTML}
                            ${logoHTML}
                            ${isCapa ? `
                            <div class="slide-content">
                                <div class="slide-headline" contenteditable="false">${headlineHTML}</div>
                                <div class="slide-body" contenteditable="false">${bodyHTML}</div>
                            </div>
                            ` : `
                            <div class="noticia-glass-card">
                                <div class="slide-content">
                                    <div class="slide-headline" contenteditable="false">${headlineHTML}</div>
                                    <div class="slide-body" contenteditable="false">${bodyHTML}</div>
                                </div>
                            </div>
                            ${swipeHTML}
                            `}
                        </div>
                        <div class="slide-edit-overlay">
                            <button class="slide-edit-btn" onclick="editarSlide(${index})">
                                <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                                Editar
                            </button>
                            <button class="slide-edit-btn" onclick="trocarImagem(${index})">
                                <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                Substituir
                            </button>
                            <button class="slide-edit-btn" onclick="cortarImagem(${index})">
                                <svg viewBox="0 0 24 24"><path d="M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"/></svg>
                                Cortar
                            </button>
                            <button class="slide-edit-btn" onclick="excluirImagem(${index})">
                                <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                            </button>
                            <button class="slide-edit-btn" onclick="baixarSlide(${index})">
                                <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                            </button>
                        </div>
                        <div class="edit-toolbar" id="toolbar-${index}">
                            <div class="edit-row">
                                <div class="edit-group">
                                    <label>Fonte</label>
                                    <select onchange="mudarFonte(${index},this.value)">
                                        <option value="Montserrat">Montserrat</option>
                                        <option value="Inter">Inter</option>
                                        <option value="Poppins">Poppins</option>
                                        <option value="Playfair Display">Playfair</option>
                                        <option value="Dancing Script">Dancing Script</option>
                                        <option value="Caveat">Caveat</option>
                                        <option value="Pacifico">Pacifico</option>
                                        <option value="Satisfy">Satisfy</option>
                                        <option value="Great Vibes">Great Vibes</option>
                                        <option value="Sacramento">Sacramento</option>
                                    </select>
                                </div>
                                <div class="edit-group">
                                    <button class="edit-btn-icon" onclick="toggleNegrito(${index})" title="Negrito"><b>B</b></button>
                                </div>
                                <div class="edit-group">
                                    <label>Cor</label>
                                    <input type="color" value="#ffffff" onchange="mudarCorTexto(${index},this.value)">
                                </div>
                            </div>
                            <div class="edit-row">
                                <div class="edit-group">
                                    <label>Tamanho</label>
                                    <input type="range" min="8" max="28" value="16" oninput="mudarTamanho(${index},this.value)">
                                </div>
                                <div class="edit-group">
                                    <label>Entrelinhas</label>
                                    <input type="range" min="8" max="30" value="15" oninput="mudarEspacamento(${index},this.value)">
                                </div>
                            </div>
                        </div>
                    </div>`;

                // ===== MODO POST =====
                } else {
                    const slideClass = isCapa ? 'post-capa' : `post-${layoutNum}`;
                    const totalSlides = dadosGerados.slides.length;

                    // Emphasis rendering — estilo riscado com caneta (marker)
                    let headlineHTML = slide.headline || '';
                    let bodyHTML = slide.body || '';
                    if (slide.destaque) {
                        const escapedDestaque = slide.destaque.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const re = new RegExp(`(${escapedDestaque})`, 'gi');
                        if (re.test(headlineHTML)) {
                            headlineHTML = headlineHTML.replace(new RegExp(`(${escapedDestaque})`, 'gi'), `<span class="post-emphasis">$1</span>`);
                        } else {
                            bodyHTML = bodyHTML.replace(new RegExp(`(${escapedDestaque})`, 'gi'), `<span class="post-emphasis">$1</span>`);
                        }
                    }

                    // Profile header (sem verificado, sem linha)
                    const postProfileHTML = `<div class="post-profile">
                        ${perfilFotoBase64 ? `<img src="${perfilFotoBase64}" class="post-profile-pic" alt="">` : `<div class="post-profile-pic-placeholder"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>`}
                        <div class="post-profile-info">
                            <span class="post-profile-name">${perfilNome || 'Seu Nome'}</span>
                            <span class="post-profile-handle">${perfilArroba || '@perfil'}</span>
                        </div>
                    </div>`;

                    // Slide counter (ex: 1/7)
                    const counterHTML = `<div class="post-counter">${index + 1}/${totalSlides}</div>`;

                    // Inline image — varia por modelo
                    const postHasImg = slide.bgImage && slide.bgImage.trim() !== '';
                    let inlineImgHTML = '';

                    if (isCapa) {
                        // Capa: imagem grande centralizada embaixo (se tiver)
                        if (postHasImg) inlineImgHTML = `<img class="post-inline-img post-img-centered" src="${slide.bgImage}" alt="" style="margin-top:12px;">`;
                    } else if (layoutNum === 1) {
                        // Modelo 1: imagem full-width embaixo
                        if (postHasImg) inlineImgHTML = `<img class="post-inline-img post-img-single" src="${slide.bgImage}" alt="">`;
                    } else if (layoutNum === 2) {
                        // Modelo 2: sem imagem (texto puro centralizado)
                        inlineImgHTML = '';
                    } else if (layoutNum === 3) {
                        // Modelo 3: imagem no topo
                        if (postHasImg) inlineImgHTML = `<img class="post-inline-img post-img-single" src="${slide.bgImage}" alt="">`;
                    } else if (layoutNum === 4) {
                        // Modelo 4: duas imagens lado a lado (usa mesma imagem 2x como placeholder)
                        if (postHasImg) inlineImgHTML = `<div class="post-img-row"><img class="post-inline-img" src="${slide.bgImage}" alt=""><img class="post-inline-img" src="${slide.bgImage}" alt=""></div>`;
                    } else if (layoutNum === 5) {
                        // Modelo 5: sem imagem (texto puro)
                        inlineImgHTML = '';
                    }

                    // Content structure varies by model
                    let contentInner = '';
                    if ((layoutNum === 3) && !isCapa) {
                        // Model 3: image FIRST, then text
                        contentInner = `
                            ${inlineImgHTML}
                            <div class="post-text">
                                <div class="slide-headline" contenteditable="false">${headlineHTML}</div>
                                <div class="slide-body" contenteditable="false">${bodyHTML}</div>
                            </div>`;
                    } else {
                        // All other models: text first, image at bottom (if applicable)
                        contentInner = `
                            <div class="post-text">
                                <div class="slide-headline" contenteditable="false">${headlineHTML}</div>
                                <div class="slide-body" contenteditable="false">${bodyHTML}</div>
                            </div>
                            ${inlineImgHTML}`;
                    }

                    html += `
                    <div class="slide-wrap" data-index="${index}">
                        <div class="slide-card ${slideClass} ${isCapa ? 'is-cover' : ''}" id="slide-${index}">
                            ${counterHTML}
                            ${badge}
                            <div class="slide-content">
                                ${postProfileHTML}
                                ${contentInner}
                            </div>
                            <div class="slide-edit-overlay">
                                <button class="slide-edit-btn" onclick="editarSlide(${index})">
                                    <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                                    Editar
                                </button>
                                <button class="slide-edit-btn" onclick="baixarSlide(${index})">
                                    <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                                </button>
                            </div>
                            <div class="img-edit-actions">
                                <button class="img-edit-btn" onclick="trocarImagem(${index})" title="Substituir imagem">
                                    <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                    Substituir
                                </button>
                                <button class="img-edit-btn" onclick="cortarImagem(${index})" title="Cortar imagem">
                                    <svg viewBox="0 0 24 24"><path d="M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"/></svg>
                                    Cortar
                                </button>
                                <button class="img-edit-btn" onclick="excluirImagem(${index})" title="Excluir imagem">
                                    <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                                    Excluir
                                </button>
                            </div>
                        </div>
                        <div class="edit-toolbar" id="toolbar-${index}">
                            <div class="edit-row">
                                <div class="edit-group">
                                    <label>Fonte</label>
                                    <select onchange="mudarFonte(${index},this.value)">
                                        <option value="Inter">Inter</option>
                                        <option value="Montserrat">Montserrat</option>
                                        <option value="Poppins">Poppins</option>
                                        <option value="Playfair Display">Playfair</option>
                                        <option value="Dancing Script">Dancing Script</option>
                                        <option value="Caveat">Caveat</option>
                                        <option value="Pacifico">Pacifico</option>
                                        <option value="Satisfy">Satisfy</option>
                                        <option value="Great Vibes">Great Vibes</option>
                                        <option value="Sacramento">Sacramento</option>
                                    </select>
                                </div>
                                <div class="edit-group">
                                    <button class="edit-btn-icon" onclick="toggleNegrito(${index})" title="Negrito"><b>B</b></button>
                                </div>
                                <div class="edit-group">
                                    <label>Cor</label>
                                    <input type="color" value="#1a1a1a" onchange="mudarCorTexto(${index},this.value)">
                                </div>
                            </div>
                            <div class="edit-row">
                                <div class="edit-group">
                                    <label>Tamanho</label>
                                    <input type="range" min="8" max="28" value="14" oninput="mudarTamanho(${index},this.value)">
                                </div>
                                <div class="edit-group">
                                    <label>Entrelinhas</label>
                                    <input type="range" min="8" max="30" value="15" oninput="mudarEspacamento(${index},this.value)">
                                </div>
                            </div>
                        </div>
                    </div>`;

                }
            });

            container.innerHTML = html;
        }

        // ==================== EDIT FUNCTIONS ====================
        function salvarEFecharEdicao() {
            // Salvar conteudo de todos os editaveis ativos
            document.querySelectorAll('.slide-headline[contenteditable="true"]').forEach(el => {
                const card = el.closest('.slide-card');
                if (card) {
                    const idx = parseInt(card.id.replace('slide-', ''));
                    if (dadosGerados && dadosGerados.slides[idx]) {
                        dadosGerados.slides[idx].headline = el.innerHTML;
                    }
                }
            });
            document.querySelectorAll('.slide-body[contenteditable="true"]').forEach(el => {
                const card = el.closest('.slide-card');
                if (card) {
                    const idx = parseInt(card.id.replace('slide-', ''));
                    if (dadosGerados && dadosGerados.slides[idx]) {
                        dadosGerados.slides[idx].body = el.innerHTML;
                    }
                }
            });
            // Fechar toolbars e resetar editaveis
            document.querySelectorAll('.edit-toolbar').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.slide-wrap').forEach(w => w.classList.remove('editing'));
            document.querySelectorAll('.slide-headline, .slide-body').forEach(el => {
                el.contentEditable = 'false';
                el.style.cursor = '';
                el.style.outline = '';
                el.style.borderRadius = '';
            });
            editingSlideIndex = -1;
        }

        // Fechar edicao ao clicar fora do slide/toolbar
        document.addEventListener('click', function(e) {
            if (editingSlideIndex < 0) return;
            const clickedWrap = e.target.closest('.slide-wrap');
            const clickedToolbar = e.target.closest('.edit-toolbar');
            if (!clickedWrap && !clickedToolbar) {
                salvarEFecharEdicao();
            }
        });

        function editarSlide(index) {
            // Toggle toolbar
            const toolbar = document.getElementById(`toolbar-${index}`);
            const isActive = toolbar.classList.contains('active');

            // Salvar e fechar edicao anterior
            salvarEFecharEdicao();

            if (!isActive) {
                toolbar.classList.add('active');
                // Mark slide-wrap as editing (hides overlay)
                const wrap = toolbar.closest('.slide-wrap');
                if (wrap) wrap.classList.add('editing');
                // Enable contenteditable on this slide
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline, .slide-body').forEach(el => {
                    el.contentEditable = 'true';
                    el.style.cursor = 'text';
                    el.style.outline = '1px dashed rgba(0,180,216,0.5)';
                    el.style.borderRadius = '4px';
                });
                editingSlideIndex = index;
                // Ativar drag de imagem e perfil (Post)
                initDragMovers(index);
            }
        }

        // Helper: aplica estilo na selecao de texto ou retorna false
        function aplicarEstiloNaSelecao(prop, value) {
            const sel = window.getSelection();
            if (sel && sel.rangeCount > 0 && !sel.isCollapsed) {
                const range = sel.getRangeAt(0);
                // Verifica se a selecao esta dentro de um slide em modo de edicao
                const container = range.commonAncestorContainer;
                const editableParent = container.nodeType === 3 ? container.parentElement : container;
                if (!editableParent || !editableParent.closest('.slide-wrap.editing')) return false;
                try {
                    const span = document.createElement('span');
                    span.style[prop] = value;
                    range.surroundContents(span);
                    sel.removeAllRanges();
                    return true;
                } catch(e) {
                    // surroundContents falha se selecao cruza nos — fallback: extrai e wrapa
                    const fragment = range.extractContents();
                    const span = document.createElement('span');
                    span.style[prop] = value;
                    span.appendChild(fragment);
                    range.insertNode(span);
                    sel.removeAllRanges();
                    return true;
                }
            }
            return false;
        }

        function mudarFonte(index, font) {
            if (!aplicarEstiloNaSelecao('fontFamily', `'${font}', sans-serif`)) {
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline').forEach(el => el.style.fontFamily = `'${font}', sans-serif`);
            }
        }

        function mudarCorTexto(index, cor) {
            if (!aplicarEstiloNaSelecao('color', cor)) {
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline, .slide-body').forEach(el => el.style.color = cor);
            }
        }

        function mudarTamanho(index, size) {
            if (!aplicarEstiloNaSelecao('fontSize', size + 'px')) {
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline').forEach(el => el.style.fontSize = size + 'px');
            }
        }

        function mudarEspacamento(index, value) {
            const lh = (value / 10).toFixed(1);
            if (!aplicarEstiloNaSelecao('lineHeight', lh)) {
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline, .slide-body').forEach(el => el.style.lineHeight = lh);
            }
        }

        // ==================== DRAG: MOVER IMAGEM, TEXTO E PERFIL (independentes) ====================
        function initDragMovers(index) {
            const card = document.getElementById(`slide-${index}`);
            if (!card) return;

            // Perfil drag (independente)
            const profile = card.querySelector('.post-profile');
            if (profile) {
                profile.classList.add('draggable-active');
                makeDraggableY(profile, index);
            }

            // Texto drag (independente)
            const postText = card.querySelector('.post-text');
            if (postText) {
                postText.classList.add('draggable-active');
                makeDraggableY(postText, index);
            }

            // Imagens inline drag (cada uma independente)
            card.querySelectorAll('.post-inline-img').forEach(img => {
                img.classList.add('draggable-active');
                makeDraggableY(img, index);
            });
        }

        function makeDraggableY(el, index) {
            // Handler para arrastar verticalmente via transform (independente, não afeta outros elementos)
            el._dragOffsetY = 0; // guardar offset atual
            const handler = function(e) {
                // Nao iniciar drag se clicou dentro de texto editavel (mas permitir drag no container)
                if (e.target !== el && e.target.closest('[contenteditable="true"]')) return;
                if (editingSlideIndex !== index) return;
                if (!el.classList.contains('draggable-active')) return;

                e.preventDefault();
                e.stopPropagation();
                const startY = e.clientY;
                const startOffset = el._dragOffsetY || 0;
                el.style.transition = 'none';

                const onMove = (ev) => {
                    const dy = ev.clientY - startY;
                    const newOffset = startOffset + dy;
                    el._dragOffsetY = newOffset;
                    el.style.transform = `translateY(${newOffset}px)`;
                };

                const onUp = () => {
                    el.style.transition = '';
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onUp);
                };

                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', onUp);
            };
            el.addEventListener('mousedown', handler);
        }

        function toggleNegrito(index) {
            const sel = window.getSelection();
            if (sel && sel.rangeCount > 0 && !sel.isCollapsed) {
                // Verifica se ja esta em negrito
                const container = sel.getRangeAt(0).commonAncestorContainer;
                const parent = container.nodeType === 3 ? container.parentElement : container;
                const isNegrito = parent && (parent.style.fontWeight === 'bold' || parent.style.fontWeight === '700' || parseInt(parent.style.fontWeight) >= 700);
                aplicarEstiloNaSelecao('fontWeight', isNegrito ? 'normal' : 'bold');
            } else {
                // Sem selecao: toggle no headline inteiro
                const card = document.getElementById(`slide-${index}`);
                card.querySelectorAll('.slide-headline').forEach(el => {
                    const current = window.getComputedStyle(el).fontWeight;
                    el.style.fontWeight = (parseInt(current) >= 700) ? '400' : '700';
                });
            }
        }

        function trocarImagem(index) {
            editingSlideIndex = index;
            modalCallback = function(imgUrl) {
                dadosGerados.slides[index].bgImage = imgUrl;
                renderizarSlides();
            };
            abrirModal(dadosGerados.slides[index].busca_imagem || '');
        }

        function excluirImagem(index) {
            if (dadosGerados && dadosGerados.slides[index]) {
                dadosGerados.slides[index].bgImage = '';
                renderizarSlides();
            }
        }

        function cortarImagem(index) {
            const slide = dadosGerados.slides[index];
            if (!slide || !slide.bgImage) return;

            // Carrega imagem com CORS habilitado para poder exportar canvas
            const cropImgObj = new Image();
            cropImgObj.crossOrigin = 'anonymous';

            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:2000;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;';
            modal.innerHTML = `
                <p style="color:white;font-size:0.85rem;font-weight:600;">Ajustar recorte da imagem</p>
                <div id="cropContainer" style="position:relative;width:320px;height:400px;overflow:hidden;border:2px solid rgba(255,255,255,0.3);border-radius:8px;background:#111;">
                    <img id="cropImg" style="position:absolute;cursor:grab;max-width:none;user-select:none;" draggable="false">
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <label style="color:white;font-size:0.7rem;">Zoom</label>
                    <input type="range" id="cropZoom" min="100" max="300" value="100" style="width:150px;">
                </div>
                <div style="display:flex;gap:8px;">
                    <button id="cropSave" style="padding:8px 20px;border-radius:8px;border:none;background:#2D8CFF;color:white;font-weight:600;cursor:pointer;">Salvar</button>
                    <button id="cropCancel" style="padding:8px 20px;border-radius:8px;border:1px solid white;background:transparent;color:white;font-weight:600;cursor:pointer;">Cancelar</button>
                </div>
            `;
            document.body.appendChild(modal);

            const img = modal.querySelector('#cropImg');
            const zoom = modal.querySelector('#cropZoom');
            const containerEl = modal.querySelector('#cropContainer');
            let dragging = false, startX, startY, imgLeft = 0, imgTop = 0;
            let baseW = 320, baseH = 400;

            // Seta src da imagem visivel (para exibir) e do obj (para canvas)
            cropImgObj.src = slide.bgImage;
            img.src = slide.bgImage;

            img.onload = () => {
                // Escala para caber na largura do container
                const ratio = img.naturalHeight / img.naturalWidth;
                img.style.width = '320px';
                img.style.height = (320 * ratio) + 'px';
                img.style.left = '0px';
                img.style.top = '0px';
                imgLeft = 0; imgTop = 0;
            };

            zoom.oninput = () => {
                const scale = zoom.value / 100;
                const ratio = img.naturalHeight / img.naturalWidth;
                const w = 320 * scale;
                img.style.width = w + 'px';
                img.style.height = (w * ratio) + 'px';
            };

            containerEl.onmousedown = (e) => {
                e.preventDefault();
                dragging = true;
                startX = e.clientX - imgLeft;
                startY = e.clientY - imgTop;
                img.style.cursor = 'grabbing';
            };

            const onMove = (e) => {
                if (!dragging) return;
                imgLeft = e.clientX - startX;
                imgTop = e.clientY - startY;
                img.style.left = imgLeft + 'px';
                img.style.top = imgTop + 'px';
            };
            const onUp = () => { dragging = false; img.style.cursor = 'grab'; };
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onUp);

            const cleanup = () => {
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onUp);
                modal.remove();
            };

            modal.querySelector('#cropCancel').onclick = cleanup;

            modal.querySelector('#cropSave').onclick = () => {
                const canvas = document.createElement('canvas');
                const outW = 1080, outH = 1350;
                canvas.width = outW;
                canvas.height = outH;
                const ctx = canvas.getContext('2d');

                // Calcula as coordenadas de source baseado no recorte visual
                const scale = zoom.value / 100;
                const displayW = 320 * scale;
                const ratio = cropImgObj.naturalHeight / cropImgObj.naturalWidth;
                const displayH = displayW * ratio;

                // Proporcao: pixel do display -> pixel original da imagem
                const pixelRatio = cropImgObj.naturalWidth / displayW;

                // A viewport visivel e 320x400, e a imagem esta offset por imgLeft,imgTop
                // Source rect na imagem original:
                const sx = (-imgLeft) * pixelRatio;
                const sy = (-imgTop) * pixelRatio;
                const sw = 320 * pixelRatio;
                const sh = 400 * pixelRatio;

                try {
                    ctx.drawImage(cropImgObj, sx, sy, sw, sh, 0, 0, outW, outH);
                    slide.bgImage = canvas.toDataURL('image/jpeg', 0.92);
                    renderizarSlides();
                } catch(err) {
                    alert('Não foi possível cortar esta imagem (restrição de segurança). Faça upload da imagem primeiro.');
                }
                cleanup();
            };
        }

        // ==================== REFAZER DESIGN ====================
        async function refazerDesign() {
            // Avançar layout para o próximo modelo
            currentLayoutIndex++;
            gradientLinePosition = (gradientLinePosition + 1) % 2;

            // Regenerar TODO o conteúdo (texto + imagens) chamando a IA novamente
            if (document.getElementById('inputTema').value.trim() || document.getElementById('inputConteudo').value.trim()) {
                await gerarPost();
                return;
            }

            // Fallback: se não há tema/conteúdo, apenas trocar layout visualmente
            renderizarSlides();
        }

        // ==================== DRAG & DROP (removido - sem reordenação) ====================

        // ==================== IMAGE MODAL ====================
        function abrirModal(query) {
            document.getElementById('imageModal').classList.add('active');
            document.getElementById('modalSearchInput').value = query || '';
            if (query) buscarImagens(1);
        }

        function fecharModal() {
            document.getElementById('imageModal').classList.remove('active');
            modalCallback = null;
        }

        function switchModalTab(tab, btn) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            // Esconder tudo
            document.getElementById('modalSearchHeader').style.display = 'none';
            document.getElementById('famososHeader').style.display = 'none';
            document.getElementById('imgGrid').style.display = 'none';
            document.getElementById('famososGrid').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('modalFooter').style.display = 'none';

            if (tab === 'search') {
                document.getElementById('modalSearchHeader').style.display = 'flex';
                document.getElementById('imgGrid').style.display = 'grid';
                document.getElementById('modalFooter').style.display = 'flex';
            } else if (tab === 'famosos') {
                document.getElementById('famososHeader').style.display = 'block';
                document.getElementById('famososGrid').style.display = 'grid';
                setTimeout(() => document.getElementById('famososInput').focus(), 100);
            } else {
                document.getElementById('uploadArea').style.display = 'block';
            }
        }

        // Busca de imagens no modal - Pixabay direto, aceita portugues!
        // Resultados do modal guardados para evitar re-busca
        let modalResultados = [];

        async function buscarImagens(page = 1) {
            const query = document.getElementById('modalSearchInput').value.trim();
            if (!query) return;
            currentPage = page;
            const grid = document.getElementById('imgGrid');
            grid.innerHTML = '<p style="text-align:center;color:var(--text-muted);grid-column:1/-1;padding:20px">Buscando em Pixabay + Pexels...</p>';

            // Buscar 300 de cada banco (múltiplas páginas em paralelo)
            const [pix1, pix2, pex1, pex2, pex3, pex4] = await Promise.allSettled([
                buscarPixabayAPI(query, 200),
                buscarPixabayAPI(query, 100, 2),
                buscarPexelsAPI(query, 80),
                buscarPexelsAPI(query, 80, 2),
                buscarPexelsAPI(query, 80, 3),
                buscarPexelsAPI(query, 80, 4)
            ]);

            const pixabay = { value: [
                ...(pix1.status === 'fulfilled' ? pix1.value : []),
                ...(pix2.status === 'fulfilled' ? pix2.value : [])
            ]};
            const pexels = { value: [
                ...(pex1.status === 'fulfilled' ? pex1.value : []),
                ...(pex2.status === 'fulfilled' ? pex2.value : []),
                ...(pex3.status === 'fulfilled' ? pex3.value : []),
                ...(pex4.status === 'fulfilled' ? pex4.value : [])
            ]};

            // Intercalar resultados
            const pixFotos = pixabay.value || [];
            const pexFotos = pexels.value || [];
            modalResultados = [];
            const max = Math.max(pixFotos.length, pexFotos.length);
            for (let i = 0; i < max; i++) {
                if (i < pixFotos.length) modalResultados.push(pixFotos[i]);
                if (i < pexFotos.length) modalResultados.push(pexFotos[i]);
            }

            if (modalResultados.length === 0) {
                grid.innerHTML = '<p style="text-align:center;color:var(--text-muted);grid-column:1/-1;padding:20px">Nenhuma imagem encontrada para "' + query + '"</p>';
                document.getElementById('pageInfo').textContent = '';
                return;
            }

            // Paginação local (60 por página)
            const porPagina = 60;
            const inicio = (page - 1) * porPagina;
            const paginaFotos = modalResultados.slice(inicio, inicio + porPagina);

            grid.innerHTML = paginaFotos.map((img, idx) => `
                <div class="img-grid-item" onclick="selecionarModalImg(${inicio + idx})">
                    <img src="${img.thumb}" alt="${img.tags}" loading="lazy">
                    <div class="img-credit">${img.credit}</div>
                </div>
            `).join('');

            const totalPages = Math.ceil(modalResultados.length / porPagina);
            document.getElementById('pageInfo').textContent = `${modalResultados.length} fotos (Pixabay: ${pixFotos.length}, Pexels: ${pexFotos.length}) - Pag ${page}/${totalPages}`;
            document.getElementById('btnPrevPage').disabled = page <= 1;
            document.getElementById('btnNextPage').disabled = page >= totalPages;
        }

        function selecionarModalImg(index) {
            const img = modalResultados[index];
            if (img && img.url) {
                selecionarImagem(img.url);
            }
        }

        // ==================== BUSCA DE FAMOSOS (WIKIPEDIA) ====================
        let famososResultados = [];

        async function buscarFamosos() {
            const nome = document.getElementById('famososInput').value.trim();
            if (!nome) return;
            const grid = document.getElementById('famososGrid');
            grid.innerHTML = '<p style="text-align:center;color:var(--text-muted);grid-column:1/-1;padding:20px">Buscando "' + nome + '"...</p>';
            famososResultados = [];

            try {
                // Usar MediaWiki API com pageimages (suporta CORS com origin=*)
                // Buscar em PT e EN simultaneamente
                const [ptResp, enResp] = await Promise.allSettled([
                    fetch(`https://pt.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(nome)}&gsrlimit=10&prop=pageimages|info&piprop=thumbnail|original&pithumbsize=400&format=json&origin=*`),
                    fetch(`https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(nome)}&gsrlimit=10&prop=pageimages|info&piprop=thumbnail|original&pithumbsize=400&format=json&origin=*`)
                ]);

                const resultados = [];
                const titulosVistos = new Set();

                // Processar resultados PT
                if (ptResp.status === 'fulfilled' && ptResp.value.ok) {
                    const ptData = await ptResp.value.json();
                    if (ptData.query && ptData.query.pages) {
                        Object.values(ptData.query.pages).forEach(page => {
                            if (page.thumbnail && !titulosVistos.has(page.title.toLowerCase())) {
                                titulosVistos.add(page.title.toLowerCase());
                                resultados.push({
                                    url: page.original ? page.original.source : page.thumbnail.source.replace(/\/\d+px-/, '/800px-'),
                                    thumb: page.thumbnail.source,
                                    titulo: page.title,
                                    wiki: 'PT'
                                });
                            }
                        });
                    }
                }

                // Processar resultados EN
                if (enResp.status === 'fulfilled' && enResp.value.ok) {
                    const enData = await enResp.value.json();
                    if (enData.query && enData.query.pages) {
                        Object.values(enData.query.pages).forEach(page => {
                            if (page.thumbnail && !titulosVistos.has(page.title.toLowerCase())) {
                                titulosVistos.add(page.title.toLowerCase());
                                resultados.push({
                                    url: page.original ? page.original.source : page.thumbnail.source.replace(/\/\d+px-/, '/800px-'),
                                    thumb: page.thumbnail.source,
                                    titulo: page.title,
                                    wiki: 'EN'
                                });
                            }
                        });
                    }
                }

                famososResultados = resultados;

                if (resultados.length === 0) {
                    grid.innerHTML = '<p style="text-align:center;color:var(--text-muted);grid-column:1/-1;padding:20px">Nenhuma imagem encontrada para "' + nome + '". Tente outro nome.</p>';
                    return;
                }

                grid.innerHTML = resultados.map((r, i) => `
                    <div class="img-grid-item" onclick="selecionarFamoso(${i})" style="position:relative">
                        <img src="${r.thumb}" alt="${r.titulo}" loading="lazy">
                        <div class="img-credit" style="font-size:0.65rem;line-height:1.2">
                            <strong>${r.titulo}</strong>
                            <br>Wikipedia ${r.wiki}
                        </div>
                    </div>
                `).join('');

            } catch(e) {
                console.error('[Famosos] erro:', e);
                grid.innerHTML = '<p style="text-align:center;color:var(--text-muted);grid-column:1/-1;padding:20px">Erro na busca. Tente novamente.</p>';
            }
        }

        function selecionarFamoso(index) {
            const r = famososResultados[index];
            if (r && r.url) {
                selecionarImagem(r.url);
            }
        }

        function selecionarImagem(url) {
            if (modalCallback) {
                modalCallback(url);
            }
            fecharModal();
        }

        function uploadImagem(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (modalCallback) {
                        modalCallback(e.target.result);
                    }
                    fecharModal();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ==================== CAPTION ====================
        function atualizarLegenda() {
            if (!dadosGerados) return;
            const showEmojis = document.getElementById('toggleEmojis').checked;
            const showHashtags = document.getElementById('toggleHashtags').checked;
            const showCTA = document.getElementById('toggleCTA').checked;

            let legenda = dadosGerados.legenda || '';
            if (!showEmojis) {
                legenda = legenda.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{FE00}-\u{FE0F}\u{1F900}-\u{1F9FF}\u{200D}\u{20E3}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}]/gu, '');
            }
            if (showCTA && dadosGerados.cta_legenda) {
                legenda += '\n\n' + dadosGerados.cta_legenda;
            }
            if (showHashtags && dadosGerados.hashtags) {
                legenda += '\n\n' + dadosGerados.hashtags;
            }

            document.getElementById('captionContent').textContent = legenda.trim();
        }

        function copiarLegenda() {
            const texto = document.getElementById('captionContent').textContent;
            copiarTexto(texto);
        }

        // ==================== DOWNLOAD ====================
        async function renderSlideFullRes(index) {
            const slide = dadosGerados.slides[index];
            const isSemImagem = designerModelo === 'noticia-si';
            const layoutNum = isSemImagem ? (currentLayoutIndex % 3) + 6 : (currentLayoutIndex % 5) + 1;
            const container = document.getElementById('renderContainer');

            // Clone slide at full resolution
            const original = document.getElementById(`slide-${index}`);
            const clone = original.cloneNode(true);
            clone.style.width = '1080px';
            clone.style.height = '1350px';
            clone.style.borderRadius = '0';
            clone.style.transform = 'scale(1)';

            // Scale up fonts
            clone.querySelectorAll('.slide-headline').forEach(el => {
                const currentSize = parseFloat(window.getComputedStyle(original.querySelector('.slide-headline')).fontSize);
                el.style.fontSize = (currentSize * 4) + 'px';
            });
            clone.querySelectorAll('.slide-body').forEach(el => {
                const currentSize = parseFloat(window.getComputedStyle(original.querySelector('.slide-body')).fontSize);
                el.style.fontSize = (currentSize * 4) + 'px';
            });
            clone.querySelectorAll('.slide-content').forEach(el => {
                // Don't override padding for slide-content inside glass cards (handled by glass card scaling)
                if (!el.parentElement || !el.parentElement.classList.contains('noticia-glass-card')) {
                    // Noticia capa has specific bottom-aligned padding
                    if (clone.classList.contains('noticia-capa')) {
                        el.style.padding = '80px 80px 88px';
                    } else {
                        el.style.padding = '80px';
                    }
                }
            });
            clone.querySelectorAll('.slide-badge').forEach(el => {
                el.style.fontSize = '2.4rem';
                el.style.padding = '12px 40px';
                el.style.top = '40px';
                el.style.right = '40px';
            });

            // Scale up noticia-specific elements (4x for 1080x1350 export)
            // Gradient line variants
            clone.querySelectorAll('.noticia-line.line-bottom').forEach(el => {
                el.style.height = '16px';
            });
            clone.querySelectorAll('.noticia-line.line-left').forEach(el => {
                el.style.width = '16px';
            });
            // === Glass card — Models 1 and 6 have real glass cards ===
            clone.querySelectorAll('.noticia-glass-card').forEach(el => {
                if (clone.classList.contains('noticia-6')) {
                    el.style.borderRadius = '64px';
                    el.style.backdropFilter = 'none';
                    el.style.webkitBackdropFilter = 'none';
                    el.style.background = fundoTema === 'claro' ? 'rgba(255,255,255,0.65)' : 'rgba(16,38,62,0.85)';
                    el.style.padding = '80px 72px';
                    el.style.left = '56px'; el.style.right = '56px'; el.style.bottom = '72px';
                    el.style.boxShadow = '0 32px 160px rgba(0,0,0,0.3)';
                } else if (clone.classList.contains('noticia-1')) {
                    el.style.borderRadius = '64px';
                    el.style.borderWidth = '4px';
                    el.style.backdropFilter = 'none';
                    el.style.webkitBackdropFilter = 'none';
                    const computed = window.getComputedStyle(el);
                    const currentBg = computed.backgroundColor;
                    if (currentBg.includes('0.035')) el.style.background = 'rgba(16,38,62,0.88)';
                    else if (currentBg.includes('0.6')) el.style.background = 'rgba(255,255,255,0.8)';
                    const cp = computed.padding;
                    if (cp) { const parts = cp.split(' ').map(v => (parseFloat(v) * 4) + 'px'); el.style.padding = parts.join(' '); }
                    ['top', 'bottom', 'left', 'right'].forEach(prop => {
                        const val = computed[prop];
                        if (val && val !== 'auto' && val.endsWith('px')) { const px = parseFloat(val); if (!isNaN(px) && px > 0) el.style[prop] = (px * 4) + 'px'; }
                    });
                    el.style.boxShadow = '0 32px 128px rgba(0,0,0,0.4)';
                }
            });
            // === Decorative elements — generic scaling for all deco-a/b/c ===
            clone.querySelectorAll('.noticia-deco-a, .noticia-deco-b, .noticia-deco-c').forEach(el => {
                const computed = window.getComputedStyle(el);
                // Scale px dimensions (width, height, top, bottom, left, right, gap, borderWidth, borderRadius)
                ['width', 'height', 'top', 'bottom', 'left', 'right', 'gap'].forEach(prop => {
                    const val = computed[prop];
                    if (val && val !== 'auto' && val !== 'none' && val.endsWith('px')) {
                        const px = parseFloat(val);
                        if (!isNaN(px) && Math.abs(px) > 0) el.style[prop] = (px * 4) + 'px';
                    }
                });
                // Scale padding
                const cp = computed.padding;
                if (cp && cp !== '0px') { const parts = cp.split(' ').map(v => (parseFloat(v) * 4) + 'px'); el.style.padding = parts.join(' '); }
                // Scale border-width
                const bw = computed.borderWidth || computed.borderTopWidth;
                if (bw && bw !== '0px') {
                    const px = parseFloat(bw);
                    if (!isNaN(px) && px > 0) el.style.borderWidth = (px * 4) + 'px';
                }
            });
            // === Model 2 body border-top scaling ===
            if (clone.classList.contains('noticia-2')) {
                clone.querySelectorAll('.slide-body').forEach(el => {
                    el.style.borderTopWidth = '8px'; el.style.paddingTop = '56px';
                });
            }
            // === Slide-content padding scaling for models 2-10 ===
            if (!clone.classList.contains('noticia-1') && !clone.classList.contains('noticia-capa')) {
                clone.querySelectorAll('.slide-content').forEach(el => {
                    const computed = window.getComputedStyle(el);
                    const cp = computed.padding;
                    if (cp) { const parts = cp.split(' ').map(v => (parseFloat(v) * 4) + 'px'); el.style.padding = parts.join(' '); }
                });
            }
            // === Model 3: deco-c dot grid — scale background-size ===
            if (clone.classList.contains('noticia-3')) {
                clone.querySelectorAll('.noticia-deco-c').forEach(el => { el.style.backgroundSize = '64px 64px'; });
            }
            // === Model 4: deco-b dot grid — scale background-size ===
            if (clone.classList.contains('noticia-4')) {
                clone.querySelectorAll('.noticia-deco-b').forEach(el => { el.style.backgroundSize = '56px 56px'; });
            }
            // === Model 7: slide-content card — scale border-radius, padding, dot grid ===
            if (clone.classList.contains('noticia-7')) {
                clone.querySelectorAll('.slide-content').forEach(el => { el.style.borderRadius = '56px'; el.style.padding = '80px 72px'; el.style.left = '64px'; el.style.right = '64px'; el.style.bottom = '88px'; });
                clone.querySelectorAll('.noticia-deco-a').forEach(el => { el.style.backgroundSize = '80px 80px'; });
            }
            // === Slide number decorativo (modelos 6-10) — scale everything ===
            clone.querySelectorAll('.noticia-slide-number').forEach(el => {
                const computed = window.getComputedStyle(el);
                const fontSize = parseFloat(computed.fontSize);
                if (!isNaN(fontSize)) el.style.fontSize = (fontSize * 4) + 'px';
                // Scale position
                ['top', 'bottom', 'left', 'right'].forEach(prop => {
                    const val = computed[prop];
                    if (val && val !== 'auto' && val !== 'none' && val.endsWith('px')) {
                        const px = parseFloat(val);
                        if (!isNaN(px) && Math.abs(px) > 0) el.style[prop] = (px * 4) + 'px';
                    }
                });
                // Scale dimensions (modelo 6 circle badge)
                ['width', 'height'].forEach(prop => {
                    const val = computed[prop];
                    if (val && val.endsWith('px')) {
                        const px = parseFloat(val);
                        if (!isNaN(px) && px > 0 && px < 200) el.style[prop] = (px * 4) + 'px';
                    }
                });
                // Scale letter-spacing
                const ls = computed.letterSpacing;
                if (ls && ls !== 'normal' && ls.endsWith('px')) {
                    el.style.letterSpacing = (parseFloat(ls) * 4) + 'px';
                }
                // Scale webkit-text-stroke (modelo 6 outline)
                const stroke = computed.webkitTextStrokeWidth || computed['-webkit-text-stroke-width'];
                if (stroke && stroke.endsWith('px')) {
                    const sPx = parseFloat(stroke);
                    if (!isNaN(sPx) && sPx > 0) el.style.webkitTextStrokeWidth = (sPx * 4) + 'px';
                }
                // Scale padding
                ['paddingLeft', 'paddingRight', 'paddingTop', 'paddingBottom'].forEach(prop => {
                    const val = computed[prop];
                    if (val && val.endsWith('px')) {
                        const px = parseFloat(val);
                        if (!isNaN(px) && px > 0) el.style[prop] = (px * 4) + 'px';
                    }
                });
                // Scale border (modelo 8 underline)
                const bw = computed.borderWidth || computed.borderLeftWidth;
                if (bw && bw.endsWith('px')) {
                    const bPx = parseFloat(bw);
                    if (!isNaN(bPx) && bPx > 0) el.style.borderWidth = (bPx * 4) + 'px';
                }
                // Scale border-radius (modelo 6)
                const br = computed.borderRadius;
                if (br && br.endsWith('px') && br !== '0px') {
                    const bRpx = parseFloat(br);
                    if (!isNaN(bRpx) && bRpx > 0) el.style.borderRadius = (bRpx * 4) + 'px';
                } else if (br === '50%') {
                    el.style.borderRadius = '50%';
                }
            });
            // === Noticia icon (3D) — scale size and position ===
            clone.querySelectorAll('.noticia-icon').forEach(el => {
                const computed = window.getComputedStyle(el);
                ['width', 'height', 'top', 'bottom', 'left', 'right'].forEach(prop => {
                    const val = computed[prop];
                    if (val && val !== 'auto' && val !== 'none' && val.endsWith('px')) {
                        const px = parseFloat(val);
                        if (!isNaN(px) && Math.abs(px) > 0) el.style[prop] = (px * 4) + 'px';
                    }
                });
            });
            // === Noticia emphasis (yellow underline) ===
            clone.querySelectorAll('.noticia-emphasis').forEach(el => {
                el.style.padding = '0 8px';
            });
            // === Swipe indicator ===
            clone.querySelectorAll('.swipe-indicator').forEach(el => {
                el.style.right = '32px';
            });
            clone.querySelectorAll('.swipe-indicator svg').forEach(el => {
                el.style.width = '56px'; el.style.height = '56px';
            });
            // === Body margin-top scaling ===
            clone.querySelectorAll('.slide-body').forEach(el => {
                const computed = window.getComputedStyle(el);
                const mt = parseFloat(computed.marginTop);
                if (mt > 0) el.style.marginTop = (mt * 4) + 'px';
            });

            // Scale up post-specific elements (new white design)
            clone.querySelectorAll('.post-profile').forEach(el => {
                el.style.padding = '0 0 32px 0';
                el.style.gap = '32px';
            });
            clone.querySelectorAll('.post-profile-pic').forEach(el => {
                el.style.width = '120px'; el.style.height = '120px'; el.style.borderWidth = '8px';
            });
            clone.querySelectorAll('.post-profile-pic-placeholder').forEach(el => {
                el.style.width = '120px'; el.style.height = '120px';
            });
            clone.querySelectorAll('.post-profile-pic-placeholder svg').forEach(el => {
                el.style.width = '56px'; el.style.height = '56px';
            });
            clone.querySelectorAll('.post-profile-name').forEach(el => {
                el.style.fontSize = '2.8rem';
            });
            clone.querySelectorAll('.post-profile-handle').forEach(el => {
                el.style.fontSize = '2.2rem';
            });
            clone.querySelectorAll('.post-profile-info').forEach(el => {
                el.style.gap = '6px';
            });
            clone.querySelectorAll('.post-counter').forEach(el => {
                el.style.fontSize = '2.4rem';
                el.style.top = '48px';
                el.style.right = '56px';
            });
            clone.querySelectorAll('.post-inline-img').forEach(el => {
                el.style.borderRadius = '40px';
            });
            clone.querySelectorAll('.post-img-row').forEach(el => {
                el.style.gap = '24px';
            });
            clone.querySelectorAll('.post-img-row .post-inline-img').forEach(el => {
                el.style.height = '440px';
            });
            clone.querySelectorAll('.post-emphasis').forEach(el => {
                el.style.padding = '0 8px';
            });

            // Post content area — profile is inside content flow, no top offset needed
            if (clone.classList.contains('post-capa') || clone.classList.contains('post-1') ||
                clone.classList.contains('post-2') || clone.classList.contains('post-3') ||
                clone.classList.contains('post-4') || clone.classList.contains('post-5')) {
                const cnt = clone.querySelector('.slide-content');
                if (cnt) { cnt.style.top = '0'; cnt.style.padding = '64px 80px 72px'; }
            }

            // Scale up translateY transforms for dragged elements (4x for export)
            clone.querySelectorAll('.post-profile, .post-text, .post-inline-img').forEach(el => {
                const t = el.style.transform;
                if (t && t.includes('translateY')) {
                    const match = t.match(/translateY\((-?\d+(?:\.\d+)?)px\)/);
                    if (match) {
                        el.style.transform = `translateY(${parseFloat(match[1]) * 4}px)`;
                    }
                }
            });

            // Remove edit overlay and image edit buttons
            clone.querySelectorAll('.slide-edit-overlay').forEach(el => el.remove());
            clone.querySelectorAll('.img-edit-actions').forEach(el => el.remove());

            container.innerHTML = '';
            container.appendChild(clone);

            const canvas = await html2canvas(clone, {
                width: 1080,
                height: 1350,
                scale: 1,
                useCORS: true,
                allowTaint: true,
                backgroundColor: designerModelo === 'post' ? '#ffffff' : (fundoTema === 'claro' ? '#f0f2f5' : '#0D1B2A')
            });

            container.innerHTML = '';
            return canvas;
        }

        async function baixarSlide(index) {
            showStatus('Gerando imagem...');
            try {
                const canvas = await renderSlideFullRes(index);
                const link = document.createElement('a');
                link.download = `slide-${index + 1}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                hideStatus();
                mostrarNotificacao('Slide baixado!', 'success');
            } catch(e) {
                hideStatus();
                mostrarNotificacao('Erro ao baixar: ' + e.message, 'error');
            }
        }

        async function baixarTodosSlides() {
            showStatus('Gerando imagens...');
            for (let i = 0; i < dadosGerados.slides.length; i++) {
                showStatus(`Baixando slide ${i + 1} de ${dadosGerados.slides.length}...`);
                try {
                    const canvas = await renderSlideFullRes(i);
                    const link = document.createElement('a');
                    link.download = `slide-${i + 1}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    await new Promise(r => setTimeout(r, 500));
                } catch(e) {
                    console.warn('Erro slide ' + i, e);
                }
            }
            hideStatus();
            mostrarNotificacao('Todos os slides baixados!', 'success');
        }

        async function baixarZIP() {
            if (typeof JSZip === 'undefined') {
                mostrarNotificacao('JSZip nao carregou', 'error');
                return;
            }
            const zip = new JSZip();
            showStatus('Gerando ZIP...');

            for (let i = 0; i < dadosGerados.slides.length; i++) {
                showStatus(`Processando slide ${i + 1} de ${dadosGerados.slides.length}...`);
                try {
                    const canvas = await renderSlideFullRes(i);
                    const dataUrl = canvas.toDataURL('image/png');
                    const base64 = dataUrl.split(',')[1];
                    zip.file(`slide-${i + 1}.png`, base64, { base64: true });
                } catch(e) {
                    console.warn('Erro zip slide ' + i, e);
                }
            }

            const blob = await zip.generateAsync({ type: 'blob' });
            const link = document.createElement('a');
            link.download = 'carrossel.zip';
            link.href = URL.createObjectURL(blob);
            link.click();
            URL.revokeObjectURL(link.href);
            hideStatus();
            mostrarNotificacao('ZIP baixado!', 'success');
        }

        // ==================== SPIN ANIMATION ====================
        if (!document.getElementById('spin-style')) {
            const s = document.createElement('style');
            s.id = 'spin-style';
            s.textContent = '@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }';
            document.head.appendChild(s);
        }
    </script>
</body>
</html>
