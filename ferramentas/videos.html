<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Videos Narrados - ContentStudio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/auth-block.js"></script>
    <style>
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 24px;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            border: 2px solid var(--bg-primary);
        }

        .timeline-time {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--accent-glow);
            border: 1px solid var(--accent);
            padding: 4px 12px;
            border-radius: var(--radius-lg);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-light);
            margin-bottom: 12px;
        }

        .timeline-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .timeline-narration {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            line-height: 1.7;
            margin-bottom: 12px;
            border-left: 3px solid var(--accent);
        }

        .timeline-visual {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .timeline-visual svg {
            width: 18px;
            height: 18px;
            fill: var(--text-muted);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .video-summary {
            background: var(--gradient-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-bottom: 24px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .summary-item {
            text-align: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-light);
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .script-full {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-top: 24px;
        }

        .script-full-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .script-text {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: var(--radius-md);
            font-size: 1rem;
            line-height: 2;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Hero -->
        <section class="hero" style="padding: 40px 0;">
            <h1 class="hero-title" style="font-size: 2.5rem;">Videos Narrados</h1>
            <p class="hero-subtitle">Gere roteiros com narracao, timestamps e sugestoes visuais para seus videos</p>
        </section>

        <!-- Config -->
        <div class="card mb-3">
            <div class="config-row">
                <div class="config-group">
                    <label class="config-label">Duracao do video</label>
                    <div class="input-row">
                        <input type="number" id="duracao" value="60" min="15" max="300" step="15">
                        <span class="input-suffix">segundos</span>
                    </div>
                </div>
                <div class="config-group">
                    <label class="config-label">Tom de voz</label>
                    <select id="tomVoz">
                        <option value="calmo">Calmo e tranquilo</option>
                        <option value="energetico">Energetico</option>
                        <option value="profissional">Profissional</option>
                        <option value="amigavel">Amigavel e proximo</option>
                        <option value="autoritario">Autoritario</option>
                    </select>
                </div>
                <div class="config-group">
                    <label class="config-label">Tipo de video</label>
                    <select id="tipoVideo">
                        <option value="explicativo">Explicativo</option>
                        <option value="promocional">Promocional</option>
                        <option value="educativo">Educativo</option>
                        <option value="storytelling">Storytelling</option>
                        <option value="tutorial">Tutorial</option>
                    </select>
                </div>
                <div class="config-group">
                    <label class="config-label">Plataforma</label>
                    <select id="plataforma">
                        <option value="reels">Instagram Reels</option>
                        <option value="tiktok">TikTok</option>
                        <option value="youtube">YouTube Shorts</option>
                        <option value="youtube-longo">YouTube (longo)</option>
                    </select>
                </div>
            </div>

            <div class="form-group mt-3">
                <label class="form-label">Texto para narrar</label>
                <textarea id="inputText" placeholder="Cole ou digite o texto que sera narrado no video...

Pode ser um artigo, uma explicacao, ou qualquer conteudo que voce queira transformar em video narrado."></textarea>
            </div>

            <button class="btn btn-primary btn-lg mt-2" onclick="gerarVideoNarrado()">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                Gerar Video Narrado
            </button>
        </div>

        <!-- Output -->
        <div id="outputArea">
            <div class="card">
                <div class="output-placeholder">
                    <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                    <p>Seu roteiro narrado aparecera aqui</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/common.js"></script>
    <script>
        // Renderizar header
        renderHeader('videos');

        async function gerarVideoNarrado() {
            const texto = document.getElementById('inputText').value.trim();
            const outputArea = document.getElementById('outputArea');

            if (!texto) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--warning);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p>Insira um texto para gerar o video narrado</p>
                        </div>
                    </div>
                `;
                return;
            }

            if (!APIConfig.key) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p style="color: var(--error);">API nao configurada</p>
                        </div>
                    </div>
                `;
                return;
            }

            const duracao = parseInt(document.getElementById('duracao').value);
            const tomVoz = document.getElementById('tomVoz').value;
            const tipoVideo = document.getElementById('tipoVideo').value;
            const plataforma = document.getElementById('plataforma').value;

            // Loading
            outputArea.innerHTML = `
                <div class="card">
                    <div class="output-placeholder">
                        <div class="loading" style="font-size: 3rem;">üéôÔ∏è</div>
                        <p>Gerando roteiro narrado...</p>
                    </div>
                </div>
            `;

            const systemPrompt = `Voce e um roteirista especializado em videos narrados.
Crie roteiros otimizados para narracao com timestamps precisos.
Sempre responda em portugues brasileiro.
Retorne APENAS o JSON solicitado, sem markdown.`;

            const userPrompt = `Crie um roteiro de video narrado com as seguintes especificacoes:

TEXTO BASE:
${texto}

CONFIGURACOES:
- Duracao total: ${duracao} segundos
- Tom de voz: ${tomVoz}
- Tipo de video: ${tipoVideo}
- Plataforma: ${plataforma}

INSTRUCOES:
1. Divida o conteudo em cenas com timestamps
2. Adapte o texto para narracao natural (considerando ~150 palavras por minuto)
3. Sugira elementos visuais para cada cena (B-roll, graficos, texto na tela)
4. Mantenha a duracao total proxima de ${duracao} segundos
5. Use linguagem adequada para ${plataforma}

Retorne um JSON no formato:
{
    "titulo": "titulo do video",
    "duracao_total": ${duracao},
    "cenas": [
        {
            "numero": 1,
            "timestamp_inicio": "0:00",
            "timestamp_fim": "0:10",
            "duracao": 10,
            "tipo": "abertura|desenvolvimento|conclusao",
            "narracao": "texto que sera falado",
            "visual": "descricao do que mostrar na tela"
        }
    ],
    "script_completo": "texto corrido de toda a narracao"
}`;

            try {
                const resposta = await chamarAPI(systemPrompt, userPrompt);
                const jsonLimpo = resposta.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const dados = JSON.parse(jsonLimpo);

                // Contar palavras
                const palavras = dados.script_completo.split(/\s+/).length;

                let html = `
                    <div class="video-summary">
                        <h3 style="margin: 0 0 8px 0;">${dados.titulo}</h3>
                        <p class="text-muted">Roteiro otimizado para ${plataforma}</p>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-value">${dados.duracao_total}s</div>
                                <div class="summary-label">Duracao</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${dados.cenas.length}</div>
                                <div class="summary-label">Cenas</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${palavras}</div>
                                <div class="summary-label">Palavras</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${Math.round(palavras / (dados.duracao_total / 60))}</div>
                                <div class="summary-label">Palavras/min</div>
                            </div>
                        </div>
                    </div>

                    <h3 class="mb-2">Timeline do Video</h3>
                    <div class="timeline">
                `;

                dados.cenas.forEach(cena => {
                    const tipoLabel = cena.tipo === 'abertura' ? 'Abertura' :
                                     cena.tipo === 'conclusao' ? 'Conclusao' : 'Desenvolvimento';
                    html += `
                        <div class="timeline-item">
                            <div class="timeline-time">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                                ${cena.timestamp_inicio} - ${cena.timestamp_fim} (${cena.duracao}s)
                            </div>
                            <div class="timeline-title">${tipoLabel}</div>
                            <div class="timeline-narration">"${cena.narracao}"</div>
                            <div class="timeline-visual">
                                <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                <span>${cena.visual}</span>
                            </div>
                        </div>
                    `;
                });

                html += `
                    </div>

                    <div class="script-full">
                        <div class="script-full-title">
                            <span>Script Completo para Narracao</span>
                            <button class="btn btn-secondary btn-sm" onclick="copiarScript()">Copiar Script</button>
                        </div>
                        <div class="script-text" id="scriptCompleto">${dados.script_completo}</div>
                    </div>
                `;

                // Guardar para copiar
                window.scriptCompleto = dados.script_completo;

                outputArea.innerHTML = html;

            } catch (error) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p style="color: var(--error);">Erro ao gerar roteiro</p>
                            <p class="text-muted">${error.message}</p>
                            <button onclick="gerarVideoNarrado()" class="btn btn-primary mt-2">Tentar novamente</button>
                        </div>
                    </div>
                `;
            }
        }

        function copiarScript() {
            if (window.scriptCompleto) {
                copiarTexto(window.scriptCompleto);
            }
        }
    </script>
</body>
</html>
