<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imagens - ContentStudio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/auth-block.js"></script>
    <style>
        .output-grid {
            display: grid;
            gap: 20px;
            margin-top: 24px;
        }

        .slide-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }

        .slide-header {
            background: var(--gradient-primary);
            padding: 14px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slide-number {
            font-weight: 700;
            color: white;
        }

        .slide-type {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: var(--radius-lg);
            font-size: 0.8rem;
            color: white;
        }

        .slide-body {
            padding: 24px;
        }

        .slide-preview {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1rem;
            line-height: 1.6;
            border: 2px dashed var(--border);
        }

        .slide-preview.story {
            aspect-ratio: 9/16;
            max-width: 280px;
            margin: 0 auto 20px;
        }

        .slide-section {
            margin-bottom: 16px;
        }

        .slide-section:last-child {
            margin-bottom: 0;
        }

        .slide-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .slide-content {
            background: var(--bg-tertiary);
            padding: 14px 18px;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .slide-visual {
            color: var(--accent-light);
            font-style: italic;
        }

        .hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .hashtag {
            background: var(--accent-glow);
            border: 1px solid var(--accent);
            padding: 6px 12px;
            border-radius: var(--radius-lg);
            font-size: 0.85rem;
            color: var(--accent-light);
        }

        .copy-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .tipo-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .tipo-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tipo-card:hover {
            border-color: var(--border-light);
        }

        .tipo-card.selected {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .tipo-card-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .tipo-card-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .tipo-card-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Hero -->
        <section class="hero" style="padding: 40px 0;">
            <h1 class="hero-title" style="font-size: 2.5rem;">Imagens</h1>
            <p class="hero-subtitle">Crie stories e carrosseis com legendas prontas para Instagram</p>
        </section>

        <!-- Config -->
        <div class="card mb-3">
            <div class="control-title mb-2">Tipo de Conteudo</div>
            <div class="tipo-cards">
                <div class="tipo-card selected" data-tipo="story" onclick="selecionarTipo('story')">
                    <div class="tipo-card-icon">ðŸ“±</div>
                    <div class="tipo-card-title">Story</div>
                    <div class="tipo-card-desc">1 imagem vertical</div>
                </div>
                <div class="tipo-card" data-tipo="carrossel" onclick="selecionarTipo('carrossel')">
                    <div class="tipo-card-icon">ðŸŽ </div>
                    <div class="tipo-card-title">Carrossel</div>
                    <div class="tipo-card-desc">Multiplos slides</div>
                </div>
                <div class="tipo-card" data-tipo="feed" onclick="selecionarTipo('feed')">
                    <div class="tipo-card-icon">ðŸ“·</div>
                    <div class="tipo-card-title">Feed</div>
                    <div class="tipo-card-desc">1 imagem quadrada</div>
                </div>
            </div>

            <div class="config-row">
                <div class="config-group" id="slidesGroup">
                    <label class="config-label">Quantidade de slides</label>
                    <div class="input-row">
                        <input type="number" id="numSlides" value="5" min="2" max="10">
                        <span class="input-suffix">slides</span>
                    </div>
                </div>
                <div class="config-group">
                    <label class="config-label">Estilo visual</label>
                    <select id="estiloVisual">
                        <option value="minimalista">Minimalista</option>
                        <option value="colorido">Colorido</option>
                        <option value="profissional">Profissional</option>
                        <option value="educativo">Educativo</option>
                        <option value="inspirador">Inspirador</option>
                    </select>
                </div>
                <div class="config-group">
                    <label class="config-label">Tom</label>
                    <select id="tomConteudo">
                        <option value="informativo">Informativo</option>
                        <option value="persuasivo">Persuasivo</option>
                        <option value="inspirador">Inspirador</option>
                        <option value="educativo">Educativo</option>
                        <option value="divertido">Divertido</option>
                    </select>
                </div>
            </div>

            <div class="form-group mt-3">
                <label class="form-label">Seu texto ou ideia</label>
                <textarea id="inputText" placeholder="Cole ou digite o texto que voce quer transformar em imagem...

Exemplo: '5 dicas para aumentar sua produtividade no trabalho remoto'"></textarea>
            </div>

            <button class="btn btn-primary btn-lg mt-2" onclick="gerarImagens()">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                Gerar Conteudo
            </button>
        </div>

        <!-- Output -->
        <div class="output-grid" id="outputArea">
            <div class="card">
                <div class="output-placeholder">
                    <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                    <p>Seu conteudo aparecera aqui</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/common.js"></script>
    <script>
        // Renderizar header
        renderHeader('imagens');

        let tipoSelecionado = 'story';

        function selecionarTipo(tipo) {
            tipoSelecionado = tipo;
            document.querySelectorAll('.tipo-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`[data-tipo="${tipo}"]`).classList.add('selected');

            // Mostrar/esconder quantidade de slides
            const slidesGroup = document.getElementById('slidesGroup');
            slidesGroup.style.display = tipo === 'carrossel' ? 'flex' : 'none';
        }

        async function gerarImagens() {
            const texto = document.getElementById('inputText').value.trim();
            const outputArea = document.getElementById('outputArea');

            if (!texto) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--warning);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p>Insira um texto ou ideia primeiro</p>
                        </div>
                    </div>
                `;
                return;
            }

            if (!APIConfig.key) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p style="color: var(--error);">API nao configurada</p>
                        </div>
                    </div>
                `;
                return;
            }

            const numSlides = tipoSelecionado === 'carrossel' ? parseInt(document.getElementById('numSlides').value) : 1;
            const estilo = document.getElementById('estiloVisual').value;
            const tom = document.getElementById('tomConteudo').value;

            // Loading
            outputArea.innerHTML = `
                <div class="card">
                    <div class="output-placeholder">
                        <div class="loading" style="font-size: 3rem;">ðŸŽ¨</div>
                        <p>Gerando conteudo com IA...</p>
                    </div>
                </div>
            `;

            const tipoNome = tipoSelecionado === 'story' ? 'Story do Instagram' :
                             tipoSelecionado === 'carrossel' ? 'Carrossel do Instagram' : 'Post de Feed';

            const systemPrompt = `Voce e um especialista em criacao de conteudo para Instagram.
Crie textos envolventes e otimizados para engajamento.
Sempre responda em portugues brasileiro.
Retorne APENAS o JSON solicitado, sem markdown.`;

            const userPrompt = `Crie conteudo para ${tipoNome} com as seguintes especificacoes:

TEXTO/IDEIA BASE:
${texto}

CONFIGURACOES:
- Tipo: ${tipoSelecionado}
- Quantidade de slides: ${numSlides}
- Estilo visual: ${estilo}
- Tom: ${tom}

INSTRUCOES:
1. ${tipoSelecionado === 'carrossel' ? `Divida o conteudo em ${numSlides} slides logicos` : 'Crie um texto impactante para a imagem'}
2. Cada slide deve ter texto curto e impactante (maximo 30 palavras)
3. Sugira elementos visuais para cada slide
4. Crie uma legenda para o post
5. Sugira 5-10 hashtags relevantes

Retorne um JSON no formato:
{
    "slides": [
        {
            "numero": 1,
            "texto": "texto que aparece na imagem",
            "visual": "descricao do visual sugerido"
        }
    ],
    "legenda": "legenda do post com emojis",
    "hashtags": ["hashtag1", "hashtag2"]
}`;

            try {
                const resposta = await chamarAPI(systemPrompt, userPrompt);
                const jsonLimpo = resposta.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const dados = JSON.parse(jsonLimpo);

                let html = '';

                dados.slides.forEach(slide => {
                    const isStory = tipoSelecionado === 'story';
                    html += `
                        <div class="slide-card">
                            <div class="slide-header">
                                <span class="slide-number">Slide ${slide.numero}</span>
                                <span class="slide-type">${tipoSelecionado === 'story' ? 'Story' : tipoSelecionado === 'feed' ? 'Feed' : 'Carrossel'}</span>
                            </div>
                            <div class="slide-body">
                                <div class="slide-preview ${isStory ? 'story' : ''}">
                                    ${slide.texto}
                                </div>
                                <div class="slide-section">
                                    <div class="slide-label">Texto do Slide</div>
                                    <div class="slide-content">${slide.texto}</div>
                                </div>
                                <div class="slide-section">
                                    <div class="slide-label">Sugestao Visual</div>
                                    <div class="slide-content slide-visual">${slide.visual}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                // Legenda e hashtags
                html += `
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Legenda do Post</span>
                        </div>
                        <div class="slide-content" style="white-space: pre-wrap;">${dados.legenda}</div>
                        <div class="hashtags">
                            ${dados.hashtags.map(h => `<span class="hashtag">#${h.replace('#', '')}</span>`).join('')}
                        </div>
                        <div class="copy-section">
                            <button class="btn btn-secondary" onclick="copiarLegenda()">Copiar Legenda</button>
                            <button class="btn btn-secondary" onclick="copiarHashtags()">Copiar Hashtags</button>
                        </div>
                    </div>
                `;

                // Guardar dados para copiar
                window.dadosGerados = dados;

                outputArea.innerHTML = html;

            } catch (error) {
                outputArea.innerHTML = `
                    <div class="card">
                        <div class="output-placeholder">
                            <svg viewBox="0 0 24 24" style="fill: var(--error);"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            <p style="color: var(--error);">Erro ao gerar conteudo</p>
                            <p class="text-muted">${error.message}</p>
                            <button onclick="gerarImagens()" class="btn btn-primary mt-2">Tentar novamente</button>
                        </div>
                    </div>
                `;
            }
        }

        function copiarLegenda() {
            if (window.dadosGerados) {
                copiarTexto(window.dadosGerados.legenda);
            }
        }

        function copiarHashtags() {
            if (window.dadosGerados) {
                const hashtags = window.dadosGerados.hashtags.map(h => '#' + h.replace('#', '')).join(' ');
                copiarTexto(hashtags);
            }
        }

        // Inicializar
        document.getElementById('slidesGroup').style.display = 'none';
    </script>
</body>
</html>
